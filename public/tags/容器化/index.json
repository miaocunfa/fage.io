[{"content":"æ›´æ–°è®°å½•    æ—¶é—´ å†…å®¹     2021-08-06 åˆç¨¿    è½¯ä»¶ç‰ˆæœ¬    soft Version     zabbix server 4.0.32   zabbix agent 4.0.29    ç›‘æ§è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54  âœ vim /etc/zabbix/scripts/supervisor.sh #!/bin/bash # Describe: monitor supervisorctl status # Create Dateï¼š 2021-08-06 # Create Time: 17:06 # Update Date:  # Update Time:  # Author: MiaoCunFa # Version: v0.0.1 #=================================================================== file=/etc/zabbix/scripts/supervisor.txt # å€¼æ ¡éªŒ if [ \u0026#34;$1\u0026#34; == \u0026#34;\u0026#34; ]; then Usage exit 0 fi function Usage(){ echo \u0026#34;Usage: supervisor.sh [programm]\u0026#34; } #=================================================================== sudo supervisorctl status \u0026gt; $file CMD=$(grep \u0026#34;$1\u0026#34; $file|awk \u0026#39;{print $2}\u0026#39;) if [ \u0026#34;$CMD\u0026#34; == \u0026#34;RUNNING\u0026#34; ]; then echo \u0026#34;1\u0026#34; else echo \u0026#34;0\u0026#34; fi # æ‰§è¡Œæƒé™ âœ chmod u+x supervisor.sh âœ touch supervisor.txt âœ chown zabbix:zabbix supervisor* # ä¿®æ”¹ zabbix conf âœ vim /etc/zabbix/zabbix_agentd.d/supervisor.conf UserParameter=py_status[*], /bin/bash /etc/zabbix/scripts/supervisor.sh $1 # ä¿®æ”¹ sudo æƒé™ âœ vim /etc/sudoers zabbix ALL=NOPASSWD:/usr/bin/supervisorctl # é‡å¯ zabbix agent æœåŠ¡ âœ systemctl restart zabbix-agent   æµ‹è¯•éªŒè¯ 1 2  âœ zabbix_get -s 192.168.189.193 -k py_status[prod_auto] 1   Zabbix UI â‘ åˆ›å»ºæ¨¡æ¿\nç‚¹å‡» \u0026lsquo;é…ç½®\u0026rsquo; \u0026ndash;\u0026gt; \u0026lsquo;æ¨¡æ¿\u0026rsquo; \u0026ndash;\u0026gt; \u0026lsquo;åˆ›å»ºæ¨¡æ¿\u0026rsquo;\nâ‘¡åˆ›å»ºåº”ç”¨é›† big-prod-node1\nâ‘¢åˆ›å»ºç›‘æ§é¡¹\nåœ¨æ¨¡æ¿ä¸‹ \u0026ndash;\u0026gt; ç‚¹å‡» \u0026lsquo;ç›‘æ§é¡¹\u0026rsquo; \u0026ndash;\u0026gt; \u0026lsquo;åˆ›å»ºç›‘æ§é¡¹\u0026rsquo;\nâ‘£åˆ›å»ºè§¦å‘å™¨\nåœ¨æ¨¡æ¿ä¸‹ \u0026ndash;\u0026gt; ç‚¹å‡» \u0026lsquo;è§¦å‘å™¨\u0026rsquo; \u0026ndash;\u0026gt; \u0026lsquo;åˆ›å»ºè§¦å‘å™¨\u0026rsquo;\nZabbix éªŒè¯ â‘ ç›‘æ§é¡¹åˆ—è¡¨\nâ‘¡æœ€æ–°æ•°æ®\n","description":"","id":0,"section":"ops","tags":["zabbix","å‘Šè­¦","supervisorctl"],"title":"Zabbix ç›‘æ§ supervisorctl","uri":"http://localhost:1818/ops/monitor/zabbix%E7%9B%91%E6%8E%A7supervisorctl/"},{"content":"æ›´æ–°è®°å½•    æ—¶é—´ å†…å®¹     2021-07-23 åˆç¨¿   2021-08-06 ä¿®æ”¹è§£å†³æ–¹æ³•ä¸ºsudoæƒé™    è½¯ä»¶ç‰ˆæœ¬    soft Version     zabbix server 4.0.32   zabbix agent 4.0.29    é—®é¢˜æè¿° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  # å‘½ä»¤æ‰§è¡Œæ•ˆæœ âœ supervisorctl status prod_auto RUNNING pid 16604, uptime 15 days, 0:24:23 prod_cycle RUNNING pid 16602, uptime 15 days, 0:24:23 prod_offline RUNNING pid 16605, uptime 15 days, 0:24:23 prod_one_to_one RUNNING pid 16598, uptime 15 days, 0:24:23 prod_online_orders RUNNING pid 16603, uptime 15 days, 0:24:23 prod_online_tables RUNNING pid 16601, uptime 15 days, 0:24:23 prod_server_list RUNNING pid 16597, uptime 15 days, 0:24:23 prod_server_manual RUNNING pid 16599, uptime 15 days, 0:24:23 prod_timer RUNNING pid 16600, uptime 15 days, 0:24:23 # è·å– python ç¨‹åºæ‰§è¡ŒçŠ¶æ€ âœ supervisorctl status | grep prod_auto | awk \u0026#39;{print $2}\u0026#39; RUNNING # é…ç½® supervisor.conf âœ vim /etc/zabbix/zabbix_agentd.d/supervisor.conf UserParameter=py_status[*], supervisorctl status | grep $1 | awk \u0026#39;{print $2}\u0026#39;   Zabbix é…ç½®å¥½ç›‘æ§é¡¹ä»¥åæ— æ³•è·å–æ•°æ®\né—®é¢˜è§£å†³ æŸ¥åˆ°è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸º Zabbixåœ¨è°ƒç”¨ supervisorctl æ—¶è¯•ç”¨ zabbix ç”¨æˆ·æ‰§è¡Œæ²¡æœ‰æƒé™ï¼Œ\nè§£å†³åŠæ³•æ˜¯ç»™ zabbix ç”¨æˆ·åŠ  sudo æƒé™\n1 2  âœ vim /etc/sudoers zabbix ALL=NOPASSWD:/usr/bin/supervisorctl    å‚è€ƒæ–‡æ¡£ï¼š\n[1] centosç¯å¢ƒä¸‹ä½¿ç”¨zabbixé…åˆpythonè„šæœ¬å¯¹supervisorä¸­çš„è¿›ç¨‹è¿è¡ŒçŠ¶æ€è¿›è¡Œç›‘æ§\n[2] ä¿®æ”¹sudoæƒé™\n[3] Zabbixè¿œç¨‹å‘½ä»¤æƒé™ä¸è¶³é—®é¢˜è§£å†³æ–¹æ³•\n ","description":"","id":1,"section":"ops","tags":["zabbix","å‘Šè­¦","supervisorctl"],"title":"Zabbix è§£å†³ supervisorctl æ— æ³•è·å–å€¼","uri":"http://localhost:1818/ops/monitor/zabbix%E8%A7%A3%E5%86%B3supervisor%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E5%80%BC/"},{"content":"æ›´æ–°ä¿¡æ¯    æ—¶é—´ å†…å®¹     2021-06-04 åˆç¨¿    è½¯ä»¶ç‰ˆæœ¬    æ—¶é—´ å†…å®¹     2021-06-04 åˆç¨¿    å®‰è£… â‘ ä¸‹è½½å®‰è£…åŒ… \u0026amp;\u0026amp; å®‰è£…\n1 2 3 4 5 6 7 8  # ä¸‰å°ä¸»æœºéƒ½æ‰§è¡Œ âœ unzip rabbitMQ3.7.7.zip âœ cd rabbitMQ3.7.7 # å®‰è£… âœ yum install erlang-21.3.8.6-1.el7.x86_64.rpm âœ yum install rabbitmq-server-3.7.7-1.el7.noarch.rpm   â‘¡æŸ¥çœ‹å®‰è£…æ–‡ä»¶è·¯å¾„\n1 2 3 4 5 6 7 8 9  âœ rpm -ql rabbitmq-server-3.7.7-1.el7.noarch /etc/logrotate.d/rabbitmq-server /etc/profile.d/rabbitmqctl-autocomplete.sh /etc/rabbitmq /usr/lib/ocf/resource.d/rabbitmq/rabbitmq-server /usr/lib/ocf/resource.d/rabbitmq/rabbitmq-server-ha /usr/lib/rabbitmq/autocomplete/bash_autocomplete.sh /usr/lib/rabbitmq/autocomplete/zsh_autocomplete.sh /usr/lib/rabbitmq/bin/cuttlefish   é…ç½® â‘ hostæ–‡ä»¶\n1 2 3 4 5 6 7  # ä¸‰å°ä¸»æœºéƒ½æ‰§è¡Œ âœ vim /etc/hosts # rabbitMQ 192.168.31.30 MQ1 192.168.31.104 MQ2 192.168.31.155 MQ3   â‘¡åˆ›å»ºæŒä¹…åŒ–ç›®å½•\n1 2 3 4 5  # ä¸‰å°ä¸»æœºéƒ½æ‰§è¡Œ âœ mkdir -p /disk2/rabbitmq/{store,logs} âœ cd /disk2 âœ chown -R rabbitmq:rabbitmq rabbitmq/   â‘¢rabbité…ç½®æ–‡ä»¶\n1 2 3 4 5 6 7 8 9  âœ vim /etc/rabbitmq/rabbitmq-env.conf # æŒ‡å®šèŠ‚ç‚¹çš„åå­—ï¼Œé»˜è®¤rabbit@${hostname} NODENAME=rabbit@MQ1 # æŒ‡å®šç«¯å£ï¼Œé»˜è®¤5672 NODE_PORT=5672 # é…ç½®æŒä¹…ç›®å½• MNESIA_BASE=/disk2/rabbitmq/store # é…ç½®æ—¥å¿—ç›®å½• é»˜è®¤æ–‡ä»¶åå­—ï¼š${NODENAME}.log å¯ä»¥ç”¨é…ç½®ä¿®æ”¹ LOG_BASE=/disk2/rabbitmq/logs   å¯åŠ¨æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  âœ systemctl start rabbitmq-server âœ systemctl status rabbitmq-server â— rabbitmq-server.service - RabbitMQ broker Loaded: loaded (/usr/lib/systemd/system/rabbitmq-server.service; disabled; vendor preset: disabled) Active: active (running) since Fri 2021-06-04 16:16:18 CST; 36s ago Main PID: 13071 (beam.smp) Status: \u0026#34;Initialized\u0026#34; Tasks: 127 Memory: 57.7M CGroup: /system.slice/rabbitmq-server.service â”œâ”€13071 /usr/lib64/erlang/erts-10.3.5.4/bin/beam.smp -W w -A 96 -MBas ageffcbf -MHas ageffcbf -MBlmbcs 512 -MHlmbcs 512 -MMmcs 30 -P 1048576 -t 5000000 -stbt db -zdbbl 1280000... â”œâ”€13212 /usr/lib64/erlang/erts-10.3.5.4/bin/epmd -daemon â”œâ”€13419 erl_child_setup 1024 â”œâ”€13446 inet_gethost 4 â””â”€13447 inet_gethost 4 Jun 04 16:16:16 master rabbitmq-server[13071]: ## ## Jun 04 16:16:16 master rabbitmq-server[13071]: ## ## RabbitMQ 3.7.7. Copyright (C) 2007-2018 Pivotal Software, Inc. Jun 04 16:16:16 master rabbitmq-server[13071]: ########## Licensed under the MPL. See http://www.rabbitmq.com/ Jun 04 16:16:16 master rabbitmq-server[13071]: ###### ## Jun 04 16:16:16 master rabbitmq-server[13071]: ########## Logs: /disk2/rabbitmq/logs/rabbit@MQ1.log Jun 04 16:16:16 master rabbitmq-server[13071]: /disk2/rabbitmq/logs/rabbit@MQ1_upgrade.log Jun 04 16:16:16 master rabbitmq-server[13071]: Starting broker... Jun 04 16:16:18 master rabbitmq-server[13071]: systemd unit for activation check: \u0026#34;rabbitmq-server.service\u0026#34; Jun 04 16:16:18 master systemd[1]: Started RabbitMQ broker. Jun 04 16:16:18 master rabbitmq-server[13071]: completed with 0 plugins.   é›†ç¾¤ â‘ erlang.cookie\nyuméƒ¨ç½²çš„rabbitmq, .erlang.cookie åœ¨ /var/lib/rabbitmq ä¸‹\n1 2 3 4 5 6 7 8  âœ cat /var/lib/rabbitmq/.erlang.cookie DGXKRZAJARTBMFEXIRGV âœ scp .erlang.cookie root@MQ2:/var/lib/rabbitmq âœ scp .erlang.cookie root@MQ3:/var/lib/rabbitmq # åœ¨MQ2ã€MQ3æ‰§è¡Œ âœ cd /var/lib/rabbitmq/; chown -R rabbitmq:rabbitmq ./.erlang.cookie   â‘¡åŠ å…¥é›†ç¾¤\n1 2 3 4 5 6 7 8 9  # MQ2 âœ rabbitmqctl stop_app âœ rabbitmqctl join_cluster rabbit@MQ1 âœ rabbitmqctl start_app # MQ3 âœ rabbitmqctl stop_app âœ rabbitmqctl join_cluster rabbit@MQ1 --ram âœ rabbitmqctl start_app   WEBç®¡ç† 1 2 3  âœ rabbitmq-plugins enable rabbitmq_management âœ rabbitmqctl add_user gongjiangren-test gongjiangrenQAWSED@@ âœ rabbitmqctl set_user_tags gongjiangren-test administrator   1 2 3 4  âœ ss -tnlp|grep 5672 LISTEN 0 128 *:25672 *:* users:((\u0026#34;beam.smp\u0026#34;,pid=13071,fd=65)) LISTEN 0 128 *:15672 *:* users:((\u0026#34;beam.smp\u0026#34;,pid=13071,fd=80)) LISTEN 0 128 [::]:5672 [::]:* users:((\u0026#34;beam.smp\u0026#34;,pid=13071,fd=76))   ","description":"","id":2,"section":"ops","tags":["æ¶ˆæ¯é˜Ÿåˆ—","rabbit MQ"],"title":"yuméƒ¨ç½²rabbitMQé›†ç¾¤","uri":"http://localhost:1818/ops/deploy/yum%E9%83%A8%E7%BD%B2rabbitmq%E9%9B%86%E7%BE%A4/"},{"content":"æ›´æ–°è®°å½•    æ—¶é—´ å†…å®¹     2021-04-02 åˆç¨¿    è½¯ä»¶ç‰ˆæœ¬    soft Version     zabbix server 4.0.21   zabbix agent 4.0.29    å¼•è¨€ ç°åœ¨è¶Šæ¥è¶Šå¤šçš„æµè§ˆå™¨è¦æ±‚ä½ ä½¿ç”¨SSLè¯ä¹¦ï¼Œgoogleæµè§ˆå™¨ç›´æ¥ä¸å…è®¸è®¿é—®éSSLè¯ä¹¦è®¤è¯çš„ç½‘ç«™ï¼Œæ‰€ä»¥ç°åœ¨ä¸‹å…¬å¸SSLè¯ä¹¦è¶Šæ¥è¶Šå¤šï¼Œè¿™å°±å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœSSLè¯ä¹¦è¿‡æœŸäº†ï¼Œä¼šéå¸¸å½±å“ç”¨æˆ·ä½“éªŒã€‚\næ‰€ä»¥ç»“åˆå…¬å¸æ­£åœ¨ä½¿ç”¨çš„Zabbixç›‘æ§å‘Šè­¦å¹³å°ï¼Œæå‰å‘ŠçŸ¥SSLè¯ä¹¦å³å°†è¿‡æœŸï¼Œå°†å¯¹ç®¡ç†SSLè¯ä¹¦éå¸¸æœ‰æ•ˆã€‚\nZabbix Agent è‡ªåŠ¨å‘ç°è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32  âœ vim /etc/zabbix/scripts/ssl_discover.py #!/usr/bin/python \u0026#34;\u0026#34;\u0026#34; Created by Vscode. File: OpsNotes:ssl_discover.py User: miaocunfa Create Date: 2021-04-02 Create Time: 16:08 Update Date: 2021-04-02 Update Time: 17:04 Version: v0.0.3 \u0026#34;\u0026#34;\u0026#34; import os import json # è¿”å›è¯ä¹¦åˆ—è¡¨ def discover(): d = {} d[\u0026#39;data\u0026#39;] = [] with os.popen(\u0026#34;cd /usr/local/nginx/conf/https/; ls *.crt\u0026#34;) as pipe: for line in pipe: info = {} info[\u0026#39;{#CRTFILE}\u0026#39;] = line.replace(\u0026#34;\\n\u0026#34;,\u0026#34;\u0026#34;) d[\u0026#39;data\u0026#39;].append(info) print(json.dumps(d)) discover() # æ‰§è¡Œè„šæœ¬ è¿”å›å¦‚ä¸‹json âœ python3 ssl_discover.py {\u0026#34;data\u0026#34;: [{\u0026#34;{#CRTFILE}\u0026#34;: \u0026#34;1_api.gongjiangren.net_bundle.crt\u0026#34;}, {\u0026#34;{#CRTFILE}\u0026#34;: \u0026#34;1_api.qixinbao.net.cn_bundle.crt\u0026#34;}, {\u0026#34;{#CRTFILE}\u0026#34;: \u0026#34;1_api.shengshui.com_bundle.crt\u0026#34;}, {\u0026#34;{#CRTFILE}\u0026#34;: \u0026#34;1_api.tt321.net_bundle.crt\u0026#34;}, {\u0026#34;{#CRTFILE}\u0026#34;: \u0026#34;1_fleetin.gongjiangren.net_bundle.crt\u0026#34;}, {\u0026#34;{#CRTFILE}\u0026#34;: \u0026#34;1_front.gongjiangren.net_bundle.crt\u0026#34;}, {\u0026#34;{#CRTFILE}\u0026#34;: \u0026#34;1_market.gongjiangren.net_bundle.crt\u0026#34;}, {\u0026#34;{#CRTFILE}\u0026#34;: \u0026#34;1_website.page.gongjiangren.net_bundle.crt\u0026#34;}, {\u0026#34;{#CRTFILE}\u0026#34;: \u0026#34;1_www.gongjiangren.net_bundle.crt\u0026#34;}, {\u0026#34;{#CRTFILE}\u0026#34;: \u0026#34;1_www.qixinbao.net.cn_bundle.crt\u0026#34;}, {\u0026#34;{#CRTFILE}\u0026#34;: \u0026#34;1_www.shengshui.com_bundle.crt\u0026#34;}, {\u0026#34;{#CRTFILE}\u0026#34;: \u0026#34;1_yqfk.gongjiangren.net_bundle.crt\u0026#34;}]}   ç›‘æ§è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55  âœ vim /etc/zabbix/scripts/ssl_check.sh #!/bin/bash # Describe: ssl_check.sh # Create Dateï¼š 2021-04-02 # Create Time: 15:48 # Update Date: 2021-04-02 # Update Time: 16:59 # Author: MiaoCunFa # Version: v0.0.4 #=================================================================== function Usage(){ echo \u0026#34;Usage: ssl_check [crtfile] [alertday]\u0026#34; } crtfile=$1 alert_date=$2 crtdir=\u0026#34;/usr/local/nginx/conf/https\u0026#34; if [ \u0026#34;$1\u0026#34; == \u0026#34;\u0026#34; ]; then Usage exit 0 fi if [ \u0026#34;$2\u0026#34; == \u0026#34;\u0026#34; ]; then Usage exit 0 fi #=================================================================== cd $crtdir # è¿‡æœŸæ—¶é—´ \u0026amp;\u0026amp; è¿‡æœŸæ—¶é—´æ—¶é—´æˆ³ expire_date=$(openssl x509 -in $crtfile -noout -text | grep \u0026#34;Not After\u0026#34; | awk -F \u0026#34; : \u0026#34; \u0026#39;{print $2}\u0026#39;) expire_stamp=$(date -d \u0026#34;$expire_date\u0026#34; +%s) # æé†’æ—¥æœŸ \u0026amp;\u0026amp; æé†’æ—¥æœŸæ—¶é—´æˆ³ alert_stamp=$(($expire_stamp - $alert_date * 86400)) # å½“å‰æ—¥æœŸ \u0026amp;\u0026amp; å½“å‰æ—¥æœŸæ—¶é—´æˆ³ curdate_stamp=$(date +%s) #curdate_stamp=$(date --date 20210823 +%s) # åˆ¤æ–­å½“æœŸæ—¥æœŸä¸æé†’æ—¥æœŸ if [ $curdate_stamp -ge $alert_stamp ]; then echo 1 else echo 0 fi   é…ç½®æ–‡ä»¶ 1 2 3  âœ vim /etc/zabbix/zabbix_agentd.d/ssl.conf UserParameter=ssl.discovery,python3 /etc/zabbix/scripts/ssl_discover.py UserParameter=ssl.check[*],/bin/bash /etc/zabbix/scripts/ssl_check.sh $1 $2   æ‰§è¡Œæƒé™ \u0026amp;\u0026amp; agenté‡å¯ 1 2 3 4 5  âœ cd /etc/zabbix/scripts âœ chown -R zabbix:zabbix ssl* âœ chmod u+x ssl* âœ systemctl restart zabbix-agent   Zabbix UI 1ã€åˆ›å»ºæ¨¡æ¿\nç‚¹å‡» \u0026lsquo;é…ç½®\u0026rsquo; \u0026ndash;\u0026gt; \u0026lsquo;æ¨¡æ¿\u0026rsquo; \u0026ndash;\u0026gt; \u0026lsquo;åˆ›å»ºæ¨¡æ¿\u0026rsquo;\n2ã€åˆ›å»ºè‡ªåŠ¨å‘ç°\né€‰æ‹©æ¨¡æ¿ \u0026ndash;\u0026gt; ç‚¹å‡»\u0026rsquo;è‡ªåŠ¨å‘ç°' \u0026ndash;\u0026gt; \u0026lsquo;åˆ›å»ºå‘ç°è§„åˆ™\u0026rsquo;\n3ã€åˆ›å»ºç›‘æ§é¡¹åŸå‹\nåœ¨è‡ªåŠ¨å‘ç°è§„åˆ™ä¸‹ \u0026ndash;\u0026gt; ç‚¹å‡» \u0026lsquo;ç›‘æ§é¡¹åŸå‹\u0026rsquo; \u0026ndash;\u0026gt; \u0026lsquo;åˆ›å»ºç›‘æ§é¡¹åŸå‹\u0026rsquo;\n4ã€åˆ›å»ºè§¦å‘å™¨\nåœ¨è‡ªåŠ¨å‘ç°è§„åˆ™ä¸‹ \u0026ndash;\u0026gt; ç‚¹å‡» \u0026lsquo;è§¦å‘å™¨ç±»å‹\u0026rsquo; \u0026ndash;\u0026gt; \u0026lsquo;åˆ›å»ºè§¦å‘å™¨åŸå‹\u0026rsquo;\n5ã€ä¸»æœºæ·»åŠ æ¨¡æ¿\nç‚¹å‡» \u0026lsquo;é…ç½®\u0026rsquo; \u0026ndash;\u0026gt; é€‰æ‹©\u0026rsquo;ä¸»æœº' \u0026ndash;\u0026gt; ç‚¹å‡»\u0026rsquo;æ¨¡æ¿' \u0026ndash;\u0026gt; é€‰æ‹©\u0026rsquo;æ¨¡æ¿\u0026rsquo;æ·»åŠ \n6ã€éªŒè¯æ•°æ®\nç‚¹å‡» \u0026lsquo;ç›‘æµ‹\u0026rsquo; \u0026ndash;\u0026gt; \u0026lsquo;æœ€æ–°æ•°æ®\u0026rsquo; \u0026ndash;\u0026gt; é€‰æ‹©\u0026rsquo;ä¸»æœº\u0026rsquo;ä¸\u0026rsquo;åº”ç”¨é›†' \u0026ndash;\u0026gt; \u0026lsquo;åº”ç”¨\u0026rsquo;\n7ã€æŠ¥è­¦ä¿¡æ¯\n å‚è€ƒæ–‡æ¡£ï¼š\n[1] SSLè¯ä¹¦åˆ°æœŸæ—¶é—´ç›‘æ§æé†’å·¥å…·+è„šæœ¬æ¨è\n[2] ç›‘æ§åŸŸåHTTPSè¯ä¹¦è¿‡æœŸæ—¶é—´\n[3] æŸ¥çœ‹åŸŸåhttpsè¯ä¹¦åˆ°æœŸæ—¶é—´\n[4] Shellæ—¥æœŸæ—¶é—´å’Œæ—¶é—´æˆ³çš„è½¬æ¢\n ","description":"","id":3,"section":"ops","tags":["zabbix","sslè¯ä¹¦"],"title":"Zabbix ç›‘æ§ SSLè¯ä¹¦","uri":"http://localhost:1818/ops/monitor/zabbix%E7%9B%91%E6%8E%A7ssl%E8%AF%81%E4%B9%A6/"},{"content":"æ›´æ–°è®°å½•    æ—¶é—´ å†…å®¹     2021-03-15 åˆç¨¿    è½¯ä»¶ç‰ˆæœ¬    soft Version     zabbix server 4.0.21   zabbix agent 4.0.29   ansible 2.9.17    ä¸€ã€Zabbix agent 1.1ã€zabbix agent é…ç½® âœ vim /etc/zabbix/zabbix_agentd.d/docker.conf\rUserParameter=docker.discovery,python3 /etc/zabbix/scripts/docker_monitor.py\rUserParameter=docker.[*],python3 /etc/zabbix/scripts/docker_monitor.py $1 $2\r1.2ã€python ç›‘æ§è„šæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64  âœ vim /etc/zabbix/scripts/docker_monitor.py #!/usr/bin/python \u0026#34;\u0026#34;\u0026#34; Created by PyCharm. File: OpsNotes:docker_monitor.py User: miaocunfa Create Date: 2021-03-12 Create Time: 17:10 Update Date: 2021-03-12 Update Time: 17:10 Version: v0.0.1 \u0026#34;\u0026#34;\u0026#34; import sys import os import json # è¿”å›å®¹å™¨åˆ—è¡¨ def discover(): d = {} d[\u0026#39;data\u0026#39;] = [] with os.popen(\u0026#34;docker ps -a --format {{.Names}}\u0026#34;) as pipe: for line in pipe: info = {} info[\u0026#39;{#CONTAINERNAME}\u0026#39;] = line.replace(\u0026#34;\\n\u0026#34;,\u0026#34;\u0026#34;) d[\u0026#39;data\u0026#39;].append(info) print(json.dumps(d)) def status(name,action): # åˆ¤æ–­å®¹å™¨è¿è¡ŒçŠ¶æ€ if action == \u0026#34;ping\u0026#34;: cmd = \u0026#39;docker inspect --format=\u0026#34;{{.State.Running}}\u0026#34; %s\u0026#39; %name result = os.popen(cmd).read().replace(\u0026#34;\\n\u0026#34;,\u0026#34;\u0026#34;) if result == \u0026#34;true\u0026#34;: print(1) else: print(0) # ç½‘ç»œæ”¶åŒ… elif action == \u0026#34;network_rx_bytes\u0026#34;: cmd = \u0026#34;\u0026#34;\u0026#34;docker exec %scat /proc/net/dev|sed -n 3p|awk \u0026#39;{print $2,$10}\u0026#39;\u0026#34;\u0026#34;\u0026#34; %name result = os.popen(cmd).read().split()[0] print(result) # ç½‘ç»œå‘åŒ… elif action == \u0026#34;network_tx_bytes\u0026#34;: cmd = \u0026#34;\u0026#34;\u0026#34;docker exec %scat /proc/net/dev|sed -n 3p|awk \u0026#39;{print $2,$10}\u0026#39;\u0026#34;\u0026#34;\u0026#34; %name result = os.popen(cmd).read().split()[1] print(result) # ä½¿ç”¨ docker stats å‘½ä»¤è·å¾—å®¹å™¨æŒ‡æ ‡ else: cmd = \u0026#39;docker stats %s--no-stream --format \u0026#34;{{.%s}}\u0026#34;\u0026#39; % (name,action) result = os.popen(cmd).read().replace(\u0026#34;\\n\u0026#34;,\u0026#34;\u0026#34;) if \u0026#34;%\u0026#34; in result: print(float(result.replace(\u0026#34;%\u0026#34;,\u0026#34;\u0026#34;))) else: print(result) if __name__ == \u0026#39;__main__\u0026#39;: try: name, action = sys.argv[1], sys.argv[2] status(name,action) except IndexError: discover()   1.3ã€æ¨é€åˆ°æœåŠ¡å™¨ 1 2 3  âœ ansible docker -m copy -a \u0026#34;src=/root/ansible/docker.conf dest=/etc/zabbix/zabbix_agentd.d/\u0026#34; âœ ansible docker -m copy -a \u0026#34;src=/root/ansible/docker_monitor.py dest=/etc/zabbix/scripts/\u0026#34; âœ ansible docker -m shell -a \u0026#34;systemctl restart zabbix-agent\u0026#34;   äºŒã€Zabbix Server æ‰“å¼€é“¾æ¥ï¼Œå¯¼å…¥ æ­¤æ¨¡æ¿\nç‚¹å‡» \u0026lsquo;é…ç½®\u0026rsquo; \u0026ndash;\u0026gt; \u0026lsquo;æ¨¡æ¿\u0026rsquo; \u0026ndash;\u0026gt; æ‰¾åˆ°å¯¹åº”æ¨¡æ¿ \u0026ndash;\u0026gt; \u0026lsquo;è‡ªåŠ¨å‘ç°\u0026rsquo; \u0026ndash;\u0026gt; \u0026lsquo;ç›‘æ§é¡¹åŸå‹\u0026rsquo;\nä¸‰ã€é—®é¢˜è§£å†³ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  # ä½¿ç”¨ docker.discovery è·å– Docker åˆ—è¡¨ # zabbix ç”¨æˆ·æ— æ³•è®¿é—® /var/run/docker.sock âœ zabbix_get -s 192.168.189.180 -p 10050 -k docker.discovery Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.40/containers/json?all=1: dial unix /var/run/docker.sock: connect: permission denied # æŸ¥çœ‹ docker.sock çš„æƒé™ # docker.sock æ–‡ä»¶ å±ä¸»rootã€å±ç»„docker âœ ansible docker -m shell -a \u0026#34;ls -rtl /var/run/docker.sock\u0026#34; [WARNING]: Invalid characters were found in group names but not replaced, use -vvvv to see details 192.168.189.175 | CHANGED | rc=0 \u0026gt;\u0026gt; srw-rw---- 1 root docker 0 Oct 10 2019 /var/run/docker.sock 192.168.189.177 | CHANGED | rc=0 \u0026gt;\u0026gt; srw-rw---- 1 root docker 0 Oct 10 2019 /var/run/docker.sock 192.168.189.178 | CHANGED | rc=0 \u0026gt;\u0026gt; srw-rw---- 1 root docker 0 Oct 10 2019 /var/run/docker.sock 192.168.189.171 | CHANGED | rc=0 \u0026gt;\u0026gt; srw-rw---- 1 root docker 0 Oct 10 2019 /var/run/docker.sock 192.168.189.176 | CHANGED | rc=0 \u0026gt;\u0026gt; srw-rw---- 1 root docker 0 Oct 10 2019 /var/run/docker.sock 192.168.189.180 | CHANGED | rc=0 \u0026gt;\u0026gt; srwxr-xr-x 1 root docker 0 Oct 10 2019 /var/run/docker.sock # å°† zabbix ç”¨æˆ·åŠ å…¥ dockerç»„ # é‡å¯ zabbix-agent æœåŠ¡ä»¥ç”Ÿæ•ˆ âœ ansible docker -m shell -a \u0026#34;usermod -a -G docker zabbix\u0026#34; âœ ansible docker -m shell -a \u0026#34;systemctl restart zabbix-agent\u0026#34; # è·å–åˆ° Docker åˆ—è¡¨ âœ zabbix_get -s 192.168.189.180 -p 10050 -k docker.discovery {\u0026#34;data\u0026#34;: [{\u0026#34;{#CONTAINERNAME}\u0026#34;: \u0026#34;V_Prod_Bidding_Two\u0026#34;}, {\u0026#34;{#CONTAINERNAME}\u0026#34;: \u0026#34;V_Prod_Machine_Two\u0026#34;}, {\u0026#34;{#CONTAINERNAME}\u0026#34;: \u0026#34;V_Prod_Order_Two\u0026#34;}, {\u0026#34;{#CONTAINERNAME}\u0026#34;: \u0026#34;V_Prod_Project_One\u0026#34;}, {\u0026#34;{#CONTAINERNAME}\u0026#34;: \u0026#34;V_Prod_Three_One\u0026#34;}, {\u0026#34;{#CONTAINERNAME}\u0026#34;: \u0026#34;V_Prod_School_One\u0026#34;}]}   å››ã€éªŒè¯æ•°æ® æ£€æµ‹ \u0026ndash;\u0026gt; æœ€æ–°æ•°æ® \u0026ndash;\u0026gt; åº”ç”¨é›†é€‰ \u0026lsquo;docker_monitor\u0026rsquo;\n å‚è€ƒæ–‡æ¡£ï¼š\n[1] zabbixè‡ªå‘ç°å®æ—¶ç›‘æ§dockerå®¹å™¨åŠå®¹å™¨ä¸­å„ä¸ªæœåŠ¡çš„çŠ¶æ€çº¿ä¸Šä¸šåŠ¡å±•ç¤º\n[2] zabbixç›‘æ§dockerå®¹å™¨çŠ¶æ€\n ","description":"","id":4,"section":"ops","tags":["zabbix","å‘Šè­¦","docker"],"title":"Zabbix ç›‘æ§dockerå®¹å™¨","uri":"http://localhost:1818/ops/monitor/zabbix%E7%9B%91%E6%8E%A7docker%E5%AE%B9%E5%99%A8/"},{"content":"1ã€å¤åˆ¶ conf 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47  # openvpn çš„ systemd Unit âœ cat /usr/lib/systemd/system/openvpn@.service [Unit] Description=OpenVPN Robust And Highly Flexible Tunneling Application On %I After=network.target [Service] Type=notify PrivateTmp=true ExecStart=/usr/sbin/openvpn --cd /etc/openvpn/ --config %i.conf # åªè¦åœ¨/etc/openvpn/ç›®å½•ä¸‹ç¼–è¾‘å¥½é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨æ—¶æŒ‡å®šé…ç½®æ–‡ä»¶åå³å¯å¯åŠ¨ã€‚ [Install] WantedBy=multi-user.target âœ cd /etc/openvpn âœ cp server.conf server-tcp.conf âœ vim server-tcp.conf port 57678 proto tcp # éœ€ä¿®æ”¹ä¸ºtcp dev tun ca /etc/openvpn/server/certs/ca.crt cert /etc/openvpn/server/certs/server.crt key /etc/openvpn/server/certs/server.key dh /etc/openvpn/server/certs/dh.pem tls-auth /etc/openvpn/server/certs/ta.key 0 crl-verify /etc/openvpn/easy-rsa/3/pki/crl.pem server 10.8.0.0 255.255.255.0 push \u0026#34;dhcp-option DNS 8.8.8.8\u0026#34; push \u0026#34;dhcp-option DNS 8.8.4.4\u0026#34; push \u0026#34;route 172.19.0.0 255.255.0.0\u0026#34; compress lzo keepalive 10 120 comp-lzo persist-key persist-tun user openvpn group openvpn log /var/log/openvpn/server-tcp.log # éœ€ä¸ udp åŒºåˆ† log-append /var/log/openvpn/server-tcp.log # éœ€ä¸ udp åŒºåˆ† status /var/log/openvpn/status-tcp.log # éœ€ä¸ udp åŒºåˆ† verb 3 # explicit-exit-notify 1 # éœ€ç¦ç”¨   2ã€å¯åŠ¨ tcp server 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  # å¯åŠ¨æœåŠ¡ \u0026amp;\u0026amp; æŸ¥çœ‹çŠ¶æ€ âœ systemctl start openvpn@server-tcp âœ systemctl status openvpn@server-tcp â— openvpn@server-tcp.service - OpenVPN Robust And Highly Flexible Tunneling Application On server/tcp Loaded: loaded (/usr/lib/systemd/system/openvpn@.service; enabled; vendor preset: disabled) Active: active (running) since Mon 2020-08-17 10:15:31 CST; 4s ago Main PID: 6501 (openvpn) Status: \u0026#34;Initialization Sequence Completed\u0026#34; CGroup: /system.slice/system-openvpn.slice/openvpn@server-tcp.service â””â”€6501 /usr/sbin/openvpn --cd /etc/openvpn/ --config server-tcp.conf Aug 17 10:15:31 zax.aihangxunxi.com systemd[1]: Starting OpenVPN Robust And Highly Flexible Tunneling Application On server/tcp... Aug 17 10:15:31 zax.aihangxunxi.com systemd[1]: Started OpenVPN Robust And Highly Flexible Tunneling Application On server/tcp. # åŒæ—¶å¯åŠ¨ tcpã€udp âœ ss -nlp|grep 57678 udp UNCONN 0 0 *:57678 *:* users:((\u0026#34;openvpn\u0026#34;,pid=5437,fd=5)) tcp LISTEN 0 32 *:57678 *:* users:((\u0026#34;openvpn\u0026#34;,pid=6501,fd=5))   3ã€å®¢æˆ·ç«¯ ovpnæ–‡ä»¶ # é…ç½®ovpnæ–‡ä»¶è¿æ¥ tcpåè®®\rD:\\Program Files\\OpenVPN\\config\\miaocunfa-tcp.ovpn\rclient\rproto tcp\rdev tun\rremote [å…¬ç½‘IP] 57678\rca ca.crt\rcert miaocunfa.crt\rkey miaocunfa.key\rtls-auth ta.key 1\rremote-cert-tls server\rpersist-tun\rpersist-key\rcomp-lzo\rverb 3\rmute-replay-warnings\r4ã€æŠ¥é”™ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  # æ²¡ç¦ç”¨ explicit-exit-notify é€‰é¡¹ # å¯åŠ¨æŠ¥é”™ âœ systemctl start openvpn@server-tcp Job for openvpn@server-tcp.service failed because the control process exited with error code. See \u0026#34;systemctl status openvpn@server-tcp.service\u0026#34; and \u0026#34;journalctl -xe\u0026#34; for details. âœ systemctl status openvpn@server-tcp â— openvpn@server-tcp.service - OpenVPN Robust And Highly Flexible Tunneling Application On server/tcp Loaded: loaded (/usr/lib/systemd/system/openvpn@.service; enabled; vendor preset: disabled) Active: failed (Result: exit-code) since Mon 2020-08-17 10:11:34 CST; 7s ago Process: 5749 ExecStart=/usr/sbin/openvpn --cd /etc/openvpn/ --config %i.conf (code=exited, status=1/FAILURE) Main PID: 5749 (code=exited, status=1/FAILURE) Aug 17 10:11:34 zax.aihangxunxi.com systemd[1]: Starting OpenVPN Robust And Highly Flexible Tunneling Application On server/tcp... Aug 17 10:11:34 zax.aihangxunxi.com systemd[1]: openvpn@server-tcp.service: main process exited, code=exited, status=1/FAILURE Aug 17 10:11:34 zax.aihangxunxi.com systemd[1]: Failed to start OpenVPN Robust And Highly Flexible Tunneling Application On server/tcp. Aug 17 10:11:34 zax.aihangxunxi.com systemd[1]: Unit openvpn@server-tcp.service entered failed state. Aug 17 10:11:34 zax.aihangxunxi.com systemd[1]: openvpn@server-tcp.service failed. # æŸ¥çœ‹æ—¥å¿— âœ cat server-tcp.log Options error: --explicit-exit-notify can only be used with --proto udp Use --help for more information.   ","description":"","id":5,"section":"ops","tags":["OpenVPN"],"title":"OpenVPNä½¿ç”¨tcpåè®®","uri":"http://localhost:1818/ops/network/openvpn%E4%BD%BF%E7%94%A8tcp%E5%8D%8F%E8%AE%AE/"},{"content":"æ›´æ–°è®°å½•    æ—¶é—´ å†…å®¹     2020-07-28 åˆç¨¿   2020-07-29 å¢åŠ systemdæœåŠ¡    ç¯å¢ƒ    Server Version     Seata 1.3.0   CentOS 7.6   Redis 3.2.12   Consul v1.5.3    æ¦‚è¿° Seata æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚Seata å°†ä¸ºç”¨æˆ·æä¾›äº† ATã€TCCã€SAGA å’Œ XA äº‹åŠ¡æ¨¡å¼ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚\nä¸€ã€ä¸‹è½½ 1 2 3 4 5 6 7  # ä¸‹è½½ seataå®‰è£…åŒ… âœ wget https://github.com/seata/seata/releases/download/v1.3.0/seata-server-1.3.0.tar.gz âœ tar zxf seata-server-1.3.0.tar.gz -C /opt # å°†å®‰è£…åŒ…æ‹·è´è‡³å¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹ âœ scp seata-server-1.3.0.tar.gz n222:/opt âœ scp seata-server-1.3.0.tar.gz n225:/opt   äºŒã€é…ç½® Seata çš„é«˜å¯ç”¨ä¾èµ–äºæ³¨å†Œä¸­å¿ƒã€é…ç½®ä¸­å¿ƒå’Œæ•°æ®åº“æ¥å®ç°\n2.1ã€æ³¨å†Œä¸­å¿ƒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  âœ cd /opt/seata/conf âœ vim registry.conf registry { # æ³¨å†Œä¸­å¿ƒæŒ‡å®šä¸ºconsul type = \u0026#34;consul\u0026#34; consul { cluster = \u0026#34;default\u0026#34; serverAddr = \u0026#34;192.168.100.223:8500\u0026#34; } } config { # é…ç½®ä¸­å¿ƒæŒ‡å®šä¸ºæ–‡ä»¶ type = \u0026#34;file\u0026#34; file { name = \u0026#34;file.conf\u0026#34; } }   2.2ã€æ•°æ®åº“ 2.2.1ã€db é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  # ä¿®æ”¹å­˜å‚¨ä¸º db âœ vim file.conf store { mode = \u0026#34;db\u0026#34; db { datasource = \u0026#34;druid\u0026#34; dbType = \u0026#34;postgresql\u0026#34; driverClassName = \u0026#34;org.postgresql.Driver\u0026#34; url = \u0026#34;jdbc:postgresql://192.168.100.241:9999/seata\u0026#34; user = \u0026#34;postgres\u0026#34; password = \u0026#34;test%123\u0026#34; minConn = 5 maxConn = 30 globalTable = \u0026#34;global_table\u0026#34; branchTable = \u0026#34;branch_table\u0026#34; lockTable = \u0026#34;lock_table\u0026#34; queryLimit = 100 maxWait = 5000 } }   postgre SQL\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78  -- Server -- Create database Seata CREATEDATABASEseata;-- the table to store GlobalSession data DROPTABLEIFEXISTS\u0026#34;global_table\u0026#34;;CREATETABLE\u0026#34;global_table\u0026#34;(\u0026#34;xid\u0026#34;VARCHAR(128)NOTNULL,\u0026#34;transaction_id\u0026#34;INT8,\u0026#34;status\u0026#34;INT4NOTNULL,\u0026#34;application_id\u0026#34;VARCHAR(100),\u0026#34;transaction_service_group\u0026#34;VARCHAR(100),\u0026#34;transaction_name\u0026#34;VARCHAR(128),\u0026#34;timeout\u0026#34;INT4,\u0026#34;begin_time\u0026#34;INT8,\u0026#34;application_data\u0026#34;text,\u0026#34;gmt_create\u0026#34;TIMESTAMP,\u0026#34;gmt_modified\u0026#34;TIMESTAMP,PRIMARYKEY(\u0026#34;xid\u0026#34;));CREATEINDEXON\u0026#34;global_table\u0026#34;(\u0026#34;gmt_modified\u0026#34;,\u0026#34;status\u0026#34;);CREATEINDEXON\u0026#34;global_table\u0026#34;(\u0026#34;transaction_id\u0026#34;);-- the table to store BranchSession data DROPTABLEIFEXISTS\u0026#34;branch_table\u0026#34;;CREATETABLE\u0026#34;branch_table\u0026#34;(\u0026#34;branch_id\u0026#34;INT8NOTNULL,\u0026#34;xid\u0026#34;VARCHAR(128)NOTNULL,\u0026#34;transaction_id\u0026#34;INT8,\u0026#34;resource_group_id\u0026#34;VARCHAR(100),\u0026#34;resource_id\u0026#34;VARCHAR(256),\u0026#34;lock_key\u0026#34;VARCHAR(128),\u0026#34;branch_type\u0026#34;VARCHAR(8),\u0026#34;status\u0026#34;INT4,\u0026#34;client_id\u0026#34;VARCHAR(100),\u0026#34;application_data\u0026#34;text,\u0026#34;gmt_create\u0026#34;TIMESTAMP,\u0026#34;gmt_modified\u0026#34;TIMESTAMP,PRIMARYKEY(\u0026#34;branch_id\u0026#34;));CREATEINDEXON\u0026#34;branch_table\u0026#34;(\u0026#34;xid\u0026#34;);-- the table to store lock data DROPTABLEIFEXISTS\u0026#34;lock_table\u0026#34;;CREATETABLE\u0026#34;lock_table\u0026#34;(\u0026#34;row_key\u0026#34;VARCHAR(128)NOTNULL,\u0026#34;xid\u0026#34;VARCHAR(100),\u0026#34;transaction_id\u0026#34;INT8,\u0026#34;branch_id\u0026#34;INT8,\u0026#34;resource_id\u0026#34;VARCHAR(256),\u0026#34;table_name\u0026#34;VARCHAR(100),\u0026#34;pk\u0026#34;VARCHAR(100),\u0026#34;gmt_create\u0026#34;TIMESTAMP,\u0026#34;gmt_modified\u0026#34;TIMESTAMP,PRIMARYKEY(\u0026#34;row_key\u0026#34;));-- Client -- the sequence of undo_log CREATESEQUENCEundo_log_id_seqSTART1INCREMENT1;DROPTABLEIFEXISTS\u0026#34;undo_log\u0026#34;;CREATETABLE\u0026#34;undo_log\u0026#34;(\u0026#34;id\u0026#34;INT8NOTNULLDEFAULTnextval(\u0026#39;undo_log_id_seq\u0026#39;),\u0026#34;branch_id\u0026#34;INT8NOTNULL,\u0026#34;xid\u0026#34;VARCHAR(100)NOTNULL,\u0026#34;context\u0026#34;VARCHAR(128)NOTNULL,\u0026#34;rollback_info\u0026#34;BYTEANOTNULL,\u0026#34;log_status\u0026#34;INT4NOTNULL,\u0026#34;log_created\u0026#34;TIMESTAMP,\u0026#34;log_modified\u0026#34;TIMESTAMP,\u0026#34;ext\u0026#34;VARCHAR(100)DEFAULTNULL,PRIMARYKEY(\u0026#34;id\u0026#34;),UNIQUE(\u0026#34;branch_id\u0026#34;,\u0026#34;xid\u0026#34;));  2.2.2ã€redis é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  # ä¿®æ”¹å­˜å‚¨ä¸º redis âœ vim file.conf store { mode = \u0026#34;redis\u0026#34; redis { host = \u0026#34;192.168.100.223\u0026#34; port = \u0026#34;6379\u0026#34; password = \u0026#34;\u0026#34; database = \u0026#34;0\u0026#34; minConn = 1 maxConn = 10 queryLimit = 100 } }   å®‰è£…redis\n1 2 3 4 5 6 7 8 9  # å®‰è£… redis âœ yum install -y redis # ä¿®æ”¹é…ç½®æ–‡ä»¶ âœ vim /etc/redis.conf bind 0.0.0.0 # å¯åŠ¨ redis âœ systemctl start redis   ä¸‰ã€å¯åŠ¨ 3.1ã€å¯åŠ¨é€‰é¡¹ å¯åŠ¨é€‰é¡¹ï¼š\r-h: æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒçš„ip\r-p: Server rpc ç›‘å¬ç«¯å£\r-m: å…¨å±€äº‹åŠ¡ä¼šè¯ä¿¡æ¯å­˜å‚¨æ¨¡å¼ï¼Œfileã€dbã€redisï¼Œä¼˜å…ˆè¯»å–å¯åŠ¨å‚æ•° (Seata-Server 1.3åŠä»¥ä¸Šç‰ˆæœ¬æ”¯æŒredis)\r-n: Server nodeï¼Œå¤šä¸ªServeræ—¶ï¼Œéœ€åŒºåˆ†å„è‡ªèŠ‚ç‚¹ï¼Œç”¨äºç”Ÿæˆä¸åŒåŒºé—´çš„transactionIdï¼Œä»¥å…å†²çª\r-e: å¤šç¯å¢ƒé…ç½®å‚è€ƒ http://seata.io/en-us/docs/ops/multi-configuration-isolation.html\r3.2ã€è„šæœ¬å¯åŠ¨ 1 2 3 4 5 6 7 8  # n222 âœ sh ./bin/seata-server.sh -n 1 # n223 âœ sh ./bin/seata-server.sh -n 2 # n225 âœ sh ./bin/seata-server.sh -n 3   3.3ã€æ³¨å†Œä¸ºsystemdæœåŠ¡ systemd æœåŠ¡è„šæœ¬\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  âœ vim /usr/lib/systemd/system/seata@.service [Unit] Description=The Seata Server After=syslog.target network.target remote-fs.target nss-lookup.target [Service] Type=simple ExecStart=/bin/sh -c \u0026#39;/opt/seata/bin/seata-server.sh -n %i \u0026gt; /opt/seata/logs/seata-%i.log 2\u0026gt;\u0026amp;1\u0026#39; Restart=always ExecStop=/usr/bin/kill -15 $MAINPID KillSignal=SIGTERM KillMode=mixed PrivateTmp=true [Install] WantedBy=multi-user.target   å¯åŠ¨æœåŠ¡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  âœ systemctl daemon-reload âœ systemctl start seata@3 âœ systemctl status seata@3 â— seata@3.service - The Seata Server Loaded: loaded (/usr/lib/systemd/system/seata@.service; disabled; vendor preset: disabled) Active: active (running) since Wed 2020-07-29 08:43:43 CST; 1s ago Main PID: 17960 (sh) CGroup: /system.slice/system-seata.slice/seata@3.service â”œâ”€17960 /bin/sh -c /opt/seata/bin/seata-server.sh -n 3 2\u0026gt;\u0026amp;1 \u0026gt; /opt/seata/logs/seata-3.log â””â”€17961 /usr/bin/java -server -Xmx2048m -Xms2048m -Xmn1024m -Xss512k -XX:SurvivorRatio=10 -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m -XX:MaxDirectMemorySize=1024m -XX:-O... Jul 29 08:43:43 node225 systemd[1]: Started The Seata Server. Jul 29 08:43:45 node225 sh[17960]: log4j:WARN No appenders could be found for logger (org.apache.http.client.protocol.RequestAddCookies). Jul 29 08:43:45 node225 sh[17960]: log4j:WARN Please initialize the log4j system properly. Jul 29 08:43:45 node225 sh[17960]: log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info. âœ cd /opt/seata/logs/ âœ ll total 32 -rw-r--r-- 1 root root 28037 Jul 29 08:46 seata-3.log -rw-r--r-- 1 root root 986 Jul 29 08:44 seata_gc.log    å‚è€ƒé“¾æ¥:\n1ã€Seataç›´æ¥éƒ¨ç½²æ–‡æ¡£\n2ã€Seataé«˜å¯ç”¨éƒ¨ç½²\n3ã€Seataå‚æ•°é…ç½®\n4ã€ä¸ƒæ­¥å¸¦ä½ é›†æˆSeata 1.2 é«˜å¯ç”¨æ­å»º\n5ã€Seata GitHub\n6ã€Systemd å…¥é—¨æ•™ç¨‹ï¼šå®æˆ˜ç¯‡\n7ã€systemctlæœåŠ¡ç¼–å†™ï¼ŒåŠæ—¥å¿—æ§åˆ¶\n8ã€linux killä¿¡å·åˆ—è¡¨\n ","description":"","id":6,"section":"ops","tags":["seata","åˆ†å¸ƒå¼äº‹åŠ¡"],"title":"éƒ¨ç½²é«˜å¯ç”¨seata","uri":"http://localhost:1818/ops/deploy/%E9%83%A8%E7%BD%B2%E9%AB%98%E5%8F%AF%E7%94%A8seata/"},{"content":"æ›´æ–°è®°å½•    æ—¶é—´ å†…å®¹     2020-07-15 åˆç¨¿   2020-07-21 ç¼–è¯‘etcdhelper   2020-07-23 å®Œæˆå›¾åºŠçš„æ›¿æ¢    ç¯å¢ƒ    Server Version     etcdctl 3.3.15   API 3.3    ä¸€ã€æ¦‚è¿° etcd æ˜¯ä¸€ä¸ªå“åº”å¿«ã€åˆ†å¸ƒå¼ã€ä¸€è‡´çš„ key-value å­˜å‚¨\näºŒã€æ“ä½œ 2.1ã€è¿›å…¥etcdå®¹å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13  # è·å–etcd pod âœ kubectl get pods -n kube-system NAME READY STATUS RESTARTS AGE etcd-apiserver.cluster.local 1/1 Running 9 40d # execè¿›å…¥etcdå†… âœ kubectl exec -n kube-system etcd-apiserver.cluster.local -it -- /bin/sh # å®¹å™¨å†…etcdçš„ç›®å½•ç»“æ„ # find / -name \u0026#39;etcd\u0026#39; -print /etc/kubernetes/pki/etcd # è¯ä¹¦ç›®å½• /usr/local/bin/etcd # äºŒè¿›åˆ¶ç¨‹åº /var/lib/etcd # æ•°æ®ç›®å½•   2.2ã€etcdctl etcd3 API ä»kubernetes 1.6å¼€å§‹ï¼Œetcdé›†ç¾¤ä½¿ç”¨version 3\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  # ä¸‹è½½etcdctl, ä»¥åœ¨etcdå®¹å™¨å¤–è®¿é—®etcdæ¥å£ # https://github.com/etcd-io/etcd/releases âœ cp etcdctl /usr/local/bin/ # è®¾ç½®APIç‰ˆæœ¬ä¸º3 # å¿…é¡»å…ˆæŒ‡å®šAPIçš„ç‰ˆæœ¬æ‰èƒ½ä½¿ç”¨ --certç­‰å‚æ•°æŒ‡å®šè¯ä¹¦, api2çš„å‚æ•°ä¸3ä¸ä¸€è‡´ã€‚ âœ export ETCDCTL_API=3 # æŒ‡å®šè¯ä¹¦è·å– endpointçš„çŠ¶æ€ âœ etcdctl --endpoints=https://localhost:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key endpoint health https://localhost:2379 is healthy: successfully committed proposal: took = 2.706905334s # å¯ä»¥å£°æ˜ etcdctlçš„ç¯å¢ƒå˜é‡ âœ vim /etc/profile # etcd export ETCDCTL_API=3 export ETCDCTL_DIAL_TIMEOUT=3s; export ETCDCTL_CACERT=/etc/kubernetes/pki/etcd/ca.crt; export ETCDCTL_CERT=/etc/kubernetes/pki/etcd/server.crt; export ETCDCTL_KEY=/etc/kubernetes/pki/etcd/server.key; export ETCD_ENDPOINTS=https://localhost:2379 âœ source /etc/profile # å¯ä»¥ä¸ç”¨æŒ‡å®šè¯ä¹¦äº† âœ etcdctl endpoint health 127.0.0.1:2379 is healthy: successfully committed proposal: took = 827.031484ms   ä¸‰ã€Kubernetesèµ„æº 3.1ã€etcdctl lsè„šæœ¬ v3ç‰ˆæœ¬çš„æ•°æ®å­˜å‚¨æ²¡æœ‰ç›®å½•å±‚çº§å…³ç³»äº†ï¼Œè€Œæ˜¯é‡‡ç”¨å¹³å±•ï¼ˆflat)æ¨¡å¼ï¼Œæ¢å¥è¯è¯´/aä¸/a/bå¹¶æ²¡æœ‰åµŒå¥—å…³ç³»ï¼Œè€Œåªæ˜¯keyçš„åç§°å·®åˆ«è€Œå·²ï¼Œè¿™ä¸ªå’ŒAWS S3ä»¥åŠOpenStack Swiftå¯¹è±¡å­˜å‚¨ä¸€æ ·ï¼Œæ²¡æœ‰ç›®å½•çš„æ¦‚å¿µï¼Œä½†æ˜¯keyåç§°æ”¯æŒ/å­—ç¬¦ï¼Œä»è€Œå®ç°çœ‹èµ·æ¥åƒç›®å½•çš„ä¼ªç›®å½•ï¼Œä½†æ˜¯å­˜å‚¨ç»“æ„ä¸Šä¸å­˜åœ¨å±‚çº§å…³ç³»ã€‚\nä¹Ÿå°±æ˜¯è¯´etcdctlæ— æ³•ä½¿ç”¨ç±»ä¼¼v2çš„lså‘½ä»¤ã€‚ä½†æ˜¯æˆ‘è¿˜æ˜¯ä¹ æƒ¯ä½¿ç”¨v2ç‰ˆæœ¬çš„etcdctl lsæŸ¥çœ‹etcdctlå­˜å‚¨çš„å†…å®¹ï¼Œäºæ˜¯å†™äº†ä¸ªæ€§èƒ½ä¸æ€ä¹ˆå¥½ä½†æ˜¯å¯ä»¥ç”¨çš„shellè„šæœ¬etcd_ls.sh:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35  âœ vim etcd_ls.sh #!/bin/bash PREFIX=${1:-/} ORIG_PREFIX=${PREFIX} LAST_CHAR=${PREFIX:${#PREFIX}-1:1} if [[ $LAST_CHAR != \u0026#39;/\u0026#39; ]]; then # Append \u0026#39;/\u0026#39; at the end if not exist PREFIX=\u0026#34;$PREFIX/\u0026#34; fi for ITEM in $(etcdctl get \u0026#34;$PREFIX\u0026#34; --prefix=true --keys-only | grep \u0026#34;$PREFIX\u0026#34;); do PREFIX_LEN=${#PREFIX} CONTENT=${ITEM:$PREFIX_LEN} POS=$(expr index \u0026#34;$CONTENT\u0026#34; \u0026#39;/\u0026#39;) if [[ $POS -le 0 ]]; then # No \u0026#39;/\u0026#39;, it\u0026#39;s not dir, get whole str POS=${#CONTENT} fi CONTENT=${CONTENT:0:$POS} LAST_CHAR=${CONTENT:${#CONTENT}-1:1} if [[ $LAST_CHAR == \u0026#39;/\u0026#39; ]]; then CONTENT=${CONTENT:0:-1} fi echo ${PREFIX}${CONTENT} done | sort | uniq   3.2ã€è·å–æ‰€æœ‰key ç”±äºKubernetesçš„æ‰€æœ‰æ•°æ®éƒ½ä»¥/registryä¸ºå‰ç¼€ï¼Œå› æ­¤é¦–å…ˆæŸ¥çœ‹/registry\næˆ‘ä»¬å‘ç°é™¤äº†minionsã€rangeç­‰å¤§å¤šæ•°èµ„æºéƒ½å¯ä»¥é€šè¿‡etcdctl get xxxè·å–ï¼Œç»„ç»‡æ ¼å¼ä¸º/registry/{resource_name}/{namespace}/{resource_instance}ï¼Œè€Œminionså…¶å®å°±æ˜¯nodeä¿¡æ¯ï¼ŒKubernetesä¹‹å‰èŠ‚ç‚¹å«minionï¼Œåº”è¯¥è¿˜æ²¡æœ‰æ”¹è¿‡æ¥ï¼Œå› æ­¤è¿˜æ˜¯ä½¿ç”¨çš„/registry/minions\n3.3ã€è·å–keyå€¼ å¦‚ä¸Šä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨stringså‘½ä»¤ï¼Œé‚£æ˜¯å› ä¸ºé™¤äº†/registry/apiregistration.k8s.ioæ˜¯ç›´æ¥å­˜å‚¨JSONæ ¼å¼çš„ï¼Œå…¶ä»–èµ„æºé»˜è®¤éƒ½ä¸æ˜¯ä½¿ç”¨JSONæ ¼å¼ç›´æ¥å­˜å‚¨ï¼Œè€Œæ˜¯é€šè¿‡protobufæ ¼å¼å­˜å‚¨ï¼Œå½“ç„¶è¿™ä¹ˆåšçš„åŸå› æ˜¯ä¸ºäº†æ€§èƒ½ï¼Œé™¤éæ‰‹åŠ¨é…ç½®\u0026ndash;storage-media-type=application/jsonï¼Œå‚è€ƒ: etcdctl v3: k8s changes its internal format to proto, and the etcdctl result is unreadable.\nç›´æ¥æŸ¥çœ‹ä¼šä¹±ç \nå››ã€etcdhelper ä½¿ç”¨protoæé«˜äº†æ€§èƒ½ï¼Œä½†ä¹Ÿå¯¼è‡´æœ‰æ—¶æ’æŸ¥é—®é¢˜æ—¶ä¸æ–¹ä¾¿ç›´æ¥ä½¿ç”¨etcdctlè¯»å–å†…å®¹ï¼Œå¯å¹¸çš„æ˜¯openshifté¡¹ç›®å·²ç»å¼€å‘äº†ä¸€ä¸ªå¼ºå¤§çš„è¾…åŠ©å·¥å…· etcdhelper å¯ä»¥è¯»å–etcdå†…å®¹å¹¶è§£ç protoã€‚\n4.1ã€ç¼–è¯‘etcdhelper 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49  # æºä»£ç url # https://github.com/openshift/origin/blob/master/tools/etcdhelper/etcdhelper.go # ç¼–è¯‘ # ä½¿ç”¨gomodç¼–è¯‘etcdhelper âœ go mod init etcdhelper go: creating new go.mod: module etcdhelper âœ go test âœ cat go.mod module etcdhelper go 1.14 require ( github.com/coreos/etcd v3.3.22+incompatible // indirect github.com/coreos/pkg v0.0.0-20180928190104-399ea9e2e55f // indirect github.com/openshift/api v0.0.0-20200714125145-93040c6967eb go.etcd.io/etcd v3.3.22+incompatible go.uber.org/zap v1.15.0 // indirect k8s.io/apimachinery v0.18.6 k8s.io/kubectl v0.18.6 ) # æ­£å¸¸æƒ…å†µä¸‹ï¼Œgo testä¹‹åå°±å¯ä»¥è¿›è¡Œç¼–è¯‘äº†ï¼ŒæŠ¥é”™äº†éœ€è¦å…ˆè§£å†³é”™è¯¯ã€‚ âœ go build etcdhelper.go go: finding module for package github.com/coreos/go-systemd/journal /root/go/pkg/mod/github.com/coreos/etcd@v3.3.22+incompatible/pkg/logutil/zap_journal.go:29:2: no matching versions for query \u0026#34;latest\u0026#34; # è¿™ä¸ªé—®é¢˜ä¸»è¦çœ‹è¿™ä¸ª [issues](https://github.com/etcd-io/etcd/issues/11345) # å…ˆå°† go-systemd ä¸‹è½½åˆ°æœ¬åœ° âœ mkdir -p $GOPATH/src/github.com/coreos/go-systemd/ âœ git clone https://github.com/coreos/go-systemd.git $GOPATH/src/github.com/coreos/go-systemd/ âœ cd $myproject # ä¿®æ”¹ go.modï¼Œå°†ä¾èµ–æ”¹ä¸ºæœ¬åœ°åŒ… âœ vim go.mod replace ( github.com/coreos/go-systemd =\u0026gt; github.com/coreos/go-systemd/v22 latest ) # å†æ‰§è¡Œgo test âœ go test # æ‰§è¡Œç¼–è¯‘ï¼Œå¹¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶etcdhelper âœ go build etcdhelper.go âœ ll total 46668 -rwxr-xr-x. 1 root root 47737965 Jul 20 15:59 etcdhelper -rw-r--r--. 1 root root 4988 Jul 16 17:00 etcdhelper.go -rwxr--r--. 1 root root 706 Jul 16 16:45 etcd_ls.sh -rw-r--r--. 1 root root 515 Jul 20 15:54 go.mod -rw-r--r--. 1 root root 32493 Jul 20 15:54 go.sum   4.2ã€ä½¿ç”¨etcdhelper 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  # å°†etcdhelper åŠ å…¥PATH âœ mv etcdhelper $HOME/go/bin # Usage âœ ./etcdhelper -h Usage of ./etcdhelper: -cacert string Server TLS CA certificate. -cert string TLS client certificate. -endpoint string etcd endpoint. (default \u0026#34;https://127.0.0.1:2379\u0026#34;) -key string TLS client key. # è®¾ç½®åˆ«å âœ alias etcdhelper=\u0026#39;etcdhelper -cacert /etc/kubernetes/pki/etcd/ca.crt \\ -key /etc/kubernetes/pki/etcd/server.key \\ -cert /etc/kubernetes/pki/etcd/server.crt\u0026#39;   è·å–keyå€¼ï¼Œç°åœ¨å¯ä»¥çœ‹åˆ°å­˜å‚¨åœ¨etcdä¸­JSONæ ¼å¼çš„æ•°æ®äº†\n å‚è€ƒé“¾æ¥ï¼š\n1ã€unable to retrive registry from etcd-3.0.4\n2ã€https://www.jianshu.com/p/dbb0623a541d\n3ã€etcdå®˜ç½‘\n4ã€https://github.com/etcd-io/etcd/blob/master/Documentation/dev-guide/interacting_v3.md\n5ã€etcd3å¦‚ä½•è®¾ç½®ç¯å¢ƒå˜é‡\n6ã€å¦‚ä½•è¯»å–Kuberneteså­˜å‚¨åœ¨etcdä¸Šçš„æ•°æ®\n ","description":"","id":7,"section":"cloudnative","tags":["Kubernetes","å®¹å™¨åŒ–","etcd"],"title":"Kubernetesä¹‹etcdæ“ä½œ","uri":"http://localhost:1818/cloudnative/kubernetes/kubernetes%E4%B9%8Betcd%E6%93%8D%E4%BD%9C/"},{"content":"1ã€æŸ¥çœ‹å“ªäº›è¯ä¹¦è¢«åŠé”€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41  âœ cd /etc/openvpn/easy-rsa/3/pki âœ openssl crl -in crl.pem -text -noout Certificate Revocation List (CRL): Version 2 (0x1) Signature Algorithm: sha256WithRSAEncryption Issuer: /CN=OpenVPN Last Update: Jun 23 03:09:23 2020 GMT Next Update: Dec 20 03:09:23 2020 GMT CRL extensions: X509v3 Authority Key Identifier: keyid:0B:FC:91:BF:E1:6E:F6:C7:57:73:1C:2B:75:2B:92:92:03:34:67:D5 DirName:/CN=OpenVPN serial:B1:B4:E0:A6:AC:A2:46:B2 Revoked Certificates: # å·²åŠé”€è¯ä¹¦ Serial Number: 44CB5112DF5B2506DAD198ACC0E34642 Revocation Date: May 17 02:08:44 2020 GMT Serial Number: 54911ECB78462C7F0A05D8E727FFF9A1 Revocation Date: May 17 02:13:38 2020 GMT Serial Number: A1043A93E4CEDCB501447E173CDE80B4 Revocation Date: May 17 02:11:15 2020 GMT Serial Number: B263F59B7EA19DD2930D0E9B8A7FFAEA Revocation Date: May 17 02:13:26 2020 GMT Serial Number: C4DE65A0079E8B25FF13758BA1222418 Revocation Date: Jun 23 03:08:10 2020 GMT Signature Algorithm: sha256WithRSAEncryption 04:e6:e9:d5:13:f4:1d:0e:8b:87:5a:35:16:49:53:9a:7e:90: dc:bb:09:49:c8:69:cc:56:40:96:e9:0a:f9:c3:56:19:25:a5: c7:ed:16:d3:0d:a4:26:a2:56:c4:ed:e3:6c:f4:56:e8:e3:eb: 9d:ff:a8:31:eb:3b:7a:9f:b2:af:c0:96:ce:9b:46:08:3c:2e: cc:5e:63:59:e4:e9:72:bb:3e:e2:cf:9e:b4:40:f9:80:e2:d0: 41:b3:91ğŸ†fb:0d:1d:75:f8:7a:1c:5c:ba:dc:95:0a:bb:42: 19:8b:d4:51:89:19:c5:4b:93:07:e5:3c:c1:1a:fd:06:7b:b7: d6:13:af:3b:ce:13:42:7f:1f:d9:b9:0a:5d:5c:d4:73:c8:1a: b0:0a:1d:00:b0:02:70:b8:6e:6d:a7:b4:79:6a:e8:5e:1f:fe: f2:2c:5a:da:eb:8e:f0:bf:95:86:0d:6b:85:b5:30:f7:99:bb: d6:74:a5:4a:7e:8c:48:20:63:9b:af:21:00:ba:55:0d:3a:59: 14:60:d0:05:e9:25:07:fd:53:22:05:fc:b0:4b:7b:32:2a:e9: 0a:eb:57:7d:c9:17:d5:fd:20:71:61:6b:03:28:ba:b9:0d:fe: d3:5b:72:1d:21:75:e7:52:8a:a6:fc:81:8c:31:ea:42:ff:0d: 46:51:16:84   2ã€pki/index.txtæ–‡ä»¶ å¯ç†è§£ä¸ºopenvpnå®¢æˆ·ç«¯çš„æ•°æ®åº“\næ‰€æœ‰ç”Ÿæˆçš„openvpnå®¢æˆ·ç«¯è¯ä¹¦è®°å½•(å¯ç”¨ã€åŠé”€)\næ–‡ä»¶ä¸­é€šè¿‡ç¬¬ä¸€åˆ—æ ‡å¿—è¯†åˆ«æ˜¯å¦ä¸ºæ³¨é”€çŠ¶æ€\nVä¸ºå¯ç”¨\nRä¸ºæ³¨é”€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  âœ cat index.txt V 221209013920Z 4046594A6432AD1597EE47EB6E00DD8F unknown /CN=server V 221209023107Z A82D845FF707408BB05049D4BF9CAF41 unknown /CN=wangshuxian V 221209052534Z 4661B64B6B934B2C6EE94C55FF5CDF47 unknown /CN=server V 221209070724Z 601EDFDA6E1FE245D92CC0C881416FE1 unknown /CN=test V 221209070729Z 55CE3FD4A111C086840FDC6776EBCBC9 unknown /CN=test2 V 221209070733Z 7924CC116FAE0D7BC90C93E51D102E3E unknown /CN=test3 V 221209092037Z 2922DD807C81B72B48BFD400E253958B unknown /CN=chenqingze V 221210013225Z EE173E515FA302F75067F2BFC070FD25 unknown /CN=wangchaochao R 221210075931Z 200517021326Z B263F59B7EA19DD2930D0E9B8A7FFAEA unknown /CN=zhangyan V 221210081023Z 401455EFD27C8187923032FA09D78DB0 unknown /CN=chujiao R 221210092059Z 200517021115Z A1043A93E4CEDCB501447E173CDE80B4 unknown /CN=liuzhangbin V 221210145608Z E2BFFD9921752954394D799AF91426E5 unknown /CN=wanghongchao R 230103065628Z 200517021338Z 54911ECB78462C7F0A05D8E727FFF9A1 unknown /CN=liuzhangbin2 R 230222082718Z 200517020844Z 44CB5112DF5B2506DAD198ACC0E34642 unknown /CN=zhangliling V 230608031249Z 732FF079AA63D180070E91326F9550E2 unknown /CN=miaocunfa   3ã€crl.pemè¯´æ˜ è¯¥æ–‡ä»¶ä¸ºåŠé”€è¯ä¹¦çš„åå•ï¼Œé…åˆ pki/index.txt è¯†åˆ«å®¢æˆ·ç«¯æ˜¯å¦å¯ç”¨ã€‚\nè‹¥æœªåœ¨ server.conf ä¸­é…ç½®è¯¥æ–‡ä»¶ï¼Œå³ä½¿åŠé”€å®¢æˆ·ç«¯è¯ä¹¦åå®¢æˆ·ç«¯ä»å¯ä»¥æ­£å¸¸è¿æ¥ã€‚\n1 2  âœ vim /etc/openvpn/server.conf crl-verify /etc/openvpn/easy-rsa/3/pki/crl.pem   4ã€åŠé”€è¿‡ç¨‹ 1 2 3 4 5 6 7 8 9 10  # 1ã€ä½¿ç”¨./easyrsaæ³¨é”€è¯ä¹¦ # æ­¤æ—¶åªæ˜¯æ›´æ–°index.txtæ ‡è¯†ä¸ºR(æ³¨é”€)ï¼Œä½†ç»å®è·µåå‘ç°æ ‡è¯†ä¸ºRçš„å®¢æˆ·ç«¯ï¼Œä»å¯ä»¥æ­£å¸¸è¿æ¥æœåŠ¡ç«¯ã€‚ âœ ./easyrsa revoke $USER # 2ã€æ›´æ–°crl.pemæ–‡ä»¶ # å¹¶å°†è¯¥æ–‡ä»¶é…ç½®åœ¨server.confä¸­ âœ ./easyrsa gen-crl # 3ã€é‡å¯openvpn server âœ systemctl restart openvpn@server   5ã€å‡ ä¸ªå¸¸è§é—®é¢˜ 5.1ã€åŠé”€è¯ä¹¦ä»å¯è¿æ¥ ä½¿ç”¨./easyrsa revoke $USER åŠé”€å®¢æˆ·ç«¯è¯ä¹¦åï¼Œå®¢æˆ·ç«¯ä»å¯ä»¥è¿ä¸ŠæœåŠ¡ç«¯\nè§£å†³æ–¹æ³•\n1 2 3  âœ vim /etc/openvpn/server.conf crl-verify /etc/openvpn/easy-rsa/3/pki/crl.pem âœ ./easyrsa gen-crl   5.2ã€æ— æ³•è¯»å–crl.pem æœåŠ¡ç«¯æ—¥å¿—æŠ¥é”™ï¼Œæ— æ³•è¯»å–crl.pemå†…å®¹\nè§£å†³æ–¹æ³•ï¼š\n1  âœ chmod 600 /etc/openvpn/easy-rsa/3/pki/crl.pem    å‚è€ƒæ–‡ç« :\n1ã€http://www.wallcopper.com/linux/3197.html\n ","description":"","id":8,"section":"ops","tags":["OpenVPN"],"title":"OpenVPNåŠé”€è¯ä¹¦ä¸ç”Ÿæ•ˆ","uri":"http://localhost:1818/ops/network/openvpn%E5%90%8A%E9%94%80%E8%AF%81%E4%B9%A6%E4%B8%8D%E7%94%9F%E6%95%88/"},{"content":"æ›´æ–°ä¿¡æ¯    æ—¶é—´ å†…å®¹     2020-03-25 åˆç¨¿   2020-08-05 æ–‡æ¡£ç»“æ„ä¼˜åŒ–   2020-08-12 å¢åŠ æ’ä»¶åˆ—è¡¨    ç‰ˆæœ¬ä¿¡æ¯ rabbit MQ: 3.8.2\rErlang: å®˜æ–¹å»ºè®®æœ€ä½21.3 æ¨è22.x\rè¿™é‡Œç”¨çš„æ˜¯22.2.8\rä¸€ã€ç¯å¢ƒå‡†å¤‡ 1.1ã€ä¸»æœºè§„åˆ’    ä¸»æœº èŠ‚ç‚¹     192.168.100.217 ç£ç›˜èŠ‚ç‚¹   192.168.100.218 å†…å­˜èŠ‚ç‚¹   192.168.100.219 ç£ç›˜èŠ‚ç‚¹    å†…å­˜èŠ‚ç‚¹ï¼š\rå†…å­˜èŠ‚ç‚¹å°†æ‰€æœ‰çš„é˜Ÿåˆ—ã€äº¤æ¢æœºã€ç»‘å®šã€ç”¨æˆ·ã€æƒé™å’Œ vhost çš„å…ƒæ•°æ®å®šä¹‰å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¥½å¤„æ˜¯å¯ä»¥ä½¿å¾—åƒäº¤æ¢æœºå’Œé˜Ÿåˆ—å£°æ˜ç­‰æ“ä½œæ›´åŠ çš„å¿«é€Ÿã€‚ä¾‹å¤–æƒ…å†µæ˜¯ï¼šæŒä¹…çš„ queue çš„å†…å®¹å°†è¢«ä¿å­˜åˆ°ç£ç›˜ã€‚\rç£ç›˜èŠ‚ç‚¹ï¼š\rå°†å…ƒæ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œå•èŠ‚ç‚¹ç³»ç»Ÿåªå…è®¸ç£ç›˜ç±»å‹çš„èŠ‚ç‚¹ï¼Œé˜²æ­¢é‡å¯ RabbitMQ çš„æ—¶å€™ï¼Œä¸¢å¤±ç³»ç»Ÿçš„é…ç½®ä¿¡æ¯ã€‚\ræ³¨æ„ç‚¹ï¼š\r1ã€å†…å­˜èŠ‚ç‚¹ç”±äºä¸è¿›è¡Œç£ç›˜è¯»å†™ï¼Œå®ƒçš„æ€§èƒ½æ¯”ç£ç›˜èŠ‚ç‚¹é«˜ã€‚\r2ã€é›†ç¾¤ä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªç£ç›˜èŠ‚ç‚¹ï¼Œç£ç›˜èŠ‚ç‚¹è¶Šå¤šæ•´ä¸ªé›†ç¾¤å¯ç”¨æ€§è¶Šå¥½ï¼Œä½†æ˜¯é›†ç¾¤æ•´ä½“æ€§èƒ½ä¸ä¼šçº¿æ€§å¢åŠ ï¼Œéœ€è¦æƒè¡¡è€ƒè™‘ã€‚\r3ã€RabbitMQ è¦æ±‚åœ¨é›†ç¾¤ä¸­è‡³å°‘æœ‰ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹ï¼Œæ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å¯ä»¥æ˜¯å†…å­˜èŠ‚ç‚¹ï¼Œå½“èŠ‚ç‚¹åŠ å…¥æˆ–è€…ç¦»å¼€é›†ç¾¤æ—¶ï¼Œå¿…é¡»è¦å°†è¯¥å˜æ›´é€šçŸ¥åˆ°è‡³å°‘ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹ã€‚å¦‚æœé›†ç¾¤ä¸­å”¯ä¸€çš„ä¸€ä¸ªç£ç›˜èŠ‚ç‚¹å´©æºƒçš„è¯ï¼Œé›†ç¾¤ä»ç„¶å¯ä»¥ä¿æŒè¿è¡Œï¼Œä½†æ˜¯æ— æ³•è¿›è¡Œå…¶ä»–æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ï¼Œç›´åˆ°èŠ‚ç‚¹æ¢å¤ã€‚\r4ã€è®¾ç½®ä¸¤ä¸ªç£ç›˜èŠ‚ç‚¹ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å¯ç”¨çš„ï¼Œå¯ä»¥ä¿å­˜å…ƒæ•°æ®çš„æ›´æ”¹ã€‚\r1.2ã€ä¸‹è½½ç¦»çº¿åŒ… å®˜ç½‘å®‰è£…æ‰‹å†Œ\n1 2 3 4 5  rabbit MQï¼šäºŒè¿›åˆ¶ç‰ˆ âœ wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.2/rabbitmq-server-generic-unix-3.8.2.tar.xz Erlang: æ— ä¾èµ–ç‰ˆ -- è¯¥è½¯ä»¶åŒ…å‰¥ç¦»äº†ä¸€äº›Erlangæ¨¡å—å’Œä¾èµ–é¡¹ï¼Œè¿™äº›å¯¹è¿è¡ŒRabbitMQè€Œè¨€ä¸æ˜¯å¿…éœ€çš„ã€‚ âœ wget https://github.com/rabbitmq/erlang-rpm/releases/download/v22.2.8/erlang-22.2.8-1.el7.x86_64.rpm   1.3ã€å®‰è£…ç¦»çº¿åŒ… 1 2 3 4 5 6  # å®‰è£…erlang âœ yum install -y yum install erlang-22.2.8-1.el7.x86_64.rpm # è§£å‹rabbitmq âœ xz -d rabbitmq-server-generic-unix-3.8.2.tar.xz âœ tar -xvf rabbitmq-server-generic-unix-3.8.2.tar -C /opt   1.4ã€hostsæ–‡ä»¶ 1 2 3  192.168.100.217 MQ1 192.168.100.218 MQ2 192.168.100.219 MQ3   1.5ã€é…ç½®æ–‡ä»¶ æˆ‘ä»¬è¦è‡ªå·±åœ¨$Home/etc/rabbitmqä¸­åˆ›å»ºrabbitmq-env.conf, è¯¦ç»†ä¿¡æ¯è¯·å‚é˜… å®˜æ–¹é…ç½®è¯´æ˜\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  # åˆ›å»ºæŒä¹…åŒ–ç›®å½• âœ mkdir -p /ahdata/rabbitmq/store âœ mkdir -p /ahdata/rabbitmq/logs # åˆ›å»ºé…ç½®æ–‡ä»¶ âœ vim /opt/rabbitmq_server-3.8.2/etc/rabbitmq/rabbitmq-env.conf # æŒ‡å®šèŠ‚ç‚¹çš„åå­—ï¼Œé»˜è®¤rabbit@${hostname} NODENAME=rabbit@MQ1 # æŒ‡å®šç«¯å£ï¼Œé»˜è®¤5672 NODE_PORT=5672 # é…ç½®æŒä¹…ç›®å½• MNESIA_BASE=/ahdata/rabbitmq/store # é…ç½®æ—¥å¿—ç›®å½• é»˜è®¤æ–‡ä»¶åå­—ï¼š${NODENAME}.log å¯ä»¥ç”¨é…ç½®ä¿®æ”¹ LOG_BASE=/ahdata/rabbitmq/logs   äºŒã€å¯ç”¨æœåŠ¡ 2.1ã€å¸¸ç”¨å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10  âœ sbin/rabbitmq-server # å¯åŠ¨server âœ sbin/rabbitmq-server -detached # åå°å¯åŠ¨server âœ sbin/rabbitmqctl status # æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ âœ sbin/rabbitmqctl shutdown # åœæ­¢è¿è¡Œçš„èŠ‚ç‚¹ âœ sbin/rabbitmqctl stop_app âœ sbin/rabbitmqctl start_app âœ sbin/rabbitmqctl cluster_status # æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ âœ sbin/rabbitmqctl set_cluster_name rabbit@MQ1 # ä¿®æ”¹é›†ç¾¤åç§° âœ sbin/rabbitmqctl join_cluster \u0026lt;cluster_name\u0026gt; # åŠ å…¥é›†ç¾¤ âœ sbin/rabbitmqctl change_cluster_node_type --node \u0026lt;node_name\u0026gt; [ disk | ram ] # ä¿®æ”¹èŠ‚ç‚¹ç±»å‹   2.2ã€å¯åŠ¨rabbit 1 2 3 4 5  âœ cd /opt/rabbitmq_server-3.8.2/ âœ sbin/rabbitmq-server -detached # æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ âœ sbin/rabbitmqctl status   2.3ã€erlang.cookie Erlang èŠ‚ç‚¹é—´é€šè¿‡è®¤è¯ Erlang cookie çš„æ–¹å¼å…è®¸äº’ç›¸é€šä¿¡ã€‚å› ä¸º rabbitmqctl ä½¿ç”¨ Erlang OTP é€šä¿¡æœºåˆ¶æ¥å’Œ Rabbit èŠ‚ç‚¹é€šä¿¡ï¼Œè¿è¡Œ rabbitmqctl çš„æœºå™¨å’Œæ‰€è¦è¿æ¥çš„ Rabbit èŠ‚ç‚¹å¿…é¡»ä½¿ç”¨ç›¸åŒçš„ Erlang cookie ã€‚å¦åˆ™ä½ ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚\n1 2 3 4 5 6  âœ cat /root/.erlang.cookie IJPCAHDPWVYSDERZDUPG # ä¿æŒcookieä¸€è‡´ âœ scp /root/.erlang.cookie n218:/root/.erlang.cookie âœ scp /root/.erlang.cookie n219:/root/.erlang.cookie   ç°åœ¨ä¸‰å°æœºå™¨ä¸Šå…·æœ‰ç›¸åŒçš„ Erlang cookie äº†ã€‚ä¸‹é¢å¼€å§‹ç»„å»ºé›†ç¾¤ã€‚\nä¸‰ã€é›†ç¾¤ 3.1ã€åŸºç¡€æ¦‚å¿µ RabbitMQ é›†ç¾¤åˆ†ä¸ºä¸¤ç§:\n æ™®é€šé›†ç¾¤ é•œåƒé›†ç¾¤(æ™®é€šé›†ç¾¤çš„å‡çº§)  æ™®é€šé›†ç¾¤ï¼š\nä»¥ä¸¤ä¸ªèŠ‚ç‚¹ï¼ˆrabbit01ã€rabbit02ï¼‰ä¸ºä¾‹æ¥è¿›è¡Œè¯´æ˜ã€‚\rrabbit01å’Œrabbit02ä¸¤ä¸ªèŠ‚ç‚¹ä»…æœ‰ç›¸åŒçš„å…ƒæ•°æ®ï¼Œå³é˜Ÿåˆ—çš„ç»“æ„ï¼Œä½†æ¶ˆæ¯å®ä½“åªå­˜åœ¨äºå…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹rabbit01ï¼ˆæˆ–è€…rabbit02ï¼‰ä¸­ã€‚å½“æ¶ˆæ¯è¿›å…¥rabbit01èŠ‚ç‚¹çš„Queueåï¼Œconsumerä»rabbit02èŠ‚ç‚¹æ¶ˆè´¹æ—¶ï¼ŒRabbitMQä¼šä¸´æ—¶åœ¨rabbit01ã€rabbit02é—´è¿›è¡Œæ¶ˆæ¯ä¼ è¾“ï¼ŒæŠŠAä¸­çš„æ¶ˆæ¯å®ä½“å–å‡ºå¹¶ç»è¿‡Bå‘é€ç»™consumerã€‚æ‰€ä»¥consumeråº”å°½é‡è¿æ¥æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»ä¸­å–æ¶ˆæ¯ã€‚å³å¯¹äºåŒä¸€ä¸ªé€»è¾‘é˜Ÿåˆ—ï¼Œè¦åœ¨å¤šä¸ªèŠ‚ç‚¹å»ºç«‹ç‰©ç†Queueã€‚å¦åˆ™æ— è®ºconsumerè¿rabbit01æˆ–rabbit02ï¼Œå‡ºå£æ€»åœ¨rabbit01ï¼Œä¼šäº§ç”Ÿç“¶é¢ˆã€‚å½“rabbit01èŠ‚ç‚¹æ•…éšœåï¼Œrabbit02èŠ‚ç‚¹æ— æ³•å–åˆ°rabbit01èŠ‚ç‚¹ä¸­è¿˜æœªæ¶ˆè´¹çš„æ¶ˆæ¯å®ä½“ã€‚å¦‚æœåšäº†æ¶ˆæ¯æŒä¹…åŒ–ï¼Œé‚£ä¹ˆå¾—ç­‰rabbit01èŠ‚ç‚¹æ¢å¤ï¼Œç„¶åæ‰å¯è¢«æ¶ˆè´¹ï¼›å¦‚æœæ²¡æœ‰æŒä¹…åŒ–çš„è¯ï¼Œå°±ä¼šäº§ç”Ÿæ¶ˆæ¯ä¸¢å¤±çš„ç°è±¡ã€‚\ré•œåƒé›†ç¾¤ï¼š\nåœ¨æ™®é€šé›†ç¾¤çš„åŸºç¡€ä¸Šï¼ŒæŠŠéœ€è¦çš„é˜Ÿåˆ—åšæˆé•œåƒé˜Ÿåˆ—ï¼Œæ¶ˆæ¯å®ä½“ä¼šä¸»åŠ¨åœ¨é•œåƒèŠ‚ç‚¹é—´åŒæ­¥ï¼Œè€Œä¸æ˜¯åœ¨å®¢æˆ·ç«¯å–æ•°æ®æ—¶ä¸´æ—¶æ‹‰å–ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šå°‘èŠ‚ç‚¹æ¶ˆæ¯å°±ä¼šå¤‡ä»½å¤šå°‘ä»½ã€‚è¯¥æ¨¡å¼å¸¦æ¥çš„å‰¯ä½œç”¨ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œé™¤äº†é™ä½ç³»ç»Ÿæ€§èƒ½å¤–ï¼Œå¦‚æœé•œåƒé˜Ÿåˆ—æ•°é‡è¿‡å¤šï¼ŒåŠ ä¹‹å¤§é‡çš„æ¶ˆæ¯è¿›å…¥ï¼Œé›†ç¾¤å†…éƒ¨çš„ç½‘ç»œå¸¦å®½å°†ä¼šè¢«è¿™ç§åŒæ­¥é€šè®¯å¤§å¤§æ¶ˆè€—æ‰ã€‚æ‰€ä»¥åœ¨å¯¹å¯é æ€§è¦æ±‚è¾ƒé«˜çš„åœºåˆä¸­é€‚ç”¨ã€‚ç”±äºé•œåƒé˜Ÿåˆ—ä¹‹é—´æ¶ˆæ¯è‡ªåŠ¨åŒæ­¥ï¼Œä¸”å†…éƒ¨æœ‰é€‰ä¸¾masteræœºåˆ¶ï¼Œå³ä½¿masterèŠ‚ç‚¹å®•æœºä¹Ÿä¸ä¼šå½±å“æ•´ä¸ªé›†ç¾¤çš„ä½¿ç”¨ï¼Œè¾¾åˆ°å»ä¸­å¿ƒåŒ–çš„ç›®çš„ï¼Œä»è€Œæœ‰æ•ˆçš„é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±åŠæœåŠ¡ä¸å¯ç”¨ç­‰é—®é¢˜ã€‚\r3.2ã€æ™®é€šé›†ç¾¤ 3.2.1ã€é›†ç¾¤å å°†é›†ç¾¤åä¿®æ”¹ä¸ºrabbit@MQ1\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  # ä¿®æ”¹é›†ç¾¤å âœ sbin/rabbitmqctl set_cluster_name rabbit@MQ1 Setting cluster name to rabbit@MQ1 ... # æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ âœ sbin/rabbitmqctl cluster_status Cluster status of node rabbit@MQ1 ... Basics Cluster name: rabbit@MQ1 Disk Nodes rabbit@MQ1 Running Nodes rabbit@MQ1   3.2.2ã€åŠ å…¥é›†ç¾¤ åœ¨218ã€219èŠ‚ç‚¹ä¸Šæ‰§è¡Œ\n1 2 3  âœ sbin/rabbitmqctl stop_app âœ sbin/rabbitmqctl join_cluster rabbit@MQ1 âœ sbin/rabbitmqctl start_app   3.2.3ã€ä¿®æ”¹èŠ‚ç‚¹ç±»å‹ æŸ¥çœ‹é›†ç¾¤çŠ¶æ€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  âœ sbin/rabbitmqctl cluster_status Cluster status of node rabbit@MQ1 ... Basics Cluster name: rabbit@MQ1 Disk Nodes # ç£ç›˜èŠ‚ç‚¹ rabbit@MQ1 # æˆ‘ä»¬çœ‹åˆ°æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯diskç±»å‹ä¸æˆ‘ä»¬é¢„è®¾çš„æ¶æ„ä¸ç¬¦ rabbit@MQ2 # æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªæ¶æ„ rabbit@MQ3 Running Nodes rabbit@MQ1 rabbit@MQ2 rabbit@MQ3   æ›´æ”¹218èŠ‚ç‚¹ä¸ºå†…å­˜èŠ‚ç‚¹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  # åœæ­¢èŠ‚ç‚¹ âœ sbin/rabbitmqctl stop_app # ä¸é›†ç¾¤é€šè®¯ï¼Œä»é›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹ âœ sbin/rabbitmqctl reset # ä»¥RAMæ¨¡å¼é‡æ–°åŠ å…¥é›†ç¾¤ âœ sbin/rabbitmqctl join_cluster rabbit@MQ1 --ram # å¯åŠ¨èŠ‚ç‚¹ âœ sbin/rabbitmqctl start_app âœ sbin/rabbitmqctl cluster_status Cluster status of node rabbit@MQ1 ... Basics Cluster name: rabbit@MQ1 Disk Nodes rabbit@MQ1 rabbit@MQ3 RAM Nodes rabbit@MQ2 Running Nodes rabbit@MQ1 rabbit@MQ2 rabbit@MQ3   èŠ‚ç‚¹å•æœºçŠ¶æ€æ—¶ï¼Œreset å‘½ä»¤å°†æ¸…ç©ºèŠ‚ç‚¹çš„çŠ¶æ€ï¼Œå¹¶å°†å…¶æ¢å¤åˆ°ç©ºç™½çŠ¶æ€ã€‚å½“èŠ‚ç‚¹æ˜¯é›†ç¾¤çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œè¯¥å‘½ä»¤ä¹Ÿä¼šå’Œé›†ç¾¤ä¸­çš„ç£ç›˜èŠ‚ç‚¹é€šä¿¡ï¼Œå‘Šè¯‰ä»–ä»¬è¯¥èŠ‚ç‚¹æ­£åœ¨ç¦»å¼€é›†ç¾¤ã€‚\nè¿™å¾ˆé‡è¦ï¼Œä¸ç„¶ï¼Œé›†ç¾¤ä¼šè®¤ä¸ºè¯¥èŠ‚ç‚¹å‡ºäº†æ•…éšœï¼Œå¹¶æœŸæœ›å…¶æœ€ç»ˆèƒ½å¤Ÿæ¢å¤å›æ¥ï¼Œåœ¨è¯¥èŠ‚ç‚¹å›æ¥ä¹‹å‰ï¼Œé›†ç¾¤ç¦æ­¢æ–°çš„èŠ‚ç‚¹åŠ å…¥ã€‚\n3.3ã€é•œåƒé›†ç¾¤(HA) ä¸Šé¢æˆ‘ä»¬å·²ç»æˆåŠŸéƒ¨ç½²äº†ä¸€ä¸ªæ™®é€šé›†ç¾¤ï¼Œæ™®é€šé›†ç¾¤å¹¶ä¸æ˜¯é«˜å¯ç”¨çš„ï¼Œä¸‹é¢åŸºäºæ™®é€šé›†ç¾¤å‡çº§ä¸ºé•œåƒé›†ç¾¤\nå®˜æ–¹HAæ–¹æ¡ˆ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  âœ sbin/rabbitmqctl set_policy \u0026lt;name\u0026gt; [-p \u0026lt;vhost\u0026gt;] \u0026lt;pattern\u0026gt; \u0026lt;definition\u0026gt; [--apply-to \u0026lt;apply-to\u0026gt;] name: ç­–ç•¥åç§° vhost: æŒ‡å®švhost, é»˜è®¤å€¼ / pattern: é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å“ªäº›éœ€è¦é•œåƒ, ^ä¸ºæ‰€æœ‰ definition: ha-mode: æŒ‡æ˜é•œåƒé˜Ÿåˆ—çš„æ¨¡å¼ï¼Œæœ‰æ•ˆå€¼ä¸º all/exactly/nodes all è¡¨ç¤ºåœ¨é›†ç¾¤æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œé•œåƒï¼Œæ— éœ€è®¾ç½®ha-params exactly è¡¨ç¤ºåœ¨æŒ‡å®šä¸ªæ•°çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œé•œåƒï¼ŒèŠ‚ç‚¹çš„ä¸ªæ•°ç”±ha-paramsæŒ‡å®š nodes è¡¨ç¤ºåœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šè¿›è¡Œé•œåƒï¼ŒèŠ‚ç‚¹åç§°é€šè¿‡ha-paramsæŒ‡å®š ha-params: ha-mode æ¨¡å¼éœ€è¦ç”¨åˆ°çš„å‚æ•° ha-sync-mode: é•œåƒé˜Ÿåˆ—ä¸­æ¶ˆæ¯çš„åŒæ­¥æ–¹å¼ï¼Œæœ‰æ•ˆå€¼ä¸ºautomaticï¼Œmanually apply-to: ç­–ç•¥ä½œç”¨å¯¹è±¡ã€‚å¯é€‰å€¼3ä¸ªï¼Œé»˜è®¤all exchanges è¡¨ç¤ºé•œåƒ exchange (å¹¶ä¸çŸ¥é“æ„ä¹‰æ‰€åœ¨) queues è¡¨ç¤ºé•œåƒ queue all è¡¨ç¤ºé•œåƒ exchangeå’Œqueue âœ sbin/rabbitmqctl set_policy ahy \u0026#34;^\u0026#34; \u0026#39;{\u0026#34;ha-mode\u0026#34;:\u0026#34;all\u0026#34;,\u0026#34;ha-sync-mode\u0026#34;:\u0026#34;automatic\u0026#34;}\u0026#39;      ha-mode ha-params åŠŸèƒ½     all ç©º é•œåƒé˜Ÿåˆ—å°†ä¼šåœ¨æ•´ä¸ªé›†ç¾¤ä¸­å¤åˆ¶ã€‚å½“ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹åŠ å…¥åï¼Œä¹Ÿä¼šåœ¨è¿™ ä¸ªèŠ‚ç‚¹ä¸Šå¤åˆ¶ä¸€ä»½ã€‚   exactly count é•œåƒé˜Ÿåˆ—å°†ä¼šåœ¨é›†ç¾¤ä¸Šå¤åˆ¶ count ä»½ã€‚å¦‚æœé›†ç¾¤æ•°é‡å°‘äº count æ—¶å€™ï¼Œé˜Ÿåˆ—ä¼šå¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Šã€‚å¦‚æœå¤§äº Count é›†ç¾¤ï¼Œæœ‰ä¸€ä¸ªèŠ‚ç‚¹ crash åï¼Œæ–°è¿›å…¥èŠ‚ç‚¹ä¹Ÿä¸ä¼šåšæ–°çš„é•œåƒã€‚   nodes node name é•œåƒé˜Ÿåˆ—ä¼šåœ¨ node name ä¸­å¤åˆ¶ã€‚å¦‚æœè¿™ä¸ªåç§°ä¸æ˜¯é›†ç¾¤ä¸­çš„ä¸€ä¸ªï¼Œè¿™ä¸ä¼šè§¦å‘é”™è¯¯ã€‚å¦‚æœåœ¨è¿™ä¸ª node list ä¸­æ²¡æœ‰ä¸€ä¸ªèŠ‚ç‚¹åœ¨çº¿ï¼Œé‚£ä¹ˆè¿™ä¸ª queue ä¼šè¢«å£°æ˜åœ¨ client è¿æ¥çš„èŠ‚ç‚¹ã€‚    å››ã€WEBç®¡ç† 4.1ã€å¯ç”¨WEBç®¡ç†æ’ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  # å¯åŠ¨webç®¡ç†æ’ä»¶ âœ sbin/rabbitmq-plugins enable rabbitmq_management # å¯ç”¨æ’ä»¶åˆ—è¡¨ âœ sbin/rabbitmq-plugins list Listing plugins with pattern \u0026#34;.*\u0026#34; ... Configured: E = explicitly enabled; e = implicitly enabled | Status: * = running on rabbit@ty-db1 |/ [ ] rabbitmq_amqp1_0 3.8.2 [ ] rabbitmq_auth_backend_cache 3.8.2 [ ] rabbitmq_auth_backend_http 3.8.2 [ ] rabbitmq_auth_backend_ldap 3.8.2 [ ] rabbitmq_auth_backend_oauth2 3.8.2 [ ] rabbitmq_auth_mechanism_ssl 3.8.2 [ ] rabbitmq_consistent_hash_exchange 3.8.2 [ ] rabbitmq_event_exchange 3.8.2 [ ] rabbitmq_federation 3.8.2 [ ] rabbitmq_federation_management 3.8.2 [ ] rabbitmq_jms_topic_exchange 3.8.2 [E*] rabbitmq_management 3.8.2 # E æ˜¾å¼å¯ç”¨ [e*] rabbitmq_management_agent 3.8.2 # e éšå¼å¯ç”¨ # å¢åŠ ç”¨æˆ· \u0026amp;\u0026amp; è®¾ç½®ç”¨æˆ·è§’è‰² âœ sbin/rabbitmqctl add_user ahy ahy # æ‰§è¡Œä¸€é âœ sbin/rabbitmqctl set_user_tags ahy administrator # æ‰§è¡Œä¸€é   4.2ã€è®¿é—®ç®¡ç†ç•Œé¢ 1 2 3 4  âœ ss -tnlp | grep 5672 LISTEN 0 128 *:25672 *:* users:((\u0026#34;beam.smp\u0026#34;,pid=3593,fd=77)) LISTEN 0 128 *:15672 *:* users:((\u0026#34;beam.smp\u0026#34;,pid=3593,fd=93)) LISTEN 0 128 :::5672 :::* users:((\u0026#34;beam.smp\u0026#34;,pid=3593,fd=92))   æ‰“å¼€æµè§ˆå™¨è®¿é—®http://nodeip:15672, ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„ç”¨æˆ·ç™»å½•å³å¯\näº”ã€è´Ÿè½½å‡è¡¡ æˆ‘ä»¬è¿™é‡Œç”¨haproxyåšè´Ÿè½½å‡è¡¡\n5.1ã€å¢åŠ VIP 1 2 3 4 5 6 7 8 9  âœ ip addr add 192.168.100.242/24 dev eth0:mq âœ ip a 2: eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 5a:fd:bf:c3:43:ec brd ff:ff:ff:ff:ff:ff inet 192.168.100.217/24 brd 192.168.100.255 scope global noprefixroute eth0 valid_lft forever preferred_lft forever inet 192.168.100.242/24 scope global secondary eth0 valid_lft forever preferred_lft forever   5.2ã€é…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43  âœ vim /opt/rabbitmq_server-3.8.2/etc/haproxy.cnf global log 127.0.0.1 local0 info log 127.0.0.1 local1 notice daemon maxconn 4096 defaults log global mode tcp option tcplog option dontlognull retries 3 option abortonclose maxconn 4096 timeout connect 5000ms timeout client 3000ms timeout server 3000ms balance roundrobin listen private_monitoring bind 192.168.100.242:8100 mode http option httplog stats refresh 5s stats uri /stats stats realm Haproxy stats auth admin:admin listen rabbitmq_cluster bind 192.168.100.242:8101 mode tcp option tcplog balance roundrobin server MQ1 192.168.100.217:5672 check inter 5000 rise 2 fall 3 server MQ2 192.168.100.218:5672 check inter 5000 rise 2 fall 3 server MQ3 192.168.100.219:5672 check inter 5000 rise 2 fall 3 listen rabbitmq_admin bind 192.168.100.242:8102 server MQ1 192.168.100.217:15672 server MQ2 192.168.100.218:15672 server MQ3 192.168.100.219:15672   5.3ã€å¯åŠ¨haproxy 1  âœ haproxy -f /opt/rabbitmq_server-3.8.2/etc/haproxy.cnf    å‚è€ƒé“¾æ¥:\n1ã€å®˜æ–¹äºŒè¿›åˆ¶æ‰‹å†Œ\n2ã€å®˜æ–¹é›†ç¾¤æ‰‹å†Œ\n3ã€https://www.jianshu.com/p/97fbf9c82872\n4ã€https://my.oschina.net/genghz/blog/1840262\n5ã€https://www.jianshu.com/p/d55fcee12918\n6ã€https://www.jianshu.com/p/7cf2ad01c422\n7ã€https://blog.csdn.net/yujin2010good/article/details/73614507\n8ã€http://www.haproxy.org/\n9ã€https://blog.csdn.net/winy_lm/article/details/81128181\n10ã€https://www.cnblogs.com/knowledgesea/p/6535766.html\n ","description":"","id":9,"section":"ops","tags":["æ¶ˆæ¯é˜Ÿåˆ—","rabbit MQ","haproxy"],"title":"éƒ¨ç½²rabbitMQé•œåƒé›†ç¾¤","uri":"http://localhost:1818/ops/deploy/%E9%83%A8%E7%BD%B2rabbitmq%E9%95%9C%E5%83%8F%E9%9B%86%E7%BE%A4/"},{"content":"ä¸€ã€ç¯å¢ƒå‡†å¤‡ 1 2 3 4  $ wget https://github.com/strapdata/elassandra/releases/download/v6.2.3.22/elassandra-6.2.3.22.tar.gz $ tar -zxvf elassandra-6.2.3.22.tar.gz $ useradd elassandra $ chown -R elassandra:elassandra elassandra-6.2.3.22   äºŒã€é…ç½®éƒ¨ç½² 2.1ã€ç›®å½•ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  $ su - elassandra #åˆ‡æ¢ç”¨æˆ· $ cd /opt/elassandra-6.2.3.22 #è¿›å…¥å·¥ä½œè·¯å¾„ $ ls -rtl total 264 -rw-r--r--. 1 elassandra elassandra 12319 Dec 11 17:51 README.md -rw-r--r--. 1 elassandra elassandra 11358 Dec 11 17:51 LICENSE.txt -rw-r--r--. 1 elassandra elassandra 21612 Dec 11 17:51 CHANGES.txt -rw-r--r--. 1 elassandra elassandra 194935 Dec 11 18:19 NOTICE.txt drwxr-xr-x. 2 elassandra elassandra 6 Dec 11 18:20 plugins drwxr-xr-x. 3 elassandra elassandra 94 Dec 11 18:20 pylib drwxr-xr-x. 4 elassandra elassandra 135 Dec 11 18:20 tools drwxr-xr-x. 16 elassandra elassandra 4096 Dec 11 18:20 modules drwxr-xr-x. 4 elassandra elassandra 4096 Jan 2 00:39 lib drwxr-xr-x. 2 elassandra elassandra 4096 Jan 2 00:39 bin drwxr-xr-x. 3 elassandra elassandra 4096 Jan 2 02:30 conf drwxr-xr-x. 6 elassandra elassandra 68 Jan 2 02:33 data drwxr-xr-x. 2 elassandra elassandra 48 Jan 2 03:19 logs   2.2ã€ä¿®æ”¹limits.confæ–‡ä»¶ 1 2 3 4  $ vi /etc/security/limits.conf # allow user \u0026#39;elassandra\u0026#39; mlockall elassandra soft memlock unlimited elassandra hard memlock unlimited   2.3ã€ä¿®æ”¹.bash_profileæ–‡ä»¶ 1 2 3 4  $ vi ~/.bash_profile export CASSANDRA_HOME=/opt/elassandra-6.2.3.22 export CASSANDRA_CONF=/opt/elassandra-6.2.3.22/conf $ source ~/.bash_profile   2.4ã€Cassandraé…ç½®æ–‡ä»¶ 1 2 3 4 5 6 7 8 9  $ cat cassandra.yaml | grep -v ^# | grep -v ^$ cluster_name: \u0026#39;Test Cluster\u0026#39; seed_provider: - class_name: org.apache.cassandra.locator.SimpleSeedProvider parameters: - seeds: \u0026#34;192.168.100.217\u0026#34; listen_address: 192.168.100.217 rpc_address: 192.168.100.217 endpoint_snitch: GossipingPropertyFileSnitch   2.5ã€åˆ é™¤cassandraæ‹“æ‰‘ è¯¥æ–‡ä»¶å­˜åœ¨æ—¶GossipingPropertyFileSnitchå§‹ç»ˆåŠ è½½cassandra-topology.properties\n1  $ mv cassandra-topology.properties topology   ä¸‰ã€å¯åŠ¨éªŒè¯ 3.1ã€å¯åŠ¨ 1 2 3  # -e é€‰é¡¹å¯åŠ¨ elasticsearch, å¦åˆ™åªå¯åŠ¨ cassandra # -f é€‰é¡¹å¯åŠ¨åœ¨å‰å°, å¦åˆ™å¯åŠ¨åœ¨åå° $ bin/cassandra -e -f   3.2ã€éªŒè¯ 1 2 3 4 5 6 7  $ bin/nodetool status Datacenter: DC1 =============== Status=Up/Down |/ State=Normal/Leaving/Joining/Moving -- Address Load Tokens Owns (effective) Host ID Rack UN 192.168.100.217 70.86 KiB 8 100.0% 3eca39ee-614e-44be-8dc3-24a57e258588 r1    å‚è€ƒæ–‡æ¡£ï¼š\n1ã€https://www.strapdata.com/blog/?__hstc=45866619.604d7d24da3130719d6ad13e1d96868c.1577946442157.1577946442157.1577946442157.1\u0026amp;__hssc=45866619.1.1577946442157\u0026amp;__hsfp=156548688\u0026amp;_ga=2.21459963.1978597677.1577946441-1461110499.1577946441\n2ã€https://medium.com/rahasak/deploy-multi-data-center-elassandra-cluster-c6cb4abf50d1\n3ã€http://opensourceforu.com/2017/07/elassandra-to-leverage-huge-data-stack/\n ","description":"","id":10,"section":"ops","tags":["elasticsearch","Cassandra","elassandra","æœç´¢å¼•æ“","æœåŠ¡éƒ¨ç½²"],"title":"éƒ¨ç½²ä½¿ç”¨elassandra","uri":"http://localhost:1818/ops/deploy/%E9%83%A8%E7%BD%B2elassandra/"},{"content":"é¦–å…ˆè®²ä¸€ä¸‹ä½¿ç”¨OpenVPNèƒ½ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆ\n1ã€å†…ç½‘ç©¿é€æ˜¯è¯´ä½ å›åˆ°å®¶ä¸­ï¼Œé€šè¿‡å¼€è¾Ÿä¸€æ¡åŠ å¯†éš§é“ï¼Œç›´æ¥åœ¨å®¶é‡Œè®¿é—®å…¬å¸å†…ç½‘ï¼Œè·Ÿä½ åœ¨å…¬å¸è®¿é—®å†…éƒ¨æœåŠ¡ä¸€ä¸ªæ•ˆæœã€‚\n2ã€å…¬ç½‘ç©¿é€æ˜¯è¯´ä½¿ç”¨åŠ å¯†éš§é“è®¿é—®å…¬å¸ç”Ÿäº§ç½‘ç»œï¼Œè¿™æ ·åšå¸¦æ¥çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥å°†æš´éœ²åœ¨äº’è”ç½‘ä¸Šçš„å¤§éƒ¨åˆ†ç«¯å£å°æ‰ï¼Œä½¿ç”¨å†…ç½‘çš„æ–¹å¼è®¿é—®ç”Ÿäº§ï¼Œå¯ä»¥ä¿è¯æˆ‘ä»¬çš„ç½‘ç»œå®‰å…¨ã€‚\nä»¥ä¸Šè¯´çš„ç©¿é€ä¸»è¦åŸºäºNATç½‘ç»œåœ°å€è½¬æ¢ã€‚\næˆ‘ä»¬åœ¨CentOS7ä¸‹å®‰è£…OpenVPNï¼ŒOpenVPNä½¿ç”¨ä»¥ä¸‹ç‰ˆæœ¬\neasy-rsa.noarch 0:3.0.6-1.el7\ropenvpn.x86_64 0:2.4.8-1.el7\rä¸€ã€éƒ¨ç½² OpenVPN 1.1ã€å…³é—­selinux 1 2  âœ setenforce 0 âœ sed -i \u0026#39;/^SELINUX=/c\\SELINUX=disabled\u0026#39; /etc/selinux/config   1.2ã€æ·»åŠ EPELæ‰©å±•åº“ 1 2 3 4 5 6 7  âœ /etc/yum.repos.d/aliyun.repo [aliyun-epel] name=aliyun-epel-CentOS$releasever enabled=1 baseurl=http://mirrors.aliyun.com/epel/$releasever/$basearch/ gpgcheck=1 gpgkey=http://mirrors.aliyun.com/epel/RPM-GPG-KEY-EPEL-7   1.3ã€å®‰è£…æ‰€éœ€ä¾èµ–è½¯ä»¶åŒ… 1  âœ yum install -y openssl openssl-devel lzo lzo-devel pam pam-devel automake pkgconfig   1.4ã€å®‰è£…OpenVPNå’ŒEasy-Rsa 1  âœ yum -y install openvpn easy-rsa   1.5ã€å°†easy-rsaæ‹·è´è‡³openvpnä¸‹ 1  âœ cp -r /usr/share/easy-rsa/ /etc/openvpn/   äºŒã€é…ç½® OpenVPN 2.1ã€openvpnç¨‹åºæ ‘çŠ¶å›¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  âœ tree openvpn openvpn â”œâ”€â”€ client â”œâ”€â”€ easy-rsa â”‚Â â”œâ”€â”€ 3 -\u0026gt; 3.0.6 â”‚Â â”œâ”€â”€ 3.0 -\u0026gt; 3.0.6 â”‚Â â””â”€â”€ 3.0.6 â”‚Â â”œâ”€â”€ easyrsa â”‚Â â”œâ”€â”€ openssl-easyrsa.cnf â”‚Â â””â”€â”€ x509-types â”‚Â â”œâ”€â”€ ca â”‚Â â”œâ”€â”€ client â”‚Â â”œâ”€â”€ code-signing â”‚Â â”œâ”€â”€ COMMON â”‚Â â”œâ”€â”€ server â”‚Â â””â”€â”€ serverClient â””â”€â”€ server   2.2ã€ç”ŸæˆCAæ ¹è¯ä¹¦ 1 2 3 4 5 6 7 8 9 10 11  âœ cd /etc/openvpn/easy-rsa/3.0.6/ âœ vim vars export CA_EXPIRE=\u0026#34;3650\u0026#34; # å®šä¹‰CAè¯ä¹¦çš„æœ‰æ•ˆæœŸï¼Œé»˜è®¤æ˜¯3650å¤©ï¼Œå³10å¹´ã€‚ export KEY_EXPIRE=\u0026#34;3650\u0026#34; # å®šä¹‰å¯†é’¥çš„æœ‰æ•ˆæœŸï¼Œé»˜è®¤æ˜¯3650å¤©ï¼Œå³10å¹´ã€‚ export KEY_COUNTRY=\u0026#34;CN\u0026#34; # å®šä¹‰æ‰€åœ¨çš„å›½å®¶ã€‚ export KEY_PROVINCE=\u0026#34;ShanDong\u0026#34; # å®šä¹‰æ‰€åœ¨çš„çœä»½ã€‚ export KEY_CITY=\u0026#34;JiNan\u0026#34; # å®šä¹‰æ‰€åœ¨çš„åŸå¸‚ã€‚ export KEY_ORG=\u0026#34;AiHangYun\u0026#34; # å®šä¹‰æ‰€åœ¨çš„ç»„ç»‡ã€‚ export KEY_EMAIL=\u0026#34;i@miaocf.com\u0026#34; # å®šä¹‰é‚®ç®±åœ°å€ã€‚ export KEY_OU=\u0026#34;AH_OPS\u0026#34; # å®šä¹‰æ‰€åœ¨çš„å•ä½ã€‚ export KEY_NAME=\u0026#34;ZAX_Server\u0026#34; # å®šä¹‰openvpnæœåŠ¡å™¨çš„åç§°ã€‚   åˆå§‹åŒ–ç¯å¢ƒå˜é‡\n1  âœ source ./vars   ç”ŸæˆæœåŠ¡å™¨ç«¯CAè¯ä¹¦æ ¹è¯ä¹¦ca.crtå’Œæ ¹å¯†é’¥ca.keyï¼Œç”±äºåœ¨varsæ–‡ä»¶ä¸­åšè¿‡ç¼ºçœè®¾ç½®ï¼Œåœ¨å‡ºç°äº¤äº’ç•Œé¢æ—¶ï¼Œç›´æ¥ä¸€è·¯å›è½¦å³å¯\n1 2  âœ ./easyrsa init-pki âœ ./easyrsa build-ca   ä¸ºæœåŠ¡ç«¯ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥(ä¸€è·¯æŒ‰å›è½¦ï¼Œç›´åˆ°æç¤ºéœ€è¦è¾“å…¥y/næ—¶ï¼Œè¾“å…¥yå†æŒ‰å›è½¦ï¼Œä¸€å…±ä¸¤æ¬¡)\n1  âœ ./easyrsa build-server-full server nopass   2.3ã€ç”Ÿæˆ Diffie-Hellman ç®—æ³•éœ€è¦çš„å¯†é’¥æ–‡ä»¶, ç”Ÿæˆè¿‡ç¨‹è¾ƒæ…¢ 1  âœ ./easyrsa gen-dh   2.4ã€ç”Ÿæˆ tls-auth key è¿™ä¸ª key ä¸»è¦ç”¨äºé˜²æ­¢ DoS å’Œ TLS æ”»å‡»ï¼Œè¿™ä¸€æ­¥å…¶å®æ˜¯å¯é€‰çš„ï¼Œä½†ä¸ºäº†å®‰å…¨è¿˜æ˜¯ç”Ÿæˆä¸€ä¸‹ï¼Œè¯¥æ–‡ä»¶åœ¨åé¢é…ç½® open VPN æ—¶ä¼šç”¨åˆ°ã€‚\n1  âœ openvpn --genkey --secret ta.key   2.5ã€è¯ä¹¦æ•´ç† å°†ä¸Šé¢ç”Ÿæˆçš„ç›¸å…³è¯ä¹¦æ–‡ä»¶æ•´ç†åˆ° /etc/openvpn/server/certs\n1 2 3 4 5 6  âœ mkdir /etc/openvpn/server/certs \u0026amp;\u0026amp; cd /etc/openvpn/server/certs/ âœ cp /etc/openvpn/easy-rsa/3/pki/dh.pem ./ # SSL åå•†æ—¶ Diffie-Hellman ç®—æ³•éœ€è¦çš„ key âœ cp /etc/openvpn/easy-rsa/3/pki/ca.crt ./ # CA æ ¹è¯ä¹¦ âœ cp /etc/openvpn/easy-rsa/3/pki/issued/server.crt ./ # open VPN æœåŠ¡å™¨è¯ä¹¦ âœ cp /etc/openvpn/easy-rsa/3/pki/private/server.key ./ # open VPN æœåŠ¡å™¨è¯ä¹¦ key âœ cp /etc/openvpn/easy-rsa/3/ta.key ./ # tls-auth key   2.6ã€åˆ›å»º open VPN æ—¥å¿—ç›®å½• 1 2  âœ mkdir -p /var/log/openvpn/ âœ chown openvpn:openvpn /var/log/openvpn   2.7ã€é…ç½® OpenVPN 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  âœ cat /etc/openvpn/server.conf port 57678 # ç›‘å¬çš„ç«¯å£å· proto udp # æœåŠ¡ç«¯ç”¨çš„åè®®ï¼Œudp èƒ½å¿«ç‚¹ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹© udp dev tun ca /etc/openvpn/server/certs/ca.crt # CA æ ¹è¯ä¹¦è·¯å¾„ cert /etc/openvpn/server/certs/server.crt # OpenVPN æœåŠ¡å™¨è¯ä¹¦è·¯å¾„ key /etc/openvpn/server/certs/server.key # OpenVPN æœåŠ¡å™¨å¯†é’¥è·¯å¾„ï¼ŒThis file should be kept secret dh /etc/openvpn/server/certs/dh.pem # Diffie-Hellman ç®—æ³•å¯†é’¥æ–‡ä»¶è·¯å¾„ tls-auth /etc/openvpn/server/certs/ta.key 0 # tls-auth keyï¼Œå‚æ•°0å¯ä»¥çœç•¥ï¼Œå¦‚æœä¸çœç•¥ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯é…ç½®ç›¸åº”çš„å‚æ•°è¯¥é…æˆ 1ã€‚å¦‚æœçœç•¥ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¸éœ€è¦ tls-auth é…ç½® server 10.8.0.0 255.255.255.0 # è¯¥ç½‘æ®µä¸º OpenVPN è™šæ‹Ÿç½‘å¡ç½‘æ®µï¼Œä¸è¦å’Œå†…ç½‘ç½‘æ®µå†²çªå³å¯ã€‚OpenVPN é»˜è®¤ä¸º 10.8.0.0/24 push \u0026#34;dhcp-option DNS 8.8.8.8\u0026#34; # DNS æœåŠ¡å™¨é…ç½®ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æŒ‡å®šå…¶ä»– ns push \u0026#34;dhcp-option DNS 8.8.4.4\u0026#34; push \u0026#34;route 172.19.0.0 255.255.0.0\u0026#34; # å½“å®¢æˆ·ç«¯æ‰“å¼€ OpenVPN è¿æ¥åï¼Œæ‰€æœ‰è®¿é—®172.19.0.0/24ç½‘æ®µçš„æµé‡éƒ½ä¼šè¢«ä»£ç†è½¬å‘ #push \u0026#34;redirect-gateway def1\u0026#34; # å®¢æˆ·ç«¯æ‰€æœ‰æµé‡éƒ½é€šè¿‡ OpenVPN è½¬å‘ï¼Œç±»ä¼¼äºä»£ç†å¼€å…¨å±€ compress lzo #duplicate-cn # å…è®¸ä¸€ä¸ªç”¨æˆ·å¤šä¸ªç»ˆç«¯è¿æ¥ #max-clients 1 keepalive 10 120 comp-lzo persist-key persist-tun user openvpn # OpenVPN è¿›ç¨‹å¯åŠ¨ç”¨æˆ·ï¼Œopenvpn ç”¨æˆ·åœ¨å®‰è£…å®Œ openvpn åå°±è‡ªåŠ¨ç”Ÿæˆäº† group openvpn log /var/log/openvpn/server.log # æŒ‡å®š log æ–‡ä»¶ä½ç½® log-append /var/log/openvpn/server.log status /var/log/openvpn/status.log verb 3 explicit-exit-notify 1   2.8ã€æ¸…ç†æ‰€æœ‰é˜²ç«å¢™è§„åˆ™ 1  âœ iptables -F   2.9ã€æ·»åŠ  SNAT å°†OpenVPNçš„ç½‘ç»œæµé‡è½¬å‘åˆ°å…¬ç½‘\n1 2 3 4 5 6 7 8 9  #âœ iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -j MASQUERADE âœ iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -p tcp -m multiport --dports 22,3306,4006,7777,6379,9100,9200,15672,28018 -j MASQUERADE âœ iptables-save \u0026gt; /etc/sysconfig/iptables # iptables è§„åˆ™æŒä¹…åŒ–ä¿å­˜ # å°†iptablesè§„åˆ™è®¾ç½®ä¸ºå¼€æœºè‡ªåŠ¨å¯¼å…¥ âœ vim /etc/rc.local iptables -F -t nat iptables -F iptables-restore \u0026lt; /etc/sysconfig/iptables   2.10ã€Linux æœåŠ¡å™¨å¯ç”¨æ ¸å¿ƒè½¬å‘ 1 2 3 4  # å¯ç”¨æ ¸å¿ƒè½¬å‘ âœ echo net.ipv4.ip_forward = 1 \u0026gt;\u0026gt; /etc/sysctl.conf # åˆ·æ–°å†…æ ¸ âœ sysctl -p   ä¸‰ã€å¯åŠ¨ OpenVPN 1  âœ systemctl start openvpn@server   å››ã€è¿æ¥ OpenVPN ä»¥ä¸Šè¿‡ç¨‹å·²ç»å°† OpenVPN æœåŠ¡ç«¯æ­å»ºå¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦ä½¿ç”¨å®¢æˆ·ç«¯å·¥å…·ä»¥åŠç”¨æˆ·è¯ä¹¦è¿æ¥ OpenVPNæœåŠ¡ç«¯è¿›è¡Œæµé‡ä»£ç†ã€‚\nåœ¨Macä¸‹æ¨èä½¿ç”¨ Tunnelblickï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€æºã€å…è´¹çš„Macç‰ˆ OpenVPNå®¢æˆ·ç«¯è½¯ä»¶\nä¸‹è½½åœ°å€ï¼šhttps://tunnelblick.net/downloads.html\nWindowsä¸‹ä½¿ç”¨å®˜æ–¹æä¾›çš„å®¢æˆ·ç«¯å·¥å…·å³å¯\nä¸‹è½½åœ°å€ï¼šhttps://openvpn.net/community-downloads/\n4.1ã€å¢åŠ ä¸€ä¸ªç”¨æˆ· æ¥ä¸‹æ¥åœ¨æœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªOpenVPNç”¨æˆ·ï¼šå…¶å®åˆ›å»ºç”¨æˆ·çš„è¿‡ç¨‹å°±æ˜¯é€šè¿‡æœåŠ¡ç«¯CAè¯ä¹¦è‡ªç­¾å®¢æˆ·ç«¯è¯ä¹¦çš„è¿‡ç¨‹ï¼Œç„¶åå°†å…¶ä»–çš„è¯ä¹¦æ–‡ä»¶ã€keyã€.ovpn(å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶)æ‰“åŒ…åˆ°ä¸€èµ·ä¾›å®¢æˆ·ç«¯ä½¿ç”¨ã€‚\nç”±äºåˆ›å»ºä¸€ä¸ªç”¨æˆ·çš„è¿‡ç¨‹æ¯”è¾ƒç¹çï¼Œæ‰€ä»¥åœ¨æ­¤å°†æ•´ä¸ªè¿‡ç¨‹å†™æˆäº†ä¸€ä¸ªè„šæœ¬ï¼Œè„šæœ¬é€šè¿‡ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶ç”Ÿæˆæ–°çš„ovpnæ–‡ä»¶ï¼Œä»¥åŠä¸€ç³»åˆ—ç”¨æˆ·ç›¸å…³è¯ä¹¦åæ‰“æˆå‹ç¼©åŒ…ã€‚\n4.1.1ã€ovpnæ¨¡æ¿æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  âœ cat sample.ovpn client proto udp dev tun remote [æ¢æˆä½ çš„å…¬ç½‘åœ°å€ï¼Œå³OpenVPNæœåŠ¡ç«¯æ‰€åœ¨åœ°å€] 57678 ca ca.crt cert admin.crt key admin.key tls-auth ta.key 1 remote-cert-tls server persist-tun persist-key comp-lzo verb 3 mute-replay-warnings   4.1.2ã€ovpn_user.sh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  âœ vim ovpn_user.sh # ! /bin/bash set -e OVPN_USER_KEYS_DIR=/etc/openvpn/client/keys EASY_WorkDir=/etc/openvpn/easy-rsa/3 PKI_DIR=$EASY_WorkDir/pki for user in \u0026#34;$@\u0026#34; do if [ -d \u0026#34;$OVPN_USER_KEYS_DIR/$user\u0026#34; ]; then rm -rf $OVPN_USER_KEYS_DIR/$user rm -rf $PKI_DIR/reqs/$user.req sed -i \u0026#39;/\u0026#39;\u0026#34;$user\u0026#34;\u0026#39;/d\u0026#39; $PKI_DIR/index.txt fi cd $EASY_WorkDir # ç”Ÿæˆå®¢æˆ·ç«¯ ssl è¯ä¹¦æ–‡ä»¶ ./easyrsa build-client-full $user # æ•´ç†ä¸‹ç”Ÿæˆçš„æ–‡ä»¶ mkdir -p $OVPN_USER_KEYS_DIR/$user cp $PKI_DIR/ca.crt $OVPN_USER_KEYS_DIR/$user/ # CA æ ¹è¯ä¹¦ cp $PKI_DIR/issued/$user.crt $OVPN_USER_KEYS_DIR/$user/ # å®¢æˆ·ç«¯è¯ä¹¦ cp $PKI_DIR/private/$user.key $OVPN_USER_KEYS_DIR/$user/ # å®¢æˆ·ç«¯è¯ä¹¦å¯†é’¥ cp /etc/openvpn/server/certs/ta.key $OVPN_USER_KEYS_DIR/$user/ta.key # auth-tls æ–‡ä»¶ cp /etc/openvpn/client/sample.ovpn $OVPN_USER_KEYS_DIR/$user/$user.ovpn # å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ # æ›¿æ¢æ¨¡æ¿æ–‡ä»¶ä¸­çš„ç”¨æˆ· sed -i \u0026#39;s/admin/\u0026#39;\u0026#34;$user\u0026#34;\u0026#39;/g\u0026#39; $OVPN_USER_KEYS_DIR/$user/$user.ovpn # ç”Ÿæˆå‹ç¼©åŒ… cd $OVPN_USER_KEYS_DIR zip -r $user.zip $user # æ‹·è´å‹ç¼©åŒ…è‡³ç”¨æˆ·ç›®å½•ä»¥ä¸‹è½½ cp $user.zip /home/miaocunfa chown miaocunfa:miaocunfa /home/miaocunfa/$user.zip done exit 0   4.1.3ã€è„šæœ¬ä½¿ç”¨è¯­æ³• 1  âœ ./ovpn_user.sh \u0026lt;username\u0026gt;   4.1.4ã€ç”Ÿæˆå‹ç¼©åŒ… ä½¿ç”¨ååœ¨/etc/openvpn/client/keysæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ªä»¥usernameå‘½åçš„zipæ–‡ä»¶ï¼Œå°†æ­¤å‹ç¼©åŒ…ä¸‹è½½ä½¿ç”¨ã€‚\n1 2 3 4 5 6 7  # å‹ç¼©åŒ…ä¸­å­˜åœ¨ä¸‹åˆ—æ–‡ä»¶ . â”œâ”€â”€ ca.crt â”œâ”€â”€ username.crt â”œâ”€â”€ username.key â”œâ”€â”€ username.ovpn â””â”€â”€ ta.key   4.1.5ã€ä½¿ç”¨å®¢æˆ·ç«¯ å½“æˆ‘ä»¬åœ¨windowsä¸Šä½¿ç”¨OpenVPN GUIæ—¶ï¼Œæ­¤å®¢æˆ·ç«¯éœ€è¦é»˜è®¤å®‰è£…ï¼Œæˆ‘ä»¬éœ€è¦å°†åˆšæ‰ä¸‹è½½çš„å‹ç¼©åŒ…ä¸­çš„æ‰€æœ‰æ–‡ä»¶æ‹·è´è‡³C:\\Program Files\\OpenVPN\\configä¸­ï¼Œç„¶åå³å¯ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥OpenVPNæœåŠ¡ç«¯äº†ã€‚\n4.2ã€åˆ é™¤ä¸€ä¸ªç”¨æˆ· ä¸Šé¢æˆ‘ä»¬çŸ¥é“äº†å¦‚ä½•æ·»åŠ ä¸€ä¸ªç”¨æˆ·ï¼Œé‚£ä¹ˆå¦‚æœå…¬å¸å‘˜å·¥ç¦»èŒäº†æˆ–è€…å…¶ä»–åŸå› ï¼Œæƒ³åˆ é™¤å¯¹åº”ç”¨æˆ· OpenVPN çš„ä½¿ç”¨æƒï¼Œè¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿå…¶å®å¾ˆç®€å•ï¼ŒOpenVPN çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„è®¤è¯ä¸»è¦é€šè¿‡ SSL è¯ä¹¦è¿›è¡ŒåŒå‘è®¤è¯ï¼Œæ‰€ä»¥åªè¦åŠé”€å¯¹åº”ç”¨æˆ·çš„ SSL è¯ä¹¦å³å¯ã€‚\n4.2.1ã€åŠé”€ç”¨æˆ·è¯ä¹¦ï¼Œå‡è®¾è¦åŠé”€çš„ç”¨æˆ·åä¸º username 1 2 3 4 5 6 7 8 9  âœ cd /etc/openvpn/easy-rsa/3/ âœ ./easyrsa revoke username Revocation was successful. You must run gen-crl and upload a CRL to your # åŠé”€è¯ä¹¦åå¿…é¡»æ‰§è¡Œgen-crlç”Ÿæˆcrlæ–‡ä»¶ infrastructure in order to prevent the revoked cert from being accepted. # æ¯æ¬¡æ‰§è¡Œrevokeï¼Œéƒ½è¦é‡æ–°ç”Ÿæˆcrl.pemæ–‡ä»¶ âœ ./easyrsa gen-crl An updated CRL has been created. CRL file: /etc/openvpn/easy-rsa/3/pki/crl.pem # CRLæ–‡ä»¶è·¯å¾„   4.2.2ã€ç¼–è¾‘ OpenVPN æœåŠ¡ç«¯é…ç½® server.conf æ·»åŠ å¦‚ä¸‹é…ç½® 1 2 3  âœ vim server.conf # æ·»åŠ  crlæ–‡ä»¶ crl-verify /etc/openvpn/easy-rsa/3/pki/crl.pem   4.2.3ã€é‡å¯ OpenVPN æœåŠ¡ç«¯ä½¿å…¶ç”Ÿæ•ˆ 1  âœ systemctl start openvpn@server   4.2.4ã€ä¸€é”®åˆ é™¤ç”¨æˆ· ä¸ºäº†æ–¹ä¾¿ï¼Œä¹Ÿå°†ä¸Šé¢æ­¥éª¤æ•´ç†æˆäº†ä¸€ä¸ªè„šæœ¬ del_ovpn_user.sh\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  âœ vim del_ovpn_user.sh # ! /bin/bash set -e OVPN_USER_KEYS_DIR=/etc/openvpn/client/keys EASY_WorkDir=/etc/openvpn/easy-rsa/3 for user in \u0026#34;$@\u0026#34; do cd $EASY_WorkDir echo -e \u0026#39;yes\\n\u0026#39; | ./easyrsa revoke $user ./easyrsa gen-crl # åŠé”€æ‰è¯ä¹¦åæ¸…ç†å®¢æˆ·ç«¯ç›¸å…³æ–‡ä»¶ if [ -d \u0026#34;$OVPN_USER_KEYS_DIR/$user\u0026#34; ]; then rm -rf $OVPN_USER_KEYS_DIR/${user}* fi systemctl restart openvpn@server done exit 0   4.2.5ã€è„šæœ¬ä½¿ç”¨è¯­æ³• 1  âœ ./del_ovpn_user.sh \u0026lt;username\u0026gt;    å‚è€ƒåˆ—è¡¨ï¼š\n1ã€https://qhh.me/2019/06/16/Cenos7-%E4%B8%8B%E6%90%AD%E5%BB%BA-OpenVPN-%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/\n2ã€https://www.hi-linux.com/posts/43594.html\n ","description":"","id":11,"section":"ops","tags":["OpenVPN","å†…ç½‘ç©¿é€","å…¬ç½‘ç©¿é€","åŠ å¯†éš§é“"],"title":"ä½¿ç”¨OpenVPNè¿›è¡Œå†…ç½‘ç©¿é€ä¸å…¬ç½‘ç©¿é€","uri":"http://localhost:1818/ops/network/%E4%BD%BF%E7%94%A8openvpn%E8%BF%9B%E8%A1%8C%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E4%B8%8E%E5%85%AC%E7%BD%91%E7%A9%BF%E9%80%8F/"},{"content":"ä¸€ã€ç¯å¢ƒå‡†å¤‡ 1.1ã€ä¸‹è½½äºŒè¿›åˆ¶æºç åŒ… 1  wget http://apache.mirrors.hoobly.com/cassandra/3.11.5/apache-cassandra-3.11.5-bin.tar.gz   1.2ã€èŠ‚ç‚¹å‡†å¤‡ 1 2 3 4 5 6 7 8 9 10 11 12  # å‡†å¤‡ä¸‰å°èŠ‚ç‚¹ 192.168.100.226 192.168.100.227 192.168.100.228 # ansibleé…ç½® # å› ä¸ºæ˜¯æµ‹è¯•ç¯å¢ƒï¼Œè¿™é‡Œå°±ç›´æ¥é…ç½®å¯†ç ï¼Œä¸å»éº»çƒ¦çš„é…ç½®å…å¯†éªŒè¯äº†ã€‚ [root@master ~]# cat /etc/ansible/hosts [casd] 192.168.100.226 ansible_ssh_user=\u0026#39;root\u0026#39; ansible_ssh_pass=\u0026#39;test123\u0026#39; 192.168.100.227 ansible_ssh_user=\u0026#39;root\u0026#39; ansible_ssh_pass=\u0026#39;test123\u0026#39; 192.168.100.228 ansible_ssh_user=\u0026#39;root\u0026#39; ansible_ssh_pass=\u0026#39;test123\u0026#39;   1.3ã€åˆ›å»º Cassandra ç”¨æˆ· 1 2 3 4 5 6 7 8 9 10 11  # åˆ›å»ºç”¨æˆ· ansible casd -m user -a \u0026#34;name=cassandra state=present\u0026#34; # ä¿®æ”¹å¯†ç  ansible casd -m shell -a \u0026#34;echo cassandra | passwd --stdin cassandra\u0026#34; # å°†cassandraäºŒè¿›åˆ¶åŒ…æ‹·è´åˆ°éƒ¨ç½²èŠ‚ç‚¹ä¸Šã€‚ ansible casd -m copy -a \u0026#34;src=apache-cassandra-3.11.5.tar.gz dest=/home/cassandra/apache-cassandra-3.11.5.tar.gz\u0026#34; # è§£å‹æºç åŒ… ansible casd -m shell -a \u0026#34;cd /home/cassandra/; tar -zxvf apache-cassandra-3.11.5.tar.gz\u0026#34;   1.4ã€Java ç¯å¢ƒå‡†å¤‡ 1 2 3 4 5 6 7 8 9 10 11 12  # æ‹·è´jdkè‡³éƒ¨ç½²èŠ‚ç‚¹ ansible casd -m copy -a \u0026#34;src=java-1.8.0-amazon-corretto-devel-1.8.0_212.b04-2.x86_64.rpm dest=/root\u0026#34; # å®‰è£…jdk ansible casd -m shell -a \u0026#34;yum install -y java-1.8.0-amazon-corretto-devel-1.8.0_212.b04-2.x86_64.rpm\u0026#34; # éªŒè¯jdk ``` bash [root@localhost ~]# java -version openjdk version \u0026#34;1.8.0_212\u0026#34; OpenJDK Runtime Environment Corretto-8.212.04.2 (build 1.8.0_212-b04) OpenJDK 64-Bit Server VM Corretto-8.212.04.2 (build 25.212-b04, mixed mode)   1.5ã€é…ç½®ç”¨æˆ·ç¯å¢ƒå˜é‡ 1 2 3 4 5 6 7 8 9 10 11 12  # åˆ‡æ¢ç”¨æˆ· [root@localhost ~]# su - cassandra  Last login: Fri Dec 6 04:27:53 EST 2019 on pts/1 # é…ç½®ç¯å¢ƒå˜é‡ [cassandra@localhost ~]$ vi .bash_profile export CASSANDRA_HOME=/home/cassandra/apache-cassandra-3.11.5 export JAVA_HOME=/usr/lib/jvm/java-1.8.0-amazon-corretto export PATH=$JAVA_HOME/bin:$CASSANDRA_HOME/bin:$PATH # åŠ è½½ç¯å¢ƒå˜é‡ [cassandra@localhost ~]$ source .bash_profile   äºŒã€éƒ¨ç½² Cassandra 2.1ã€é…ç½®æ–‡ä»¶ ä¿®æ”¹é…ç½®æ–‡ä»¶ /home/cassandra/apache-cassandra-3.11.5/conf/cassandra.yaml\n1 2 3 4 5 6 7 8 9 10 11 12  cluster_name:\u0026#39;test\u0026#39;data_file_directories:- /home/cassandra/apache-cassandra-3.11.5/datacommitlog_directory:/home/cassandra/apache-cassandra-3.11.5/data/commitlogsaved_caches_directory:/home/cassandra/apache-cassandra-3.11.5/data/saved_cachesseed_provider:- class_name:org.apache.cassandra.locator.SimpleSeedProviderparameters:- seeds:\u0026#34;192.168.100.226\u0026#34;# å› å­listen_address:192.168.100.226# ç›‘å¬åœ°å€ï¼Œä¸å¯ä»¥ä¸º127.0.0.1start_rpc:truerpc_address:192.168.100.226# rpcç›‘å¬åœ°å€ï¼Œä¸å¯ä»¥ä¸º127.0.0.1  2.2ã€å„èŠ‚ç‚¹ å„èŠ‚ç‚¹çš„ listen_address å’Œ rpc_address éœ€è¦æŒ‰èŠ‚ç‚¹é…ç½®ï¼Œä¸”ä¸èƒ½ä½¿ç”¨ localhostï¼Œå› å­ seeds é…ç½®ä¸ºç¬¬ä¸€ä¸ªå¯åŠ¨çš„èŠ‚ç‚¹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  First Node -------------- seeds: \u0026#34;192.168.100.226\u0026#34; listen_address: 192.168.100.226 rpc_address: 192.168.100.226 Second Node --------------- seeds: \u0026#34;192.168.100.226\u0026#34; listen_address: 192.168.100.227 rpc_address: 192.168.100.227 Third Node --------------- seeds: \u0026#34;192.168.100.226\u0026#34; listen_address: 192.168.100.228 rpc_address: 192.168.100.228   ä¸‰ã€å¯åŠ¨ Cassandra æœåŠ¡ 3.1ã€å¯åŠ¨æœåŠ¡ 1 2 3 4 5 6  # å…ˆå¯åŠ¨226, ä½¿ç”¨-fé€‰é¡¹å¯åŠ¨åœ¨å‰å° /home/cassandra/apache-cassandra-3.11.5/bin/cassandra # å†å¯åŠ¨å…¶ä½™çš„èŠ‚ç‚¹ /home/cassandra/apache-cassandra-3.11.5/bin/cassandra /home/cassandra/apache-cassandra-3.11.5/bin/cassandra   3.éªŒè¯æœåŠ¡ ä½¿ç”¨ nodetool status éªŒè¯æœåŠ¡\n1 2 3 4 5 6 7 8 9  [cassandra@localhost ~]$/home/cassandra/apache-cassandra-3.11.5/bin/nodetool status Datacenter: datacenter1 ======================= Status=Up/Down |/ State=Normal/Leaving/Joining/Moving -- Address Load Tokens Owns (effective) Host ID Rack UN 192.168.100.226 302.76 KiB 256 69.2% 723cb923-d19c-4dea-8124-c4503dab4d75 rack1 UN 192.168.100.227 295.05 KiB 256 66.3% 5bbeeb09-9bf4-4e45-a7a1-168e4f87186f rack1 UN 192.168.100.228 239.96 KiB 256 64.5% 78677dd0-797e-45b0-a34a-23842927af35 rack1   ","description":"","id":12,"section":"ops","tags":["Cassandra","NoSQL","æ•°æ®åº“"],"title":"éƒ¨ç½² Cassandra é›†ç¾¤","uri":"http://localhost:1818/ops/deploy/%E9%83%A8%E7%BD%B2cassandra%E9%9B%86%E7%BE%A4/"},{"content":"groupæ¨¡å—æ˜¯ç”¨æ¥æ·»åŠ æˆ–è€…åˆ é™¤ç»„\né¦–å…ˆä½¿ç”¨ansible-docæ¥æŸ¥çœ‹ç”¨æ³•\n1 2 3 4 5 6 7 8 9 10 11 12  [root@note0 ansible]# ansible-doc -s group - name: Add or remove groups group: gid: # Optional `GID\u0026#39; to set for the group. local: # Forces the use of \u0026#34;local\u0026#34; command alternatives on platforms that implement it. This is useful in environments that use centralized authentication when you want to manipulate the local groups. (e.g. it uses `lgroupadd\u0026#39; instead of `groupadd\u0026#39;). This requires that these commands exist on the targeted host, otherwise it will be a fatal error. name: # (required) Name of the group to manage. non_unique: # This option allows to change the group ID to a non-unique value. Requires `gid\u0026#39;. Not supported on macOS or BusyBox distributions. state: # Whether the group should be present or not on the remote host. system: # If `yes\u0026#39;, indicates that the group created is a system group.   é€šè¿‡ä¸Šé¢çš„å‚æ•°åˆ—è¡¨æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°groupæ¨¡å—æœ‰å‡ ä¸ªé‡è¦å±æ€§\nOPTIONS (= is mandatory):é€‰é¡¹å‰é¢ä¸º=çš„ä¸ºå¿…å¡«å‚æ•°\nä¸€ã€name = name\rName of the group to manage.\rtype: str\rè¦æ“ä½œçš„groupçš„ç»„åï¼Œstringç±»å‹ï¼Œå¿…å¡«é¡¹\r1.1ã€ç¤ºä¾‹ åˆ›å»ºä¸€ä¸ªåå­—ä¸ºtestçš„ç»„ã€‚\n1 2 3 4 5 6 7 8 9 10 11  [root@note0 ~]# ansible local -m group -a \u0026#34;name=test\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026lt;font color=\u0026#34;red\u0026#34;\u0026gt;\u0026#34;changed\u0026#34;: true,\u0026lt;/font\u0026gt;#å¯ä»¥çœ‹åˆ°changedçŠ¶æ€ä¸ºtrueï¼Œä»£è¡¨å·²ç»åœ¨ä¸»æœºæ·»åŠ ç»„æˆåŠŸã€‚ \u0026#34;gid\u0026#34;: 1000, \u0026#34;name\u0026#34;: \u0026#34;test\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;system\u0026#34;: false }   æŸ¥çœ‹ä¸»æœº/etc/groupæ–‡ä»¶éªŒè¯\n[root@note1 ~]# cat /etc/group\rtestâŒ1000:\räºŒã€state - state\rWhether the group should be present or not on the remote host.\r(Choices: absent, present)[Default: present]\rtype: str\rstateç”¨äºæŒ‡å®šç”¨æˆ·ç»„åœ¨è¿œç¨‹ä¸»æœºä¸Šæ˜¯å¦è¢«æ›´æ”¹æˆ–åˆ é™¤ï¼Œstringç±»å‹ã€‚\ræœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šabsentï¼Œpresentã€‚é»˜è®¤å€¼ä¸ºpresentï¼Œabsentä¸ºåˆ é™¤ç»„ã€‚\r2.1ã€ç¤ºä¾‹ æˆ‘ä»¬æ¥åˆ é™¤ä¸€ä¸‹åˆšæ‰åˆ›å»ºçš„ç»„ã€‚\n[root@note0 ~]# ansible local -m group -a \u0026quot;name=test state=absent\u0026quot;\r176.16.128.1 | CHANGED =\u0026gt; {\r\u0026quot;ansible_facts\u0026quot;: {\r\u0026quot;discovered_interpreter_python\u0026quot;: \u0026quot;/usr/bin/python\u0026quot;\r}, \u0026quot;changed\u0026quot;: true, \u0026quot;name\u0026quot;: \u0026quot;test\u0026quot;, \u0026quot;state\u0026quot;: \u0026quot;absent\u0026quot;\r}\rä¸‰ã€gid - gid\rOptional `GID' to set for the group.\r[Default: (null)]\rtype: int\rgidç”¨äºè®¾å®šç”¨æˆ·ç»„gidï¼Œintç±»å‹ï¼Œé»˜è®¤å€¼ä¸ºç©º\r3.1ã€ç¤ºä¾‹ åˆ›å»ºä¸€ä¸ªgidä¸º1005ï¼Œåå­—ä¸ºtestçš„ç»„ã€‚\n[root@note0 ~]# ansible local -m group -a \u0026quot;name=test gid=1005 state=present\u0026quot;\r176.16.128.1 | CHANGED =\u0026gt; {\r\u0026quot;ansible_facts\u0026quot;: {\r\u0026quot;discovered_interpreter_python\u0026quot;: \u0026quot;/usr/bin/python\u0026quot;\r}, \u0026quot;changed\u0026quot;: true, \u0026quot;gid\u0026quot;: 1005, \u0026quot;name\u0026quot;: \u0026quot;test\u0026quot;, \u0026quot;state\u0026quot;: \u0026quot;present\u0026quot;, \u0026quot;system\u0026quot;: false\r}\ræŸ¥çœ‹ä¸»æœº/etc/groupæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–°åˆ›å»ºçš„ç»„gidä¸º1005ã€‚\n[root@note1 ~]# cat /etc/group\rtestâŒ1005:\rå››ã€system - system\rIf `yes', indicates that the group created is a system group.\r[Default: False]\rtype: bool\rsystemç”¨äºæŒ‡å®šåˆ›å»ºçš„ç”¨æˆ·ç»„æ˜¯å¦ä¸ºç³»ç»Ÿç»„ï¼Œå¸ƒå°”ç±»å‹ï¼Œå¯ç”¨é€‰é¡¹falseï¼Œtrueï¼Œé»˜è®¤ä¸ºfalse\r4.1ã€ç¤ºä¾‹ åˆ›å»ºä¸€ä¸ªåå­—ä¸ºtestçš„ç³»ç»Ÿç»„ã€‚\n1 2 3 4 5 6 7 8 9 10 11  [root@note0 ~]# ansible local -m group -a \u0026#34;name=test state=present system=true\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;gid\u0026#34;: 994, \u0026#34;name\u0026#34;: \u0026#34;test\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;system\u0026#34;: true }   æŸ¥çœ‹ä¸»æœº/etc/groupæ–‡ä»¶éªŒè¯\n1 2  [root@note1 ~]# cat /etc/group testâŒ994:   å¯ä»¥çœ‹åˆ°testç»„çš„gidä¸º994ï¼Œgidå°äº1000ä¸ºç³»ç»Ÿç»„ã€‚\n","description":"","id":13,"section":"ops","tags":["ansible","è‡ªåŠ¨åŒ–è¿ç»´","DevOps"],"title":"è¿ç»´è‡ªåŠ¨åŒ–ç¥å™¨ Ansibleä¹‹Group(ä¸‰)","uri":"http://localhost:1818/ops/devops/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96%E7%A5%9E%E5%99%A8ansible%E4%B9%8Bgroup/"},{"content":"ä¸€ã€æ¦‚è¿° Â pingæ¨¡å— ç”¨æ¥æ£€æµ‹ä¸»æœºè¿é€šæ€§ã€‚\npingæ¨¡å—è¿”å›å€¼\nRETURN VALUES:\rping:\rdescription: value provided with the data parameter\rreturned: success\rtype: str\rsample: pong\rå› ä¸ºpingæ¨¡å—åªæ˜¯ç”¨æ¥æ£€æµ‹ä¸»æœºè¿é€šæ€§ï¼Œæ‰€ä»¥ä½¿ç”¨pingæ¨¡å—æ—¶æ˜¯ä¸éœ€è¦-aæŒ‡å®šå‚æ•°çš„ã€‚\näºŒã€ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10  [root@master01 ~]# ansible 172.31.194.117 -m ping /usr/lib/python2.7/site-packages/requests/__init__.py:91: RequestsDependencyWarning: urllib3 (1.25.3) or chardet (2.2.1) doesn\u0026#39;t match a supported version! RequestsDependencyWarning) 172.31.194.117 | SUCCESS =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: false, \u0026#34;ping\u0026#34;: \u0026#34;pong\u0026#34; }   pingè¿”å›pongè¿™å°±è¯´æ˜ä¸»æœºæ˜¯å¯ä»¥è¿æ¥çš„ï¼Œå¯ä»¥è¿›è¡Œåç»­çš„å…¶ä»–æ“ä½œäº†ã€‚\n","description":"","id":14,"section":"ops","tags":["ansible","è‡ªåŠ¨åŒ–è¿ç»´","DevOps"],"title":"è¿ç»´è‡ªåŠ¨åŒ–ç¥å™¨ Ansibleä¹‹Ping(äºŒ)","uri":"http://localhost:1818/ops/devops/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96%E7%A5%9E%E5%99%A8ansible%E4%B9%8Bping/"},{"content":"ä¸€ã€æ¦‚è¿° Â useræ¨¡å— å¯ç®¡ç†è¿œç¨‹ä¸»æœºä¸Šçš„ ç”¨æˆ·ï¼Œæ¯”å¦‚åˆ›å»ºç”¨æˆ·ã€ä¿®æ”¹ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·ã€ä¸ºç”¨æˆ·åˆ›å»ºå¯†é’¥å¯¹ç­‰æ“ä½œã€‚\näºŒã€å‚æ•°ä»‹ç» Â  nameï¼š ç”¨äºæŒ‡å®šæ“ä½œçš„ userï¼Œå¿…é¡»é¡¹ã€‚ uidï¼š ç”¨äºæŒ‡å®š user çš„ UIDï¼Œé»˜è®¤ä¸ºç©ºã€‚ non_uniqueï¼š ä¸uidå‚æ•°ä¸€èµ·ä½¿ç”¨ï¼Œå…è®¸æ”¹å˜UIDä¸ºéå”¯ä¸€å€¼ã€‚ groupï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ· ä¸»ç»„ã€‚é»˜è®¤å€¼ä¸ºç©ºï¼Œä¸ºç©ºæ—¶åˆ›å»ºçš„ç”¨æˆ·ç»„åè·Ÿç”¨æˆ·åä¸€è‡´ã€‚ groupsï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·å±ç»„ï¼Œå¯ä»¥åœ¨åˆ›å»ºç”¨æˆ·æ—¶æŒ‡å®šç”¨æˆ·å±ç»„ï¼Œä¹Ÿå¯ä»¥ç®¡ç†å·²ç»å­˜åœ¨çš„ç”¨æˆ·å±ç»„ã€‚ appendï¼š è·Ÿgroupså‚æ•°ä¸€èµ·ä½¿ç”¨ç®¡ç†ç”¨æˆ·å±ç»„ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœ append='yes' ï¼Œåˆ™ä»groupså‚æ•°ä¸­å¢åŠ ç”¨æˆ·çš„å±ç»„ï¼›å¦‚æœ append='no' ï¼Œåˆ™ç”¨æˆ·å±ç»„åªè®¾ç½®ä¸ºgroupsä¸­çš„ç»„ï¼Œç§»é™¤å…¶ä»–æ‰€æœ‰å±ç»„ã€‚ stateï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·æ˜¯å¦å­˜åœ¨äºè¿œç¨‹ä¸»æœºä¸­ã€‚å¯é€‰å€¼æœ‰ presentã€absentï¼Œé»˜è®¤å€¼ä¸º presentã€‚ removeï¼š å‚æ•°åœ¨ state=absent æ—¶ä½¿ç”¨ï¼Œç­‰ä»·äº userdel --remove å¸ƒå°”ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º falseã€‚ forceï¼š å‚æ•°åœ¨ state=absent æ—¶ä½¿ç”¨ï¼Œç­‰ä»·äº userdel --forceï¼Œå¸ƒå°”ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º falseã€‚ homeï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·homeç›®å½•ï¼Œå€¼ä¸ºè·¯å¾„ create_homeï¼š åœ¨ç”¨æˆ·åˆ›å»ºæ—¶æˆ–homeç›®å½•ä¸å­˜åœ¨æ—¶ä¸ºç”¨æˆ·åˆ›å»ºhomeç›®å½•ï¼Œå¸ƒå°”ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º true move_homeï¼š å¦‚æœè®¾ç½®ä¸ºyesï¼Œç»“åˆhome= ä½¿ç”¨ï¼Œä¸´æ—¶è¿ç§»ç”¨æˆ·å®¶ç›®å½•åˆ°ç‰¹å®šç›®å½• commentï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·æ³¨é‡Šä¿¡æ¯ shellï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·é»˜è®¤shell systemï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·æ˜¯å¦æ˜¯ç³»ç»Ÿç”¨æˆ· expiresï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·è¿‡æœŸæ—¶é—´ï¼Œç›¸å½“äºè®¾ç½® /etc/shadow æ–‡ä»¶ä¸­çš„çš„ ç¬¬8åˆ— passwdï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·å¯†ç ï¼Œä½†æ˜¯è¿™ä¸ªå¯†ç ä¸èƒ½æ˜¯æ˜æ–‡å¯†ç ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹æ˜æ–‡å¯†ç åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼Œé»˜è®¤ä¸ºç©º password_lockï¼š å‚æ•°ç”¨äºé”å®šæŒ‡å®šç”¨æˆ·ï¼Œå¸ƒå°”ç±»å‹ï¼Œé»˜è®¤ä¸ºç©º update_passwordï¼š å‚æ•°å¯é€‰å€¼æœ‰always å’Œ on_createï¼Œé»˜è®¤ä¸ºalways ã€‚\nå½“è®¾ç½®ä¸ºalwaysæ—¶ï¼Œpasswordå‚æ•°çš„å€¼ä¸ /etc/shadow ä¸­å¯†ç å­—ç¬¦ä¸²ä¸ä¸€è‡´æ—¶æ›´æ–°ç”¨æˆ·çš„å¯†ç ï¼›\nå½“è®¾ç½®ä¸ºon_createæ—¶ï¼Œpasswordå‚æ•°çš„å€¼ä¸ /etc/shadow ä¸­å¯†ç å­—ç¬¦ä¸²ä¸ä¸€è‡´æ—¶ä¹Ÿä¸ä¼šæ›´æ–°ç”¨æˆ·çš„å¯†ç ï¼Œä½†å¦‚æœæ˜¯æ–°åˆ›å»ºçš„ç”¨æˆ·ï¼Œåˆ™æ­¤å‚æ•°å³ä½¿ä¸ºon_createï¼Œä¹Ÿä¼šæ›´æ–°ç”¨æˆ·å¯†ç ã€‚ generate_ssh_keyï¼š å‚æ•°ç”¨äºæŒ‡å®šæ˜¯å¦ç”Ÿæˆsshå¯†é’¥å¯¹ï¼Œå¸ƒå°”ç±»å‹ï¼Œé»˜è®¤ä¸ºfalseã€‚å½“è®¾ç½®ä¸ºyesæ—¶ï¼Œä¸ºç”¨æˆ·ç”Ÿæˆ ssh å¯†é’¥å¯¹ï¼Œé»˜è®¤åœ¨ ~/.ssh ç›®å½•ä¸­ç”Ÿæˆåä¸º id_rsaç§é’¥ å’Œ id_rsa.pubå…¬é’¥ï¼Œå¦‚æœåŒåå¯†é’¥å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œã€‚ sssh_key_bitsï¼š å½“ generate_ssh_key=yes æ—¶ï¼ŒæŒ‡å®šç”Ÿæˆçš„ssh keyåŠ å¯†ä½æ•°ã€‚ ssh_key_fileï¼š å½“ generate_ssh_key=yes æ—¶ï¼Œä½¿ç”¨æ­¤å‚æ•°æŒ‡å®šsshç§é’¥çš„è·¯å¾„åŠåç§°ï¼Œä¼šåœ¨åŒè·¯å¾„ä¸‹ç”Ÿæˆä»¥ç§é’¥åå¼€å¤´ä»¥ .pub ç»“å°¾å¯¹åº”å…¬é’¥ã€‚ ssh_key_commentï¼š å½“ generate_ssh_key=yes æ—¶ï¼Œåœ¨åˆ›å»ºè¯ä¹¦æ—¶ï¼Œä½¿ç”¨æ­¤å‚æ•°è®¾ç½®å…¬é’¥ä¸­çš„æ³¨é‡Šä¿¡æ¯ã€‚å¦‚æœåŒåå¯†é’¥å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œã€‚å½“ä¸æŒ‡å®šæ­¤å‚æ•°æ—¶ï¼Œé»˜è®¤æ³¨é‡Šä¿¡æ¯ä¸º\u0026quot;ansible-generated on $hostnameâ€ã€‚ ssh_key_passphraseï¼š å½“ generate_ssh_key=yes æ—¶ï¼Œåœ¨åˆ›å»ºè¯ä¹¦æ—¶ï¼Œä½¿ç”¨æ­¤å‚æ•°è®¾ç½®ç§é’¥å¯†ç ã€‚å¦‚æœåŒåå¯†é’¥å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œã€‚ ssh_key_typeï¼š å½“ generate_ssh_key=yes æ—¶ï¼Œåœ¨åˆ›å»ºè¯ä¹¦æ—¶ï¼Œä½¿ç”¨æ­¤å‚æ•°æŒ‡å®šå¯†é’¥å¯¹çš„ç±»å‹ã€‚é»˜è®¤å€¼ä¸º rsaï¼Œå¦‚æœåŒåå¯†é’¥å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œã€‚  ä¸‰ã€å‚æ•°è¯¦è§£ Â ä¸‹åˆ—è‹±æ–‡æ–‡æ¡£éƒ¨åˆ†æ¥è‡ªäº ansible-docï¼Œå‚æ•°çš„ä¿®é¥°ç¬¦å·ä¸º \u0026quot;=\u0026quot; æˆ– \u0026quot;-\u0026quot;\nOPTIONS (= is mandatory)ï¼š= å·å¼€å§‹çš„ä¸ºå¿…é¡»ç»™å‡ºçš„å‚æ•°\n3.1 name nameï¼š ç”¨äºæŒ‡å®šæ“ä½œçš„ userï¼Œå¿…é¡»é¡¹\n1 2 3 4  = name Name of the user to create, remove or modify. (Aliases: user) type: str   Â 3.1.1 ç¤ºä¾‹ ä½¿ç”¨ ansible åœ¨ note1 èŠ‚ç‚¹ä¸Šå¢åŠ  test ç”¨æˆ·\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=test\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;create_home\u0026#34;: true, \u0026#34;group\u0026#34;: 1000, \u0026#34;home\u0026#34;: \u0026#34;/home/test\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;test\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;system\u0026#34;: false, \u0026#34;uid\u0026#34;: 1000 } [root@note0 ~]#   Â éªŒè¯ ç”¨æˆ· æ˜¯å¦ æ·»åŠ  æˆåŠŸï¼ŒæŸ¥çœ‹ note1 èŠ‚ç‚¹ä¸‹çš„ /etc/passwd æ–‡ä»¶\n1 2  [root@note1 ~]# tail -1 /etc/passwd testâŒ1000:1000::/home/test:/bin/bash   Â 3.2 uid uidï¼š ç”¨äºæŒ‡å®š user çš„ UIDï¼Œé»˜è®¤ä¸ºç©º\n1 2 3 4  - uid Optionally sets the `UID\u0026#39; of the user. [Default: (null)] type: int   3.2.1 ç¤ºä¾‹ ä½¿ç”¨ ansible åœ¨ note1 èŠ‚ç‚¹ä¸Šå¢åŠ  testuid ç”¨æˆ·\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=testuid uid=2000\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;create_home\u0026#34;: true, \u0026#34;group\u0026#34;: 2000, \u0026#34;home\u0026#34;: \u0026#34;/home/testuid\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;testuid\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;system\u0026#34;: false, \u0026#34;uid\u0026#34;: 2000 } [root@note0 ~]#   Â éªŒè¯ ç”¨æˆ· æ˜¯å¦ æ·»åŠ  æˆåŠŸï¼ŒæŸ¥çœ‹ note1 èŠ‚ç‚¹ä¸‹çš„ /etc/passwd æ–‡ä»¶\n1 2  [root@note1 ~]# tail -1 /etc/passwd testuidâŒ2000:2000::/home/testuid:/bin/bash   3.3 state stateï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·æ˜¯å¦å­˜åœ¨äºè¿œç¨‹ä¸»æœºä¸­ã€‚\nå¯é€‰å€¼æœ‰ presentã€absentï¼š\né»˜è®¤å€¼ä¸º presentï¼Œè¡¨ç¤ºç”¨æˆ·å­˜åœ¨ï¼Œç›¸å½“äºåœ¨è¿œç¨‹ä¸»æœºåˆ›å»ºç”¨æˆ·ï¼›\nå½“è®¾ç½®ä¸º absent æ—¶è¡¨ç¤ºç”¨æˆ·ä¸å­˜åœ¨ï¼Œç›¸å½“äºåœ¨è¿œç¨‹ä¸»æœºåˆ é™¤ç”¨æˆ·ã€‚\n1 2 3 4  - state Whether the account should exist or not, taking action if the state is different from what is stated. (Choices: absent, present)[Default: present] type: str   3.3.1 ç¤ºä¾‹ ä½¿ç”¨ ansible åœ¨ note1 èŠ‚ç‚¹ä¸Šåˆ é™¤ test ç”¨æˆ·\n1 2 3 4 5 6 7 8 9 10 11 12  [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=test state=absent\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;force\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;test\u0026#34;, \u0026#34;remove\u0026#34;: false, \u0026#34;state\u0026#34;: \u0026#34;absent\u0026#34; } [root@note0 ~]#   Â éªŒè¯ ç”¨æˆ· æ˜¯å¦ åˆ é™¤ æˆåŠŸï¼ŒæŸ¥çœ‹ note1 èŠ‚ç‚¹ä¸‹æ˜¯å¦å­˜åœ¨ test ç”¨æˆ·\n1 2  [root@note1 ~]# id test id: test: no such user   3.4 remove removeï¼š å‚æ•°åœ¨ state=absent æ—¶ä½¿ç”¨ï¼Œç­‰ä»·äº userdel --remove å¸ƒå°”ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º falseã€‚\n1 2 3 4 5  - remove This only affects `state=absent\u0026#39;, it attempts to remove directories associated with the user. The behavior is the same as `userdel --remove\u0026#39;, check the man page for details and support. [Default: False] type: bool   3.4.1 ç¤ºä¾‹1 åœ¨ ç¤ºä¾‹3.3.1 ä¸­æˆ‘ä»¬å·²ç»ä½¿ç”¨ ansible åœ¨ note1 èŠ‚ç‚¹ä¸Šåˆ é™¤äº† test ç”¨æˆ·ï¼Œç°åœ¨è®©æˆ‘ä»¬æŸ¥çœ‹testç”¨æˆ·homeç›®å½•æ˜¯å¦å­˜åœ¨ã€‚\n1 2 3 4 5 6 7  [root@note1 ~]# cd /home #æŸ¥çœ‹homeç›®å½• [root@note1 home]# ll æ€»ç”¨é‡ 0 drwx------ 2 1000 1000 59 7æœˆ 9 16:41 test drwx------ 2 testuid testuid 59 7æœˆ 9 17:01 testuid [root@note1 home]#   æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡state=absentåˆ é™¤çš„ç”¨æˆ·homeç›®å½•è¿˜å­˜åœ¨ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æ¼”ç¤ºä¸€ä¸‹å½»åº•åˆ é™¤ä¸€ä¸ªç”¨æˆ·ã€‚\n3.4.2 ç¤ºä¾‹2 ä½¿ç”¨ ansible åœ¨ note1 èŠ‚ç‚¹ä¸Šåˆ é™¤ testuid ç”¨æˆ·\n1 2 3 4 5 6 7 8 9 10 11 12  [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=testuid state=absent remove=yes\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;force\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;testuid\u0026#34;, \u0026#34;remove\u0026#34;: true, \u0026#34;state\u0026#34;: \u0026#34;absent\u0026#34; } [root@note0 ~]#   Â ä¸‹é¢æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼Œç”¨æˆ·åŠhomeç›®å½•æ˜¯å¦å½»åº•åˆ é™¤\n1 2 3 4 5 6 7 8  #æŸ¥çœ‹testuidç”¨æˆ·æ˜¯å¦å­˜åœ¨ [root@note1 home]# id testuid id: testuid: no such user #æŸ¥çœ‹homeç›®å½• [root@note1 home]# ll æ€»ç”¨é‡ 0 drwx------ 2 1000 1000 59 7æœˆ 9 16:41 test [root@note1 home]#   3.5 group groupï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ· ä¸»ç»„ã€‚é»˜è®¤å€¼ä¸ºç©ºï¼Œåˆ›å»ºçš„ç”¨æˆ·ç»„åè·Ÿç”¨æˆ·åä¸€è‡´ã€‚\n1 2 3 4  - group Optionally sets the user\u0026#39;s primary group (takes a group name). [Default: (null)] type: str   3.5.1 ç¤ºä¾‹ ä½¿ç”¨ ansible åœ¨ note1 èŠ‚ç‚¹ä¸Š åˆ›å»ºtest ç”¨æˆ·ï¼Œå¹¶æŒ‡å®šä¸»ç»„ä¸º testgrp\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  #é¦–å…ˆåˆ›å»ºä½¿ç”¨ansibleåˆ›å»ºtestgrpç»„ [root@note0 ~]# ansible note1 -m group -a \u0026#34;name=testgrp state=present\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;gid\u0026#34;: 1000, \u0026#34;name\u0026#34;: \u0026#34;testgrp\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;system\u0026#34;: false } #ä½¿ç”¨ansibleåˆ›å»ºtestç”¨æˆ· [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=test group=testgrp state=present\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;create_home\u0026#34;: true, \u0026#34;group\u0026#34;: 1000, \u0026#34;home\u0026#34;: \u0026#34;/home/test\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;test\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;system\u0026#34;: false, \u0026#34;uid\u0026#34;: 1000 } [root@note0 ~]#   Â éªŒè¯ ç”¨æˆ· æ˜¯å¦ åˆ›å»º æˆåŠŸ\n1 2  [root@note1 home]# id test uid=1000(test) gid=1000(testgrp) ç»„=1000(testgrp)   3.6 groupsã€append groupsï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·å±ç»„ï¼Œå¯ä»¥åœ¨åˆ›å»ºç”¨æˆ·æ—¶æŒ‡å®šç”¨æˆ·å±ç»„ï¼Œä¹Ÿå¯ä»¥ç®¡ç†å·²ç»å­˜åœ¨çš„ç”¨æˆ·å±ç»„ã€‚\ngroupsä¸ºåˆ—è¡¨ç±»å‹ï¼Œå¤šä¸ªå‚æ•°ä»¥é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ groups='grp,mygrp'ï¼›é»˜è®¤å€¼ ä¸º ç©º ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ç©ºå­—ç¬¦ä¸² groups=''ï¼Œgroups=`null` ï¼Œgroups=`~` ï¼Œå°†ç”¨æˆ·ä»å…¶ä»–å±ç»„ ç§»é™¤ã€‚\nappendï¼š è·Ÿgroupså‚æ•°ä¸€èµ·ä½¿ç”¨ç®¡ç†ç”¨æˆ·å±ç»„ã€‚å¸ƒå°”ç±»å‹ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœ append='yes' ï¼Œåˆ™ä»groupså‚æ•°ä¸­å¢åŠ ç”¨æˆ·çš„å±ç»„ï¼›å¦‚æœ append='no' ï¼Œåˆ™ç”¨æˆ·å±ç»„åªè®¾ç½®ä¸ºgroupsä¸­çš„ç»„ï¼Œç§»é™¤å…¶ä»–æ‰€æœ‰å±ç»„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12  - groups List of groups user will be added to. When set to an empty string `\u0026#39;\u0026#39;\u0026#39;, `null\u0026#39;, or `~\u0026#39;, the user is removed from all groups except the primary group. (`~\u0026#39; means `null\u0026#39; in YAML) Before Ansible 2.3, the only input format allowed was a comma separated string. [Default: (null)] type: list - append If `yes\u0026#39;, add the user to the groups specified in `groups\u0026#39;. If `no\u0026#39;, user will only be added to the groups specified in `groups\u0026#39;, removing them from all other groups. [Default: False] type: bool   3.6.1 ç¤ºä¾‹1-åˆ›å»ºç”¨æˆ·æ—¶æŒ‡å®šå±ç»„ å…ˆä½¿ç”¨ ansible åœ¨ note1 èŠ‚ç‚¹ä¸Šåˆ›å»º mygrp1ï¼Œmygrp2ï¼Œmygrp3 æµ‹è¯•ç»„\n1 2 3 4 5 6 7 8 9 10  #é¦–å…ˆåˆ›å»ºä½¿ç”¨åˆ›å»ºæµ‹è¯•ç»„ [root@note0 ~]# ansible note1 -m group -a \u0026#34;name=mygrp1 gid=2001 state=present\u0026#34; [root@note0 ~]# ansible note1 -m group -a \u0026#34;name=mygrp2 gid=2002 state=present\u0026#34; [root@note0 ~]# ansible note1 -m group -a \u0026#34;name=mygrp3 gid=2003 state=present\u0026#34; #æµ‹è¯•ç»„åˆ›å»ºæˆåŠŸ [root@note1 home]# cat /etc/group mygrp1âŒ2001: mygrp2âŒ2002: mygrp3âŒ2003:   Â åˆ›å»ºç”¨æˆ· testuserï¼Œå¹¶æŒ‡å®šå±ç»„ä¸º mygrp1 mygrp2\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=testuser groups=mygrp1,mygrp2 state=present\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;create_home\u0026#34;: true, \u0026#34;group\u0026#34;: 1001, \u0026#34;groups\u0026#34;: \u0026#34;mygrp1,mygrp2\u0026#34;, \u0026#34;home\u0026#34;: \u0026#34;/home/testuser\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;testuser\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;system\u0026#34;: false, \u0026#34;uid\u0026#34;: 1001 } [root@note0 ~]#   Â éªŒè¯ç”¨æˆ· testuserçš„å±ç»„ä¸ºmygrp1ï¼Œmygrp2\n1 2  [root@note1 home]# id testuser uid=1001(testuser) gid=1001(testuser) ç»„=1001(testuser),2001(mygrp1),2002(mygrp2)   3.6.2 ç¤ºä¾‹2-å·²åˆ›å»ºç”¨æˆ·å¢åŠ å±ç»„ å°†testuserçš„å±ç»„å˜æ›´ä¸ºmygrp1ï¼Œmygrp2ï¼Œmygrp3\n3.6.2.1 ä¸ä½¿ç”¨appendï¼Œä½¿ç”¨groupsæŒ‡æ˜ç”¨æˆ·çš„æ‰€æœ‰å±ç»„å³å¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=testuser groups=\u0026#39;mygrp1,mygrp2,mygrp3\u0026#39; state=present\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;append\u0026#34;: false, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;group\u0026#34;: 1001, \u0026#34;groups\u0026#34;: \u0026#34;mygrp1,mygrp2,mygrp3\u0026#34;, \u0026#34;home\u0026#34;: \u0026#34;/home/testuser\u0026#34;, \u0026#34;move_home\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;testuser\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;uid\u0026#34;: 1001 } [root@note0 ~]#   Â éªŒè¯ç”¨æˆ·testuserçš„å±ç»„æ˜¯å¦ä¸ºmygrp1ï¼Œmygrp2ï¼Œmygrp3\n1 2  [root@note1 home]# id testuser uid=1001(testuser) gid=1001(testuser) ç»„=1001(testuser),2001(mygrp1),2002(mygrp2),2003(mygrp3)   3.6.2.2 ä½¿ç”¨appendå±æ€§ å…ˆå°†testuserç”¨æˆ·å±ç»„è¿˜åŸä¸ºmygrp1ï¼Œmygrp2\nå†å¢åŠ å±ç»„mygrp3\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  #ä½¿ç”¨append=yesæ—¶ï¼Œåªå°†è¦æ·»åŠ çš„å±ç»„å¡«å…¥groupså‚æ•°ä¸­å³å¯ã€‚ [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=testuser groups=\u0026#39;mygrp3\u0026#39; append=yes state=present\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;append\u0026#34;: true, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;group\u0026#34;: 1001, \u0026#34;groups\u0026#34;: \u0026#34;mygrp3\u0026#34;, \u0026#34;home\u0026#34;: \u0026#34;/home/testuser\u0026#34;, \u0026#34;move_home\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;testuser\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;uid\u0026#34;: 1001 } [root@note0 ~]#   Â éªŒè¯ç”¨æˆ·testuserçš„å±ç»„æ˜¯å¦ä¸ºmygrp1ï¼Œmygrp2ï¼Œmygrp3\n1 2  [root@note1 home]# id testuser uid=1001(testuser) gid=1001(testuser) ç»„=1001(testuser),2001(mygrp1),2002(mygrp2),2003(mygrp3)   3.6.3 ç¤ºä¾‹3-å·²åˆ›å»ºç”¨æˆ·ç§»é™¤å±ç»„ å°†testuserçš„å±ç»„å˜æ›´ä¸ºmygrp1\n3.6.3.1 ä¸ä½¿ç”¨appendï¼Œä½¿ç”¨groupsæŒ‡æ˜ç”¨æˆ·çš„æ‰€æœ‰å±ç»„å³å¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=testuser groups=\u0026#39;mygrp1\u0026#39; state=present\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;append\u0026#34;: false, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;group\u0026#34;: 1001, \u0026#34;groups\u0026#34;: \u0026#34;mygrp1\u0026#34;, \u0026#34;home\u0026#34;: \u0026#34;/home/testuser\u0026#34;, \u0026#34;move_home\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;testuser\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;uid\u0026#34;: 1001 } [root@note0 ~]#   Â éªŒè¯ç”¨æˆ·testuserçš„å±ç»„æ˜¯å¦ä¸ºmygrp1\n1 2  [root@note1 home]# id testuser uid=1001(testuser) gid=1001(testuser) ç»„=1001(testuser),2001(mygrp1)   3.6.3.2 ä½¿ç”¨appendå±æ€§ å…ˆå°†testuserç”¨æˆ·å±ç»„è¿˜åŸä¸ºmygrp1ï¼Œmygrp2ï¼Œmygrp3\nå†å˜æ›´ç”¨æˆ·testuserå±ç»„ä¸ºmygrp3\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  #ä½¿ç”¨append=noæ—¶ï¼Œç”¨æˆ·çš„å±ç»„åªè®¾ç½®ä¸ºgroupså‚æ•°ä¸­çš„ç»„ [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=testuser groups=\u0026#39;mygrp1\u0026#39; append=\u0026#39;no\u0026#39; state=present\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;append\u0026#34;: false, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;group\u0026#34;: 1001, \u0026#34;groups\u0026#34;: \u0026#34;mygrp1\u0026#34;, \u0026#34;home\u0026#34;: \u0026#34;/home/testuser\u0026#34;, \u0026#34;move_home\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;testuser\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;uid\u0026#34;: 1001 } [root@note0 ~]#   Â éªŒè¯ç”¨æˆ·testuserçš„å±ç»„æ˜¯å¦ä¸ºmygrp1\n1 2  [root@note1 home]# id testuser uid=1001(testuser) gid=1001(testuser) ç»„=1001(testuser),2001(mygrp1)   3.7 passwd passwdï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·å¯†ç ï¼Œä½†æ˜¯è¿™ä¸ªå¯†ç ä¸èƒ½æ˜¯æ˜æ–‡å¯†ç ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹æ˜æ–‡å¯†ç åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼Œç›¸å½“äºÂ /etc/shadowÂ æ–‡ä»¶ä¸­çš„å¯†ç å­—æ®µï¼Œæ˜¯ä¸€ä¸ªå¯¹æ˜æ–‡å¯†ç è¿›è¡Œå“ˆå¸Œåçš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ç”Ÿæˆæ˜æ–‡å¯†ç å¯¹åº”çš„åŠ å¯†å­—ç¬¦ä¸²ã€‚\n1 2 3 4 5 6 7 8  - password Optionally set the user\u0026#39;s password to this crypted value. On macOS systems, this value has to be cleartext. Beware of security issues. To create a disabled account on Linux systems, set this to `\u0026#39;!\u0026#39;\u0026#39; or `\u0026#39;*\u0026#39;\u0026#39;. See https://docs.ansible.com/ansible/faq.html#how-do-i-generate-crypted-passwords-for-the-user-module for details on various ways to generate these password values. [Default: (null)] type: str   Â è¦ç”Ÿæˆmd5ç®—æ³•çš„å¯†ç ï¼Œä½¿ç”¨opensslå³å¯ã€‚\n1 2  openssl passwd -1 \u0026#39;123456\u0026#39; openssl passwd -1 -salt \u0026#39;abcdefg\u0026#39; \u0026#39;123456\u0026#39;   Â ä½† openssl passwd ä¸æ”¯æŒç”Ÿæˆsha-256å’Œsha-512ç®—æ³•çš„å¯†ç ã€‚ä½¿ç”¨pythonå‘½ä»¤ç”Ÿæˆsha-512ç®—æ³•\n1  python -c \u0026#39;import crypt,getpass;pw=\u0026#34;123456\u0026#34;;print(crypt.crypt(pw))\u0026#39;   Â ç°åœ¨å°±æ–¹ä¾¿å¤šäº†ï¼Œç›´æ¥å°†ç»“æœèµ‹å€¼ç»™å˜é‡å³å¯ã€‚\n1 2 3  [root@note0 ~]# a=$(python -c \u0026#39;import crypt,getpass;pw=\u0026#34;123456\u0026#34;;print(crypt.crypt(pw))\u0026#39;) [root@note0 ~]# echo $a $6$uKhnBg5A4/jC8KaU$scXof3ZwtYWl/6ckD4GFOpsQa8eDu6RDbHdlFcRLd/2cDv5xYe8hzw5ekYCV5L2gLBBSfZ.Uc166nz6TLchlp.   Â ä¾‹å¦‚ï¼Œansibleåˆ›å»ºç”¨æˆ·å¹¶æŒ‡å®šå¯†ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  [root@note0 ~]# a=$(python -c \u0026#39;import crypt,getpass;pw=\u0026#34;123456\u0026#34;;print(crypt.crypt(pw))\u0026#39;) [root@note0 ~]# ansible note1 -m user -a \u0026#39;name=testpass password=\u0026#34;$a\u0026#34; update_password=always\u0026#39; [WARNING]: The input password appears not to have been hashed. The \u0026#39;password\u0026#39; argument must be encrypted for this module to work properly. 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;create_home\u0026#34;: true, \u0026#34;group\u0026#34;: 1005, \u0026#34;home\u0026#34;: \u0026#34;/home/testpass\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;testpass\u0026#34;, \u0026#34;password\u0026#34;: \u0026#34;NOT_LOGGING_PASSWORD\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;system\u0026#34;: false, \u0026#34;uid\u0026#34;: 1005 } [root@note0 ~]#   Â ç™»å½•éªŒè¯\n1 2 3 4 5 6  [root@note0 ~]# ssh testpass@note1 testpass@note1\u0026#39;s password: Last login: Thu Jul 11 00:12:57 2019 from note0 [testpass@note1 ~]$ who am i testpass pts/1 2019-07-11 00:13 (note0) [testpass@note1 ~]$   3.8 expires expiresï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·è¿‡æœŸæ—¶é—´ï¼Œç›¸å½“äºè®¾ç½® /etc/shadow æ–‡ä»¶ä¸­çš„çš„ ç¬¬8åˆ— ï¼Œæ¯”å¦‚ï¼Œä½ æƒ³è¦è®¾ç½®ç”¨æˆ·çš„è¿‡æœŸæ—¥æœŸä¸º2019å¹´07æœˆ10æ—¥ï¼Œé‚£ä¹ˆä½ é¦–å…ˆè¦è·å–2019å¹´07æœˆ10æ—¥çš„ unix æ—¶é—´æˆ³ï¼Œä½¿ç”¨å‘½ä»¤ date -d 20190710 +%s è·å–åˆ°çš„æ—¶é—´æˆ³ä¸º1562688000ï¼Œæ‰€ä»¥ï¼Œå½“è®¾ç½® expires=1562688000 æ—¶ï¼Œè¡¨ç¤ºç”¨æˆ·çš„è¿‡æœŸæ—¶é—´ä¸º2019å¹´07æœˆ10æ—¥0ç‚¹0åˆ†ï¼Œè®¾ç½®æˆåŠŸåï¼ŒæŸ¥çœ‹è¿œç¨‹ä¸»æœºçš„ /etc/shadow æ–‡ä»¶ï¼Œå¯¹åº”ç”¨æˆ·çš„ç¬¬8åˆ—çš„å€¼å°†å˜æˆ18086ï¼ˆè¡¨ç¤º1970å¹´1æœˆ1æ—¥åˆ°2019å¹´07æœˆ10æ—¥çš„å¤©æ•°ï¼Œunix æ—¶é—´æˆ³çš„å€¼ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå¤©æ•°ï¼Œæˆ‘ä»¬ä¸ç”¨æ‰‹åŠ¨çš„è¿›è¡Œæ¢ç®—ï¼‰ï¼Œå½“å‰ansibleç‰ˆæœ¬æ­¤å‚æ•°æ”¯æŒåœ¨GNU/Linux, FreeBSD, and DragonFlyBSD ç³»ç»Ÿä¸­ä½¿ç”¨ã€‚\n3.8.1 ç¤ºä¾‹ è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ä¸º20190710çš„ç”¨æˆ·testexprie\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=testexpire expires=1562688000 comment=\u0026#39;expires date is 20190710\u0026#39; state=present\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;expires date is 20190710\u0026#34;, \u0026#34;create_home\u0026#34;: true, \u0026#34;group\u0026#34;: 1003, \u0026#34;home\u0026#34;: \u0026#34;/home/testexpire\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;testexpire\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;system\u0026#34;: false, \u0026#34;uid\u0026#34;: 1003 } [root@note0 ~]#   Â åœ¨note1ä¸ŠéªŒè¯testexprieç”¨æˆ·\n1 2  [root@note1 home]# cat /etc/shadow testexpire:!!:18086:0:99999:7::18086:   ç™»å½•å¤±è´¥ï¼Œæç¤ºè´¦å·è¿‡æœŸ\n[root@note0 ~]# ssh testexpire@note1\rtestexpire@note1's password: Your account has expired; please contact your system administrator\rConnection closed by 176.16.128.1\r3.9 home homeï¼š å‚æ•°ç”¨äºæŒ‡å®šç”¨æˆ·homeç›®å½•ï¼Œå€¼ä¸ºè·¯å¾„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  - home Optionally set the user\u0026#39;s home directory. [Default: (null)] type: path - create_home Unless set to `no\u0026#39;, a home directory will be made for the user when the account is created or if the home directory does not exist. Changed from `createhome\u0026#39; to `create_home\u0026#39; in Ansible 2.5. (Aliases: createhome)[Default: True] type: bool - move_home If set to `yes\u0026#39; when used with `home: \u0026#39;, attempt to move the user\u0026#39;s old home directory to the specified directory if it isn\u0026#39;t there already and the old home exists. [Default: False] type: bool   3.9.1 ç¤ºä¾‹ [root@note0 ~]# ansible note1 -m user -a \u0026quot;name=testhome home=/home/testdir state=present\u0026quot;\r176.16.128.1 | CHANGED =\u0026gt; {\r\u0026quot;ansible_facts\u0026quot;: {\r\u0026quot;discovered_interpreter_python\u0026quot;: \u0026quot;/usr/bin/python\u0026quot;\r}, \u0026quot;changed\u0026quot;: true, \u0026quot;comment\u0026quot;: \u0026quot;\u0026quot;, \u0026quot;create_home\u0026quot;: true, \u0026quot;group\u0026quot;: 1004, \u0026quot;home\u0026quot;: \u0026quot;/home/testdir\u0026quot;, \u0026quot;name\u0026quot;: \u0026quot;testhome\u0026quot;, \u0026quot;shell\u0026quot;: \u0026quot;/bin/bash\u0026quot;, \u0026quot;state\u0026quot;: \u0026quot;present\u0026quot;, \u0026quot;system\u0026quot;: false, \u0026quot;uid\u0026quot;: 1004\r}\r[root@note0 ~]# Â éªŒè¯testhomeç”¨æˆ·çš„homeç›®å½•\n1 2 3 4 5 6 7 8  # é¦–å…ˆç™»å½•note1èŠ‚ç‚¹ï¼Œsuåˆ°testhomeç”¨æˆ· [root@note1 ~]# su - testhome # cd åˆ°ä¸»ç›®å½• [testhome@note1 ~]$ cd ~ # æ‰§è¡Œpwd [testhome@note1 ~]$ pwd /home/testdir [testhome@note1 ~]$   3.10 move_home move_homeï¼š å¦‚æœè®¾ç½®ä¸ºyesï¼Œç»“åˆhome= ä½¿ç”¨ï¼Œä¸´æ—¶è¿ç§»ç”¨æˆ·å®¶ç›®å½•åˆ°ç‰¹å®šç›®å½•\n1 2 3 4 5  - move_home If set to `yes\u0026#39; when used with `home: \u0026#39;, attempt to move the user\u0026#39;s old home directory to the specified directory if it isn\u0026#39;t there already and the old home exists. [Default: False] type: bool   3.10.1 ç¤ºä¾‹ é¦–å…ˆåˆ›å»ºtestmoveç”¨æˆ·ï¼Œç„¶ååœ¨testmoveç”¨æˆ·homeç›®å½•ä¸‹åˆ›å»ºtest_move_home.txtæ–‡ä»¶\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40  #åˆ›å»ºtestmoveç”¨æˆ·ã€‚ [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=testmove state=present\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;create_home\u0026#34;: true, \u0026#34;group\u0026#34;: 1006, \u0026#34;home\u0026#34;: \u0026#34;/home/testmove\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;testmove\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;system\u0026#34;: false, \u0026#34;uid\u0026#34;: 1006 } #ä½¿ç”¨ansibleçš„fileæ¨¡å—åœ¨testmoveç”¨æˆ·homeç›®å½•ä¸‹åˆ›å»ºtest_move_home.txtæ–‡ä»¶ [root@note0 ~]# ansible note1 -m file -a \u0026#34;path=/home/testmove/test_move_home.txt state=touch\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;dest\u0026#34;: \u0026#34;/home/testmove/test_move_home.txt\u0026#34;, \u0026#34;gid\u0026#34;: 0, \u0026#34;group\u0026#34;: \u0026#34;root\u0026#34;, \u0026#34;mode\u0026#34;: \u0026#34;0644\u0026#34;, \u0026#34;owner\u0026#34;: \u0026#34;root\u0026#34;, \u0026#34;size\u0026#34;: 0, \u0026#34;state\u0026#34;: \u0026#34;file\u0026#34;, \u0026#34;uid\u0026#34;: 0 } #åœ¨note1èŠ‚ç‚¹ä¸Šï¼ŒæŸ¥çœ‹/home/testmoveä¸‹æ˜¯å¦å­˜åœ¨test_move_home.txt [root@note1 ~]# cd /home/testmove [root@note1 testmove]# ll æ€»ç”¨é‡ 0 -rw-r--r-- 1 root root 0 7æœˆ 11 06:22 test_move_home.txt [root@note1 testmove]#   ä½¿ç”¨ansibleçš„move_homeå‚æ•°è¿ç§»ç”¨æˆ·homeç›®å½•\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  #è¿ç§»testmoveç”¨æˆ·çš„homeç›®å½•è‡³/tmp/testmove_new [root@note0 ~]# ansible note1 -m user -a \u0026#34;user=testmove move_home=yes home=/tmp/testmove_new/\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;append\u0026#34;: false, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;group\u0026#34;: 1006, \u0026#34;home\u0026#34;: \u0026#34;/tmp/testmove_new/\u0026#34;, \u0026#34;move_home\u0026#34;: true, \u0026#34;name\u0026#34;: \u0026#34;testmove\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;uid\u0026#34;: 1006 } [root@note0 ~]#   éªŒè¯è¿ç§»çš„æ–°homeç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨test_move_home.txtæ–‡ä»¶\n1 2 3 4 5  [root@note1 testmove]# cd /tmp/testmove_new/ [root@note1 testmove_new]# ll æ€»ç”¨é‡ 0 -rw-r--r-- 1 root root 0 7æœˆ 11 06:22 test_move_home.txt [root@note1 testmove_new]#   3.11 generate_ssh_key generate_ssh_keyï¼š å‚æ•°ç”¨äºæŒ‡å®šæ˜¯å¦ç”Ÿæˆsshå¯†é’¥å¯¹ï¼Œå¸ƒå°”ç±»å‹ï¼Œé»˜è®¤ä¸ºfalseã€‚å½“è®¾ç½®ä¸ºyesæ—¶ï¼Œä¸ºç”¨æˆ·ç”Ÿæˆ ssh å¯†é’¥å¯¹ï¼Œé»˜è®¤åœ¨ ~/.ssh ç›®å½•ä¸­ç”Ÿæˆåä¸º id_rsaç§é’¥ å’Œ id_rsa.pubå…¬é’¥ï¼Œå¦‚æœåŒåå¯†é’¥å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œã€‚\n1 2 3 4 5 6  - generate_ssh_key Whether to generate a SSH key for the user in question. This will *not* overwrite an existing SSH key unless used with `force=yes\u0026#39;. [Default: False] type: bool version_added: 0.9   3.11.1 ç¤ºä¾‹ ä½¿ç”¨ansibleåˆ›å»ºtestsshç”¨æˆ·ï¼Œå¹¶ç”Ÿæˆssh_keyã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  [root@note0 ~]# ansible note1 -m user -a \u0026#34;name=testssh state=present generate_ssh_key=yes\u0026#34; 176.16.128.1 | CHANGED =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: true, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;create_home\u0026#34;: true, \u0026#34;group\u0026#34;: 1007, \u0026#34;home\u0026#34;: \u0026#34;/home/testssh\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;testssh\u0026#34;, \u0026#34;shell\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;ssh_fingerprint\u0026#34;: \u0026#34;2048 07:18:48:ea:f1:dc:95:22:75:fc:b5:5e:80:25:a7:1f ansible-generated on note1 (RSA)\u0026#34;, \u0026#34;ssh_key_file\u0026#34;: \u0026#34;/home/testssh/.ssh/id_rsa\u0026#34;, \u0026#34;ssh_public_key\u0026#34;: \u0026#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDIrQCOP11FK/s50vpOm/z+hXEmet+oEdWqGbyQD0JdN0AJrS/MzHZF3v+sjMf4SoDL7PafPYnFY4iVEtNOuBK8uvQgziVXVRxPs7h9Yy+ZdFw8qFjeiC74pKl+0Mqq49I9TD1GMbOQRd0K7nTycymCAX0MW5lQz7q44f3qa4+4y8C63xxi/4H9x3lJ+JsjDDIzKo4i69CnqU3Bn+0HzfxYi9j63HtcdLF8OwVfyF73lK6xd+vK68AaxRfPIOEj4KJXU3iMdiM5zVvMZgjEKyaGKPJD/uQl35MV2oazmFHTHWrKgA5AXwJEMKJYJzF6a8Z6SrmSnvxp6TpnMmbXAjev ansible-generated on note1\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;present\u0026#34;, \u0026#34;system\u0026#34;: false, \u0026#34;uid\u0026#34;: 1007 } [root@note0 ~]#   éªŒè¯note1èŠ‚ç‚¹ä¸‹çš„ssh_keyæ–‡ä»¶\n1 2 3 4 5 6 7 8  [root@note1 ~]# cd /home/testssh/.ssh [root@note1 .ssh]# ll æ€»ç”¨é‡ 8 -rw------- 1 testssh testssh 1679 7æœˆ 11 06:39 id_rsa -rw-r--r-- 1 testssh testssh 408 7æœˆ 11 06:39 id_rsa.pub [root@note1 .ssh]# cat id_rsa.pub ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDIrQCOP11FK/s50vpOm/z+hXEmet+oEdWqGbyQD0JdN0AJrS/MzHZF3v+sjMf4SoDL7PafPYnFY4iVEtNOuBK8uvQgziVXVRxPs7h9Yy+ZdFw8qFjeiC74pKl+0Mqq49I9TD1GMbOQRd0K7nTycymCAX0MW5lQz7q44f3qa4+4y8C63xxi/4H9x3lJ+JsjDDIzKo4i69CnqU3Bn+0HzfxYi9j63HtcdLF8OwVfyF73lK6xd+vK68AaxRfPIOEj4KJXU3iMdiM5zVvMZgjEKyaGKPJD/uQl35MV2oazmFHTHWrKgA5AXwJEMKJYJzF6a8Z6SrmSnvxp6TpnMmbXAjev ansible-generated on note1 [root@note1 .ssh]#   Â ansibleçš„useræ¨¡å—å¸¸ç”¨å‚æ•°å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œä¸åšè¿‡å¤šèµ˜è¿°äº†ã€‚æ¬¢è¿æŒ‡ç‚¹äº¤æµã€‚\n","description":"","id":15,"section":"ops","tags":["ansible","è‡ªåŠ¨åŒ–è¿ç»´","DevOps"],"title":"è¿ç»´è‡ªåŠ¨åŒ–ç¥å™¨ Ansibleä¹‹User(å››)","uri":"http://localhost:1818/ops/devops/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96%E7%A5%9E%E5%99%A8ansible%E4%B9%8Buser/"},{"content":"ä¸€ã€å®‰è£…éƒ¨ç½² 1  yum install ansible   é€šè¿‡rpm -qlå‘½ä»¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ° ansible æœ‰å¾ˆå¤šçš„å­å‘½ä»¤ä»¥åŠä»–ä»¬çš„å®‰è£…ä½ç½®ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  [root@master01 ~]# rpm -ql ansible | grep bin /usr/bin/ansible /usr/bin/ansible-2 /usr/bin/ansible-2.7 /usr/bin/ansible-config /usr/bin/ansible-connection /usr/bin/ansible-console /usr/bin/ansible-console-2 /usr/bin/ansible-console-2.7 /usr/bin/ansible-doc /usr/bin/ansible-doc-2 /usr/bin/ansible-doc-2.7 /usr/bin/ansible-galaxy /usr/bin/ansible-galaxy-2 /usr/bin/ansible-galaxy-2.7 /usr/bin/ansible-inventory /usr/bin/ansible-playbook /usr/bin/ansible-playbook-2 /usr/bin/ansible-playbook-2.7 /usr/bin/ansible-pull /usr/bin/ansible-pull-2 /usr/bin/ansible-pull-2.7 /usr/bin/ansible-vault /usr/bin/ansible-vault-2 /usr/bin/ansible-vault-2.7   äºŒã€é…ç½®æ–‡ä»¶ ansibleé…ç½®æ–‡ä»¶é»˜è®¤å®‰è£…åœ¨/etc/ansibleä¸‹\n1 2 3 4 5 6 7  [root@master01 ansible]# pwd /etc/ansible [root@master01 ansible]# ll total 28 -rw-r--r-- 1 root root 19980 Sep 14 04:00 ansible.cfg -rw-r--r-- 1 root root 1016 Sep 14 04:00 hosts drwxr-xr-x 2 root root 4096 Sep 14 04:00 roles   2.1ã€hostsé…ç½®æ–‡ä»¶è§£æ hostsæ–‡ä»¶æ˜¯æˆ‘ä»¬ä½¿ç”¨ansibleæ“ä½œçš„ä¸»æœºæ¨¡æ¿æ–‡ä»¶ã€‚\n# å¯ä»¥å¦‚ä»¥ä¸‹æ¨¡å—è¿™æ ·é…ç½®åŸŸåæˆ–è€…ä¸»æœºIPåœ°å€\rgreen.example.com\rblue.example.com\r192.168.100.1\r192.168.100.10\r# ä¹Ÿå¯ä»¥è®¾ç½®åˆ†ç»„, ä½¿ç”¨ansibleçš„æ—¶å€™æŒ‡å®šæ“ä½œçš„ç»„ã€‚\r[webservers]\ralpha.example.org\rbeta.example.org\r192.168.1.100\r192.168.1.110\r# å¦‚æœå¤šä¸ªä¸»æœºéµå¾ªä¸€ä¸ªå‘½åè§„åˆ™ï¼Œä¹Ÿå¯ä»¥å¦‚ä¸‹é…ç½®ã€‚\rwww[001:006].example.com\r2.2ã€é…ç½®ansible.cfgæ–‡ä»¶ å› ä¸ºæˆ‘ä»¬ä¸é…ç½®sshå…å¯†éªŒè¯ï¼Œæ‰€ä»¥è¦ä¿®æ”¹ä¸€ä¸‹ansible.cfgæ–‡ä»¶ã€‚\n1 2  [root@master01 ansible]# vi /etc/ansible/ansible.cfg host_key_checking = False   2.3ã€é…ç½®hostsæ–‡ä»¶ å¦‚æœä¸»æœºé—´è¿˜æ²¡æœ‰é…ç½®sshå…å¯†éªŒè¯ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ç”¨æˆ·åã€å¯†ç ã€‚\n[master]\r172.31.194.114 ansible_ssh_user='root' ansible_ssh_pass='miao123!'\r172.31.194.115 ansible_ssh_user='root' ansible_ssh_pass='miao123!'\r172.31.194.116 ansible_ssh_user='root' ansible_ssh_pass='miao123!'\r[node]\r172.31.194.117 ansible_ssh_user='root' ansible_ssh_pass='miao123!'\rä¸‰ã€ansibleä½¿ç”¨è¯­æ³• è¿™é‡Œåªåˆ—å‡ºä¸€äº›é‡è¦çš„ansibleè¯­æ³•åŠå‚æ•°ã€‚\n1 2 3 4 5 6 7 8 9 10  [root@master01 ansible]# ansible --help Usage: ansible \u0026lt;host-pattern\u0026gt; [options] # æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ansibleå‘½ä»¤åéœ€è¦æŒ‡å®šä¸»æœºæ¨¡æ¿æ–‡ä»¶ï¼Œé»˜è®¤hostsæ–‡ä»¶ä¸éœ€è¦æŒ‡å®šã€‚ Options: -C, --check # ä½¿ç”¨ -C æˆ– --check æ¥å¹²è·‘ä¸€éä¸æ‰§è¡Œä»»ä½•ä¿®æ”¹ï¼ˆæ£€æŸ¥è¯­æ³•é”™è¯¯åŠæŸ¥çœ‹ç›®æ ‡è¾¾æˆçŠ¶æ€ï¼‰  -f FORKS, --forks=FORKS # æŒ‡å®šä¸€æ¬¡è¿è¡Œå‡ å°ä¸»æœºçš„ä»»åŠ¡ï¼Œé»˜è®¤æ˜¯5 -m MODULE_NAME, --module-name=MODULE_NAME # æ‰§è¡Œçš„æ¨¡å—åç§°  -a MODULE_ARGS, --args=MODULE_ARGS # ä½¿ç”¨ -a æˆ– -args æ¥æŒ‡å®šæ¨¡å—å‚æ•° -h, --help # è·å¾—å¸®åŠ© --list-hosts # åˆ—å‡ºæœ‰å“ªäº›ä¸»æœºæ‰§è¡Œæ“ä½œ    å››ã€è¿é€šæ€§è°ƒè¯• 4.1ã€å…ˆé€šè¿‡\u0026ndash;list-hostæŸ¥çœ‹hostsæ–‡ä»¶é…ç½®æ˜¯å¦æœ‰è¯¯ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  # åˆ—å‡ºæ‰€æœ‰ä¸»æœº [root@master01 ansible]# ansible all --list-host hosts (4): 172.31.194.117 172.31.194.114 172.31.194.115 172.31.194.116 # åˆ—å‡ºæ‰€æœ‰masterä¸»æœº [root@master01 ansible]# ansible master --list-host hosts (3): 172.31.194.114 172.31.194.115 172.31.194.116 # åˆ—å‡ºæ‰€æœ‰nodeä¸»æœº [root@master01 ansible]# ansible node --list-host hosts (1): 172.31.194.117   4.2ã€pingæ¨¡å—æµ‹è¯•ä¸»æœºè¿é€šæ€§ ä½¿ç”¨ ping æ¨¡å—æ—¶ï¼Œä¸ç”¨å†æŒ‡å®š-aå‚æ•°äº†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32  # ä½¿ç”¨ ping æ¨¡å—æµ‹è¯•æ‰€æœ‰ä¸»æœºçš„è¿é€šæ€§ [root@master01 ansible]# ansible all -m ping /usr/lib/python2.7/site-packages/requests/__init__.py:91: RequestsDependencyWarning: urllib3 (1.25.3) or chardet (2.2.1) doesn\u0026#39;t match a supported version! RequestsDependencyWarning) 172.31.194.114 | SUCCESS =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: false, \u0026#34;ping\u0026#34;: \u0026#34;pong\u0026#34; # æˆ‘ä»¬çœ‹åˆ°è¿™ä¸€è¡Œ ping è¿”å› pong è¯´æ˜ä¸»æœºå¯ä»¥è¿æ¥äº†ã€‚ } 172.31.194.116 | SUCCESS =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: false, \u0026#34;ping\u0026#34;: \u0026#34;pong\u0026#34; } 172.31.194.117 | SUCCESS =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: false, \u0026#34;ping\u0026#34;: \u0026#34;pong\u0026#34; } 172.31.194.115 | SUCCESS =\u0026gt; { \u0026#34;ansible_facts\u0026#34;: { \u0026#34;discovered_interpreter_python\u0026#34;: \u0026#34;/usr/bin/python\u0026#34; }, \u0026#34;changed\u0026#34;: false, \u0026#34;ping\u0026#34;: \u0026#34;pong\u0026#34; }   ","description":"","id":16,"section":"ops","tags":["ansible","è‡ªåŠ¨åŒ–è¿ç»´","DevOps"],"title":"è¿ç»´è‡ªåŠ¨åŒ–ç¥å™¨ Ansibleä¹‹å®‰è£…(ä¸€)","uri":"http://localhost:1818/ops/devops/%E8%BF%90%E7%BB%B4%E8%87%AA%E5%8A%A8%E5%8C%96%E7%A5%9E%E5%99%A8ansible%E4%B9%8B%E9%83%A8%E7%BD%B2/"},{"content":"ä¸€ã€ç¯å¢ƒå‡†å¤‡ 1 2 3 4 5 6 7  # åˆ›å»ºç»„å’Œç”¨æˆ· groupadd postgre useradd -g postgre -G postgre -d /home/postgresql postgre # ä¿®æ”¹ç”¨æˆ·å¯†ç  passwd postgre # web2019+ # å®‰è£…ä¾èµ–åŒ… [root@jiexian /home/postgresql]# yum install -y bzip2 readline-devel zlib-devel   äºŒã€æºç åŒ…ä¸‹è½½ 1 2  [root@jiexian ~]#cd /home/postgresql/ [root@jiexian /home/postgresql]# wget https://mirrors.tuna.tsinghua.edu.cn/postgresql/source/v12.0/postgresql-12.0.tar.bz2   ä¸‰ã€ç¼–è¯‘å®‰è£… 1 2 3 4 5 6  [root@jiexian /home/postgresql]# bunzip2 postgresql-12.0.tar.bz2 [root@jiexian /home/postgresql]# tar -xvf ./postgresql-12.0.tar [root@jiexian /home/postgresql]# cd postgresql-12.0/ [root@jiexian /home/postgresql/postgresql-12.0]# ./configure --prefix=/home/postgresql/dbhome [root@jiexian /home/postgresql/postgresql-12.0]# make \u0026amp;\u0026amp; make install   makeåŠmake installå®Œæˆåæœ€åä¸€è¡Œè¾“å‡ºä¿¡æ¯ä¸ºä¸‹å³ä¸ºå®‰è£…æˆåŠŸ\n1  PostgreSQL installation complete.   å®‰è£…å®Œæˆåï¼ŒPostgreSQLå®‰è£…åœ¨å¦‚ä¸‹ä½ç½®\n1 2 3 4 5 6 7  [root@jiexian /home/postgresql/postgresql-12.0]# cd /home/postgresql/dbhome/ [root@jiexian /home/postgresql/dbhome]# ll æ€»ç”¨é‡ 16 drwxr-xr-x 2 root root 4096 11æœˆ 8 21:07 bin drwxr-xr-x 6 root root 4096 11æœˆ 8 21:07 include drwxr-xr-x 4 root root 4096 11æœˆ 8 21:07 lib drwxr-xr-x 6 root root 4096 11æœˆ 8 21:07 share   å››ã€ç¯å¢ƒå˜é‡ 1 2 3 4 5 6 7  [root@jiexian ~]# su - postgre [postgre@jiexian ~]$ vi .bash_profile export LD_LBRARY_PATH=$HOME/dbhome/lib:$LD_LIBRARY_PATH export PATH=$HOME/dbhome/bin:$PATH # åŠ è½½ç¯å¢ƒå˜é‡ [postgre@jiexian ~]$ source .bash_profile   äº”ã€PostgreSQLä½¿ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59  # åˆ›å»ºPostgreSQLçš„æ•°æ®è·¯å¾„ [postgre@jiexian ~]$ mkdir $HOME/data # åˆå§‹åŒ–æ•°æ®åº“ [postgre@jiexian ~]$initdb --locale=C -E UNICODE -D $HOME/data/ The files belonging to this database system will be owned by user \u0026#34;postgre\u0026#34;. This user must also own the server process. The database cluster will be initialized with locale \u0026#34;C\u0026#34;. The default text search configuration will be set to \u0026#34;english\u0026#34;. Data page checksums are disabled. fixing permissions on existing directory /home/postgresql/data ... ok creating subdirectories ... ok selecting dynamic shared memory implementation ... posix selecting default max_connections ... 100 selecting default shared_buffers ... 128MB selecting default time zone ... PRC creating configuration files ... ok running bootstrap script ... ok performing post-bootstrap initialization ... ok syncing data to disk ... ok initdb: warning: enabling \u0026#34;trust\u0026#34; authentication for local connections You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb. Success. You can now start the database server using: pg_ctl -D /home/postgresql/data/ -l logfile start # åˆå§‹åŒ–å®Œæˆåï¼Œåœ¨æœ€åä¸€è¡Œä¼šæç¤ºæˆ‘ä»¬å¯åŠ¨æ•°æ®åº“çš„æ–¹æ³• # æŸ¥çœ‹ä¸€ä¸‹ $HOME/data è·¯å¾„ä¸­çš„å†…å®¹ [postgre@jiexian ~]$cd data [postgre@jiexian ~/data]$ll æ€»ç”¨é‡ 116 drwx------ 5 postgre postgre 4096 11æœˆ 8 21:31 base drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 global drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 pg_commit_ts drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 pg_dynshmem -rw------- 1 postgre postgre 4513 11æœˆ 8 21:31 pg_hba.conf -rw------- 1 postgre postgre 1636 11æœˆ 8 21:31 pg_ident.conf drwx------ 4 postgre postgre 4096 11æœˆ 8 21:31 pg_logical drwx------ 4 postgre postgre 4096 11æœˆ 8 21:31 pg_multixact drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 pg_notify drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 pg_replslot drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 pg_serial drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 pg_snapshots drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 pg_stat drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 pg_stat_tmp drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 pg_subtrans drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 pg_tblspc drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 pg_twophase -rw------- 1 postgre postgre 3 11æœˆ 8 21:31 PG_VERSION drwx------ 3 postgre postgre 4096 11æœˆ 8 21:31 pg_wal drwx------ 2 postgre postgre 4096 11æœˆ 8 21:31 pg_xact -rw------- 1 postgre postgre 88 11æœˆ 8 21:31 postgresql.auto.conf -rw------- 1 postgre postgre 26575 11æœˆ 8 21:31 postgresql.conf   å…­ã€é…ç½®æ–‡ä»¶ ä¸»è¦ä¿®æ”¹ $HOME/data ä¸­çš„ postgresql.conf åŠ pg_hba.conf æ–‡ä»¶\npostgresql.conf ç”¨æ¥é…ç½®æ•°æ®åº“å®ä¾‹\npg_hba.conf ç”¨æ¥é…ç½®æ•°æ®åº“è®¿é—®æˆæƒ\npostgresql.conf å°†ç›‘å¬åœ°å€ä¿®æ”¹ä¸º ifconfig ä¸­çš„åœ°å€ï¼Œç«¯å£ç¦ç”¨å»æ‰ã€‚\nlisten_addresses = '172.16.100.187' # what IP address(es) to listen on;\r# comma-separated list of addresses;\r# defaults to 'localhost'; use '*' for all\r# (change requires restart)\rport = 5432 # (change requires restart)\rpg_hba.conf å°†ä¸‹åˆ—å†…å®¹è¿½åŠ è‡³ pg_hba.conf æœ€åä¸€è¡Œ\n1 2  # å…è®¸æ‰€æœ‰ç½‘æ®µè®¿é—® PostgreSQL host all all 0.0.0.0/0 trust   ä¸ƒã€æ•°æ®åº“å¯åœ PostgreSQLå¯åŠ¨å…³é—­å‘½ä»¤\n1  pg_ctl -D \u0026lt;æ•°æ®å­˜æ”¾è·¯å¾„\u0026gt; [ stop | start ]   ç¤ºä¾‹å¦‚ä¸‹\n1 2 3 4 5 6  [postgre@jiexian ~/data]$pg_ctl -D $HOME/data -l logfile start waiting for server to start.... done server started [postgre@jiexian ~/data]$pg_ctl -D $HOME/data stop waiting for server to shut down.... done server stopped   1 2 3  # å¯åŠ¨æ—¶ -l logfile æŒ‡æ˜æ—¥å¿—è¾“å‡ºçš„ä½ç½® [postgre@jiexian ~/data]$ll -rw------- 1 postgre postgre 929 11æœˆ 8 21:44 logfile   ","description":"","id":17,"section":"ops","tags":["PostgreSQL","æ•°æ®åº“","æœåŠ¡éƒ¨ç½²"],"title":"æºç ç¼–è¯‘å®‰è£… PostgreSQL 12","uri":"http://localhost:1818/ops/deploy/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85postgresql12/"}]